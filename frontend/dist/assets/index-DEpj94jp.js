import{b as ti,n as si,p as ai,r as t,j as e,t as ri,q as ii,v as Ss,D as ni,C as li,P as oi,R as Ot,L as vs,w as ci,x as di,y as ui}from"./vendor-a0TZjT-y.js";import{S as mi,R as Da,I as Ma,F as Ra,a as Fa,T as $a,b as hi,c as La,d as za,P as pi,C as Ua,V as xi,L as Ba,e as Oa,f as fi,g as gi,h as Wa,i as yi,j as bi,O as Va,k as ji,l as Ya,m as vi,n as qa,D as Ha,o as wi,p as Ga,q as Ni,r as Ka,s as _i,t as Ja,u as Si,v as Qa,w as Xa,A as Za,x as er,y as tr,z as sr,B as Ci}from"./vendor-radix-CMSdUCYI.js";import{C as ar,a as ki,b as rr,X as Cs,L as et,A as pt,S as ws,c as Ei,T as zt,P as cs,G as da,M as Vt,F as Qt,d as Ns,e as ds,B as ua,f as Ai,W as Ts,g as ma,h as Vs,i as Fs,j as Dt,U as rs,k as Ti,l as Ii,m as ir,n as Pi,E as Di,o as ys,p as Xt,q as $s,R as _s,r as Mi,s as Ri,t as Fi,u as $i,v as ha,I as Li,w as Ys,x as nr,y as is,z as lr,D as Ls,H as zs,J as zi,K as or,N as Ui,O as Bi,Q as Oi,V as cr,Y as Wi,Z as Vi,_ as Yi,$ as qi,a0 as Hi,a1 as Gi,a2 as Ki,a3 as Us,a4 as Ji,a5 as Qi,a6 as pa,a7 as Xi,a8 as Zi,a9 as xa,aa as en,ab as tn,ac as xs,ad as sn}from"./vendor-icons-CjVWZYUu.js";import{u as an,o as rn}from"./vendor-wavesurfer-6h1EaJnz.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&l(m)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();window.React||(window.React=ti);window.ReactDOM||(window.ReactDOM=si);const nn={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE:"https://api.getpodcastplus.com"};try{const s=nn||{};s.VITE_SENTRY_DSN?(ai({dsn:s.VITE_SENTRY_DSN,tracesSampleRate:Number(s.VITE_SENTRY_TRACES_SAMPLE_RATE||"0"),environment:s.VITE_APP_ENV||s.MODE||"dev",beforeSend(a){return(s.DEV||s.MODE==="development")&&!s.VITE_SENTRY_ENABLE_DEV?null:a}}),console.log("[sentry] initialized")):console.log("[sentry] disabled (no DSN)")}catch(s){console.warn("[sentry] init failed",s)}const ln={};function Tt(s){return s&&typeof s=="object"&&(s.error||s.detail||s.message)}const fa=import.meta&&ln?"https://api.getpodcastplus.com".replace(/\/+$/,""):"";function dr(s){return s?/^https?:\/\//i.test(s)?s:`${fa}${s}`:fa||""}async function Ht(s,a={}){const r=dr(s),l=await fetch(r,{credentials:"include",headers:{...a.headers||{}},...a}),n=l.headers.get&&l.headers.get("content-type"),o=n&&n.includes("application/json"),m=o?await l.json().catch(()=>({})):await l.text().catch(()=>"");if(!l.ok){if(o){const k=m&&typeof m=="object"?m:{message:String(m||"Request failed")};throw{status:l.status,...k}}throw{status:l.status,message:String(m||"Request failed")}}return o?m:{ok:!0,data:m}}function Is(s){return s==null?void 0:JSON.stringify(s)}function ge(s){const a=s?{Authorization:`Bearer ${s}`}:{};return{get:(r,l={})=>Ht(r,{...l,method:"GET",headers:{...a,...l.headers||{}}}),post:(r,l,n={})=>Ht(r,{...n,method:"POST",headers:{"Content-Type":"application/json",...a,...n.headers||{}},body:Is(l)}),put:(r,l,n={})=>Ht(r,{...n,method:"PUT",headers:{"Content-Type":"application/json",...a,...n.headers||{}},body:Is(l)}),patch:(r,l,n={})=>Ht(r,{...n,method:"PATCH",headers:{"Content-Type":"application/json",...a,...n.headers||{}},body:Is(l)}),del:(r,l={})=>Ht(r,{...l,method:"DELETE",headers:{...a,...l.headers||{}}}),raw:(r,l={})=>Ht(r,{...l,headers:{...a,...l.headers||{}}})}}function on(s){return dr(s)}const ur=t.createContext(null),cn=({children:s})=>{const[a,r]=t.useState(localStorage.getItem("authToken")),[l,n]=t.useState(null),[o,m]=t.useState(!0),k=t.useRef(!1),i=t.useRef(0),u=t.useRef(0),y=t.useRef(2e3),f=6e4;t.useEffect(()=>{a?localStorage.setItem("authToken",a):localStorage.removeItem("authToken")},[a]);const h=j=>{r(j)},D=()=>{r(null),n(null)},d=t.useCallback(async(j={force:!1})=>{if(!a){n(null);return}const S=Date.now();if(!(!j.force&&!o&&S-u.current<y.current)&&!(k.current&&!j.force)){k.current=!0,u.current=S;try{const v=await fetch("/api/users/me",{headers:{Authorization:`Bearer ${a}`}});if(v.ok){const p=await v.json();n(p),o||m(!0),i.current=0,y.current=2e3}else{if(v.status===401){n(null),r(null);return}o&&m(!1)}}catch(v){o&&m(!1),i.current<5&&console.warn("[Auth] refreshUser failed; will not auto-retry",v.message||v),i.current+=1,y.current=Math.min(y.current*2,f)}finally{k.current=!1}}},[a,o]);t.useEffect(()=>{d()},[a,d]),t.useEffect(()=>{function j(S){const v=S.detail&&S.detail.token;v&&v!==a&&r(v)}return window.addEventListener("ppp-token-captured",j),()=>window.removeEventListener("ppp-token-captured",j)},[a]);const N={token:a,user:l,login:h,logout:D,refreshUser:d,isAuthenticated:!!a,backendOnline:o};return e.jsx(ur.Provider,{value:N,children:s})},St=()=>t.useContext(ur);function Fe(...s){return ri(ii(s))}const dn=Ss("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),M=t.forwardRef(({className:s,variant:a,size:r,asChild:l=!1,...n},o)=>{const m=l?mi:"button";return e.jsx(m,{className:Fe(dn({variant:a,size:r,className:s})),ref:o,...n})});M.displayName="Button";const _e=t.forwardRef(({className:s,...a},r)=>e.jsx("div",{ref:r,className:Fe("rounded-xl border bg-card text-card-foreground shadow",s),...a}));_e.displayName="Card";const Me=t.forwardRef(({className:s,...a},r)=>e.jsx("div",{ref:r,className:Fe("flex flex-col space-y-1.5 p-6",s),...a}));Me.displayName="CardHeader";const Re=t.forwardRef(({className:s,...a},r)=>e.jsx("div",{ref:r,className:Fe("font-semibold leading-none tracking-tight",s),...a}));Re.displayName="CardTitle";const wt=t.forwardRef(({className:s,...a},r)=>e.jsx("div",{ref:r,className:Fe("text-sm text-muted-foreground",s),...a}));wt.displayName="CardDescription";const Se=t.forwardRef(({className:s,...a},r)=>e.jsx("div",{ref:r,className:Fe("p-6 pt-0",s),...a}));Se.displayName="CardContent";const mr=t.forwardRef(({className:s,...a},r)=>e.jsx("div",{ref:r,className:Fe("flex items-center p-6 pt-0",s),...a}));mr.displayName="CardFooter";const un=Ss("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ft({className:s,variant:a,...r}){return e.jsx("div",{className:Fe(un({variant:a}),s),...r})}const qs=t.forwardRef(({className:s,...a},r)=>e.jsx(Da,{ref:r,className:Fe("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a}));qs.displayName=Da.displayName;const Hs=t.forwardRef(({className:s,...a},r)=>e.jsx(Ma,{ref:r,className:Fe("aspect-square h-full w-full",s),...a}));Hs.displayName=Ma.displayName;const Gs=t.forwardRef(({className:s,...a},r)=>e.jsx(Ra,{ref:r,className:Fe("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a}));Gs.displayName=Ra.displayName;const mn=1,hn=1e6;let Ps=0;function pn(){return Ps=(Ps+1)%Number.MAX_SAFE_INTEGER,Ps.toString()}const Ds=new Map,ga=s=>{if(Ds.has(s))return;const a=setTimeout(()=>{Ds.delete(s),ns({type:"REMOVE_TOAST",toastId:s})},hn);Ds.set(s,a)},xn=(s,a)=>{switch(a.type){case"ADD_TOAST":return{...s,toasts:[a.toast,...s.toasts].slice(0,mn)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(r=>r.id===a.toast.id?{...r,...a.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=a;return r?ga(r):s.toasts.forEach(l=>{ga(l.id)}),{...s,toasts:s.toasts.map(l=>l.id===r||r===void 0?{...l,open:!1}:l)}}case"REMOVE_TOAST":return a.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(r=>r.id!==a.toastId)}}},bs=[];let js={toasts:[]};function ns(s){js=xn(js,s),bs.forEach(a=>{a(js)})}function dt({...s}){const a=pn(),r=n=>ns({type:"UPDATE_TOAST",toast:{...n,id:a}}),l=()=>ns({type:"DISMISS_TOAST",toastId:a});return ns({type:"ADD_TOAST",toast:{...s,id:a,open:!0,onOpenChange:n=>{n||l()}}}),{id:a,dismiss:l,update:r}}function gt(){const[s,a]=t.useState(js);return t.useEffect(()=>(bs.push(a),()=>{const r=bs.indexOf(a);r>-1&&bs.splice(r,1)}),[s]),{...s,toast:dt,dismiss:r=>ns({type:"DISMISS_TOAST",toastId:r})}}const Bs={ppp:{key:"ppp",name:"Podcast Plus",shortName:"PPP",logo:"/assets/ppp-logo.svg",colors:{primary:"#0ea5e9",accent:"#f59e0b"}},nsc:{key:"nsc",name:"No Sweat Podcast Studio",shortName:"NSC",logo:"/assets/nsc-logo.svg",colors:{primary:"#22c55e",accent:"#eab308"}}};function fn(){const s=new URLSearchParams(window.location.search).get("brand");if(s==="ppp"||s==="nsc")return localStorage.setItem("brand",s),s;s==="auto"&&localStorage.removeItem("brand");const a=localStorage.getItem("brand");if(a==="ppp"||a==="nsc")return a;const r=Math.random()<.5?"ppp":"nsc";return localStorage.setItem("brand",r),r}const hr=t.createContext({brand:Bs.ppp,setBrandKey:()=>{}});function gn({children:s}){const[a,r]=t.useState(fn()),l=t.useMemo(()=>Bs[a]||Bs.ppp,[a]);return t.useEffect(()=>{const n=document.documentElement;n.classList.remove("brand-ppp","brand-nsc"),n.classList.add(`brand-${l.key}`),n.setAttribute("data-brand",l.key);try{localStorage.setItem("brand",l.key)}catch{}document.title=l.key==="nsc"?"No Sweat Podcast Studio":"Podcast Plus"},[l]),e.jsx(hr.Provider,{value:{brand:l,setBrandKey:r},children:s})}const pr=()=>t.useContext(hr);function xr({size:s=28,lockup:a=!0}){const{brand:r}=pr();if(r.key==="nsc"){const l=s<32?"/nsc_mark_lite.svg":"/nsclogo.svg";return e.jsxs("div",{className:"flex items-center gap-3","aria-label":"No Sweat Podcast Studio",children:[e.jsx("img",{src:l,width:s,height:s,alt:""}),a&&e.jsx("span",{className:"font-semibold",style:{fontSize:s*.6},children:"No Sweat Podcast Studio"})]})}return e.jsx("div",{className:"flex items-center gap-3","aria-label":"Podcast Plus",children:e.jsx("span",{className:"font-semibold",style:{fontSize:s*.6},children:"Podcast Plus"})})}const we=t.forwardRef(({className:s,type:a,...r},l)=>e.jsx("input",{type:a,className:Fe("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:l,...r}));we.displayName="Input";const yn=Ss("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ne=t.forwardRef(({className:s,...a},r)=>e.jsx(Fa,{ref:r,className:Fe(yn(),s),...a}));ne.displayName=Fa.displayName;const Nt=yi,_t=bi,bt=t.forwardRef(({className:s,children:a,...r},l)=>e.jsxs($a,{ref:l,className:Fe("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...r,children:[a,e.jsx(hi,{asChild:!0,children:e.jsx(ar,{className:"h-4 w-4 opacity-50"})})]}));bt.displayName=$a.displayName;const fr=t.forwardRef(({className:s,...a},r)=>e.jsx(La,{ref:r,className:Fe("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(ki,{className:"h-4 w-4"})}));fr.displayName=La.displayName;const gr=t.forwardRef(({className:s,...a},r)=>e.jsx(za,{ref:r,className:Fe("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(ar,{className:"h-4 w-4"})}));gr.displayName=za.displayName;const jt=t.forwardRef(({className:s,children:a,position:r="popper",...l},n)=>e.jsx(pi,{children:e.jsxs(Ua,{ref:n,className:Fe("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...l,children:[e.jsx(fr,{}),e.jsx(xi,{className:Fe("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),e.jsx(gr,{})]})}));jt.displayName=Ua.displayName;const bn=t.forwardRef(({className:s,...a},r)=>e.jsx(Ba,{ref:r,className:Fe("px-2 py-1.5 text-sm font-semibold",s),...a}));bn.displayName=Ba.displayName;const ct=t.forwardRef(({className:s,children:a,...r},l)=>e.jsxs(Oa,{ref:l,className:Fe("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...r,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(fi,{children:e.jsx(rr,{className:"h-4 w-4"})})}),e.jsx(gi,{children:a})]}));ct.displayName=Oa.displayName;const jn=t.forwardRef(({className:s,...a},r)=>e.jsx(Wa,{ref:r,className:Fe("-mx-1 my-1 h-px bg-muted",s),...a}));jn.displayName=Wa.displayName;const Wt=t.forwardRef(({className:s,...a},r)=>e.jsx("textarea",{className:Fe("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...a}));Wt.displayName="Textarea";function vn({value:s,onChange:a}){const r=s||{auto_fill_ai:!0,title_instructions:"",notes_instructions:"",tags_instructions:"",tags_always_include:[],auto_generate_tags:!0},l=t.useMemo(()=>(r.tags_always_include||[]).join(", "),[r.tags_always_include]),[n,o]=t.useState(l);t.useEffect(()=>{o(l)},[l]);const m=i=>{const u=(i||"").split(",").map(h=>h.trim()).filter(Boolean),y=new Set,f=[];for(const h of u){const D=h.toLowerCase();if(!y.has(D)&&(y.add(D),f.push(h),f.length>=20))break}o(f.join(", ")),a?.({...r,tags_always_include:f})},k=i=>a?.({...r,...i});return e.jsxs("section",{className:"space-y-3 border rounded-md p-3 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-medium",children:"AI Content"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!r.auto_fill_ai,onChange:i=>k({auto_fill_ai:!!i.target.checked})}),e.jsx("span",{children:"Auto fill fields with AI suggestions?"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Title instructions"}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2",rows:3,placeholder:'e.g., Use format "E### – Film – Hook". Keep ≤ 80 chars.',value:r.title_instructions||"",onChange:i=>k({title_instructions:i.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Notes/Description instructions"}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2",rows:4,placeholder:"e.g., Snarky tone. Provide time-stamped overview of major points.",value:r.notes_instructions||"",onChange:i=>k({notes_instructions:i.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Tags instructions (optional)"}),e.jsx("textarea",{className:"w-full border rounded px-3 py-2",rows:3,placeholder:"e.g., Focus on movie, director, year. No spoilers in tags.",value:r.tags_instructions||"",onChange:i=>k({tags_instructions:i.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:r.auto_generate_tags===!1,onChange:i=>k({auto_generate_tags:!i.target.checked})}),e.jsx("span",{children:"Do not automatically generate tags"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"When checked, the system will not auto-generate tags for episodes using this template."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Always include these tags (comma-separated)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",placeholder:"e.g., star wars, podcast, film",value:n,onChange:i=>{o(i.target.value)},onBlur:()=>m(n),onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),m(n))}}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"We’ll add these first, then the AI fills the rest (max 20 total; each ≤ 30 chars)."})]})]})}function wn(s,a){try{const r=typeof a=="string"?JSON.parse(a):a,l=r?.detail||r?.error||r?.message;if(l)return String(l)}catch{}return s===401||s===403?"You are not signed in or your session has expired.":s===429?"Too many requests. Please slow down and try again shortly.":s>=500?"The server had a problem creating speech. Please try again.":"Request failed. Please check your input and try again."}async function Nn(s){const a=await fetch("/api/media/tts",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){const n=await a.text().catch(()=>"");throw new Error(wn(a.status,n))}const r=await a.json(),l=Array.isArray(r)?r[0]:r?.item||r;if(!l?.filename)throw new Error("TTS succeeded but no file was returned.");return l}async function ks(s="",a=1,r=50){const l=await fetch(`/api/elevenlabs/voices?search=${encodeURIComponent(s)}&page=${a}&size=${r}`,{credentials:"include"});if(!l.ok)throw new Error(await l.text());return l.json()}function us({value:s,onChange:a,onClose:r,onSelect:l,token:n}){const[o,m]=t.useState(""),[k,i]=t.useState([]),[u,y]=t.useState(!1),[f,h]=t.useState(s||null),[D,d]=t.useState(null);t.useEffect(()=>{h(s||null)},[s]),t.useEffect(()=>{let p=!1;async function b(){y(!0);try{if(n){const W=await ge(n).get(`/api/elevenlabs/voices?search=${encodeURIComponent(o)}&page=1&size=50`),$=Array.isArray(W?.items)?W.items:Array.isArray(W)?W:[];p||i($)}else{const A=await ks(o,1,50);p||i(A.items||[])}}catch(A){p||i([]),console.error("Failed to load voices:",A)}finally{p||y(!1)}}return b(),()=>{p=!0}},[o,n]);const N=k||[],j=p=>{if(!p||typeof p!="object")return"";const A=["gender","accent","age","style"].map($=>p[$]).filter(Boolean);return A.length?A.join(" · "):Object.entries(p).slice(0,3).map(([$,G])=>`${$}:${G}`).join(" · ")},S=p=>{const b=typeof p=="string"?p:p?.voice_id,A=typeof p=="string"?null:p;h(b);try{a&&a(b)}catch{}try{l&&A&&l(A)}catch{}},v=p=>{d(b=>b===p?null:p)};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:r}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg w-full max-w-3xl max-h-[85vh] flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Choose a Voice"}),e.jsx("button",{onClick:r,className:"text-sm text-gray-600 hover:text-gray-900",children:"Close"})]}),e.jsx("div",{className:"p-4",children:e.jsx("input",{type:"text",value:o,onChange:p=>m(p.target.value),placeholder:"Search voices by name or label...",className:"w-full border rounded-md px-3 py-2 focus:outline-none focus:ring"})}),e.jsxs("div",{className:"px-4 pb-4 overflow-y-auto",style:{maxHeight:"60vh"},children:[u&&e.jsx("div",{className:"text-sm text-gray-500 p-2",children:"Loading…"}),!u&&N.length===0&&e.jsx("div",{className:"text-sm text-gray-500 p-2",children:"No voices found."}),e.jsx("ul",{className:"space-y-3",children:N.map(p=>{const b=f&&p.voice_id===f,A=j(p.labels),W=!!p.preview_url,$=D===p.voice_id&&!!p.preview_url,G=p.common_name||p.name||"Unnamed voice";return e.jsxs("li",{className:`border rounded-md p-3 ${b?"border-blue-500 ring-1 ring-blue-300":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:G}),p.description&&e.jsx("div",{className:"text-xs text-gray-600 mt-0.5",children:p.description}),A&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:A})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[W&&e.jsx("button",{onClick:()=>v(p.voice_id),className:"text-sm px-2 py-1 border rounded hover:bg-gray-50",children:$?"Hide":"Preview"}),e.jsx("button",{onClick:()=>S(p),disabled:!!b,className:`text-sm px-2 py-1 border rounded ${b?"bg-gray-200 text-gray-700 cursor-default":"bg-blue-600 text-white hover:bg-blue-700"}`,children:b?"Selected":"Select"})]})]}),$&&e.jsx("div",{className:"mt-2",children:e.jsx("audio",{controls:!0,src:p.preview_url||void 0,controlsList:"nodownload",className:"w-full"})})]},p.voice_id)})})]})]})]})}const ms=wi,_n=ji,yr=t.forwardRef(({className:s,...a},r)=>e.jsx(Va,{ref:r,className:Fe("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a}));yr.displayName=Va.displayName;const Zt=t.forwardRef(({className:s,children:a,...r},l)=>e.jsxs(_n,{children:[e.jsx(yr,{}),e.jsxs(Ya,{ref:l,className:Fe("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r,children:[a,e.jsxs(vi,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Cs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Zt.displayName=Ya.displayName;const es=({className:s,...a})=>e.jsx("div",{className:Fe("flex flex-col space-y-1.5 text-center sm:text-left",s),...a});es.displayName="DialogHeader";const ts=({className:s,...a})=>e.jsx("div",{className:Fe("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});ts.displayName="DialogFooter";const ss=t.forwardRef(({className:s,...a},r)=>e.jsx(qa,{ref:r,className:Fe("text-lg font-semibold leading-none tracking-tight",s),...a}));ss.displayName=qa.displayName;const Lt=t.forwardRef(({className:s,...a},r)=>e.jsx(Ha,{ref:r,className:Fe("text-sm text-muted-foreground",s),...a}));Lt.displayName=Ha.displayName;const Sn={auto_fill_ai:!0,title_instructions:"",notes_instructions:"",tags_instructions:"",tags_always_include:[],auto_generate_tags:!0},Os={intro:e.jsx(Ns,{className:"w-5 h-5 text-blue-500"}),outro:e.jsx(Ns,{className:"w-5 h-5 text-purple-500"}),content:e.jsx(Qt,{className:"w-5 h-5 text-green-500"}),commercial:e.jsx(Vt,{className:"w-5 h-5 text-orange-500"})},ya={static:e.jsx(Qt,{className:"w-4 h-4 mr-2"}),tts:e.jsx(Vt,{className:"w-4 h-4 mr-2"})},fs=({type:s,onClick:a,disabled:r})=>e.jsxs(M,{variant:"outline",className:"flex flex-col h-24 justify-center items-center gap-2 text-gray-700 hover:bg-gray-100 hover:text-blue-600 transition-colors disabled:opacity-50",onClick:()=>a(s),disabled:r,children:[Os[s],e.jsx("span",{className:"text-sm font-semibold",children:s.charAt(0).toUpperCase()+s.slice(1)})]});function br({templateId:s,onBack:a,token:r,onTemplateSaved:l}){const[n,o]=t.useState(null),[m,k]=t.useState(!0),[i,u]=t.useState(!1),[y,f]=t.useState(null),[h,D]=t.useState([]),[d,N]=t.useState([]),[j,S]=t.useState(null),[v,p]=t.useState(!1),[b,A]=t.useState(null),[W,$]=t.useState(!1),[G,Q]=t.useState(null),[ee,I]=t.useState(""),[q,te]=t.useState(null),[w,P]=t.useState(1),[_,V]=t.useState(""),[K,ue]=t.useState([]),[ie,xe]=t.useState(!1),[de,Ae]=t.useState({});t.useEffect(()=>{const T=async()=>{try{const Y=await ge(r).get("/api/elevenlabs/voices?size=200"),O=Array.isArray(Y?.items)?Y.items:Array.isArray(Y)?Y:[];ue(O),!q&&j&&te(j)}catch{ue([])}};W&&K.length===0&&T()},[W]);const qe=s==="new",Ke=t.useMemo(()=>h.filter(T=>T.category==="intro"),[h]),He=t.useMemo(()=>h.filter(T=>T.category==="outro"),[h]),tt=t.useMemo(()=>h.filter(T=>T.category==="music"),[h]),Je=t.useMemo(()=>h.filter(T=>T.category==="commercial"),[h]);t.useEffect(()=>{(async()=>{k(!0);try{const U=ge(r),[Y,O]=await Promise.all([U.get("/api/media/"),U.get("/api/podcasts/")]);if(D(Y),N(O||[]),qe)o({name:"My New Podcast Template",is_active:!0,podcast_id:O&&O.length>0?O[O.length-1].id:null,segments:[{id:crypto.randomUUID(),segment_type:"intro",source:{source_type:"static",filename:""}},{id:crypto.randomUUID(),segment_type:"content",source:{source_type:"static",filename:""}},{id:crypto.randomUUID(),segment_type:"outro",source:{source_type:"static",filename:""}}],background_music_rules:[],timing:{content_start_offset_s:0,outro_start_offset_s:0}});else{const fe=await ge(r).get(`/api/templates/${s}`);o(fe)}f(null)}catch(U){f(U.message||String(U))}finally{k(!1)}})()},[s,r,qe]),t.useEffect(()=>{if(!n)return;const T=n.default_elevenlabs_voice_id||n.voice_id||Array.isArray(n.segments)&&n.segments.find(U=>U?.source?.source_type==="tts"&&U?.source?.voice_id)?.source?.voice_id||null;S(T||null),A(null)},[n]),t.useEffect(()=>{if(!j||b)return;let T=!1;return(async()=>{try{const Y=await ge(r).get(`/api/elevenlabs/voice/${encodeURIComponent(j)}/resolve`),O=Y?.common_name||Y?.name||null;T||A(O)}catch{}})(),()=>{T=!0}},[j,b,r]);const Le=(T,U)=>{o(Y=>({...Y,[T]:U}))},Ve=(T,U)=>{const Y={...n.timing,[T]:U};o(O=>({...O,timing:Y}))},Ye=(T,U,Y)=>{const O=[...n.background_music_rules];O[T][U]=Y,o(L=>({...L,background_music_rules:O}))},ze=()=>{const T={id:crypto.randomUUID(),apply_to_segments:["content"],music_filename:"",start_offset_s:0,end_offset_s:0,fade_in_s:2,fade_out_s:3,volume_db:-15};o(U=>({...U,background_music_rules:[...U.background_music_rules||[],T]}))},Ue=T=>{const U=[...n.background_music_rules];U.splice(T,1),o(Y=>({...Y,background_music_rules:U}))},Be=(T,U)=>{o(Y=>({...Y,segments:Y.segments.map(O=>O.id===T?{...O,source:U}:O)}))},Xe=T=>{const U={id:crypto.randomUUID(),segment_type:T,source:{source_type:"static",filename:""}},Y=[...n.segments],O=Y.findIndex(L=>L.segment_type==="content");T==="intro"?Y.splice(O!==-1?O:0,0,U):T==="outro"?Y.push(U):Y.splice(O!==-1?O+1:Y.length,0,U),o(L=>({...L,segments:Y}))},B=T=>{o(U=>({...U,segments:U.segments.filter(Y=>Y.id!==T)}))},re=T=>{if(!T.destination)return;const U=Array.from(n.segments),[Y]=U.splice(T.source.index,1);U.splice(T.destination.index,0,Y);const O=U.findIndex(fe=>fe.segment_type==="content"),L=U.findIndex(fe=>fe.segment_type==="outro");O!==-1&&(Y.segment_type==="intro"&&T.destination.index>O||Y.segment_type==="content"&&U.some((fe,be)=>fe.segment_type==="intro"&&be>T.destination.index))||L!==-1&&(Y.segment_type==="outro"&&O!==-1&&T.destination.index<O||Y.segment_type==="content"&&T.destination.index>L)||o(fe=>({...fe,segments:U}))},le=async()=>{u(!0),f(null);try{if(!n.podcast_id)throw new Error("A show is required for this template. Please select one.");const T=ge(r),U={...n};j?U.default_elevenlabs_voice_id=j:U.default_elevenlabs_voice_id=null,Array.isArray(U.segments)&&(U.segments=U.segments.map(Y=>{if(Y.segment_type!=="content"){const O=Y?.source?.source_type;if(O==="static"){const L=Y?.source?.filename||"";return{...Y,source:{source_type:"static",filename:L}}}if(O==="tts"){const L=(Y?.source?.text_prompt||"").trim(),fe=Y?.source?.voice_id||void 0,be={source_type:"tts"};return L&&(be.text_prompt=L),fe&&(be.voice_id=fe),{...Y,source:be}}return{...Y,source:{source_type:"static",filename:Y?.source?.filename||""}}}return{...Y,source:{source_type:"static",filename:""}}})),qe?await T.post("/api/templates/",U):await T.put(`/api/templates/${s}`,U),l(),a()}catch(T){f(T.message||String(T))}finally{u(!1)}};if(m)return e.jsx("div",{className:"flex justify-center items-center p-10",children:e.jsx(et,{className:"w-8 h-8 animate-spin"})});if(y)return e.jsxs("p",{className:"text-red-500 p-4",children:["Error: ",y]});if(!n)return null;const ce=n.segments.some(T=>T.segment_type==="content");return e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(M,{onClick:a,variant:"ghost",className:"text-gray-700",children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Template Editor"}),e.jsx(M,{onClick:le,disabled:i,className:"bg-blue-600 hover:bg-blue-700 text-white",children:i?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ws,{className:"w-4 h-4 mr-2"}),"Save Template"]})})]}),e.jsx(_e,{className:"shadow-sm",children:e.jsxs(Se,{className:"p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Re,{className:"text-lg",children:"Template status"}),e.jsx(wt,{children:"Mark a template inactive to hide it from selection without deleting it."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-sm px-2 py-1 rounded-full border ${n?.is_active!==!1?"bg-green-50 text-green-700 border-green-200":"bg-gray-100 text-gray-700 border-gray-300"}`,children:n?.is_active!==!1?"Active":"Inactive"}),e.jsx(M,{variant:"outline",onClick:()=>Le("is_active",n?.is_active===!1),children:n?.is_active!==!1?"Disable":"Enable"})]})]})}),e.jsx(_e,{className:"shadow-sm",children:e.jsxs(Se,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx(ne,{htmlFor:"template-name",className:"text-sm font-medium text-gray-600",children:"Template Name"}),e.jsx(we,{id:"template-name",className:"text-2xl font-bold border-0 border-b-2 border-gray-200 focus:border-blue-500 transition-colors p-0",value:n.name||"",onChange:T=>Le("name",T.target.value)})]}),e.jsxs("div",{children:[e.jsx(ne,{className:"text-sm font-medium text-gray-600",children:"Show (Required)"}),d.length===0?e.jsx("div",{className:"mt-2 p-3 border rounded bg-yellow-50 text-sm text-yellow-700",children:"You have no shows yet. Create a show first in the Show Manager, then return to create a template."}):e.jsxs(Nt,{value:n.podcast_id||"",onValueChange:T=>Le("podcast_id",T),children:[e.jsx(bt,{className:"mt-2",children:e.jsx(_t,{placeholder:"Select a show"})}),e.jsx(jt,{children:d.map(T=>e.jsx(ct,{value:T.id,children:T.name},T.id))})]})]})]})}),e.jsx(_e,{className:"shadow-sm",children:e.jsx(Se,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(ne,{className:"text-sm font-medium text-gray-600",children:"Default AI Voice"}),e.jsx("div",{className:"text-sm text-gray-800 mt-1",children:b||"Not set"})]}),e.jsx("div",{className:"mt-2 sm:mt-0",children:e.jsx(M,{variant:"outline",onClick:()=>p(!0),children:"Choose voice"})})]})})}),e.jsxs(_e,{children:[e.jsxs(Me,{children:[e.jsx(Re,{children:"Add Segments"}),e.jsx(wt,{children:"Add the building blocks for your episode."})]}),e.jsxs(Se,{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fs,{type:"intro",onClick:Xe}),e.jsx(fs,{type:"content",onClick:Xe,disabled:ce}),e.jsx(fs,{type:"outro",onClick:Xe}),e.jsx(fs,{type:"commercial",onClick:Xe})]})]}),e.jsxs(_e,{children:[e.jsxs(Me,{children:[e.jsx(Re,{children:"Episode Structure"}),e.jsx(wt,{children:"Drag and drop segments to reorder them."})]}),e.jsx(Se,{children:e.jsx(ni,{onDragEnd:re,children:e.jsx(li,{droppableId:"segments",children:T=>e.jsxs("div",{...T.droppableProps,ref:T.innerRef,className:"space-y-4",children:[n.segments.map((U,Y)=>e.jsx(oi,{draggableId:U.id,index:Y,isDragDisabled:U.segment_type==="content",children:(O,L)=>e.jsx("div",{ref:O.innerRef,...O.draggableProps,...O.dragHandleProps,children:e.jsx(Cn,{segment:U,onDelete:()=>B(U.id),onSourceChange:Be,mediaFiles:{intro:Ke,outro:He,commercial:Je},isDragging:L.isDragging,onOpenTTS:fe=>{Q(U),I(fe?.script??""),te(fe?.voice_id??j??null),P(fe?.speaking_rate&&!Number.isNaN(fe.speaking_rate)?fe.speaking_rate:1),V(fe?.friendly_name??""),$(!0)},justCreated:!!de[U.id],templateVoiceId:j||null,token:r})})},U.id)),T.placeholder]})})})})]}),e.jsxs(_e,{children:[e.jsxs(Me,{children:[e.jsxs(Re,{className:"flex items-center gap-2",children:[e.jsx(Ei,{className:"w-6 h-6 text-gray-600"})," Advanced Settings"]}),e.jsx(wt,{children:"Fine-tune the timing and background music for your podcast."})]}),e.jsxs(Se,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(ne,{children:"Content Start Delay (seconds)"}),e.jsx(we,{type:"number",step:"0.5",value:n.timing?.content_start_offset_s,onChange:T=>Ve("content_start_offset_s",parseFloat(T.target.value||0))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Delay / overlap (negative overlaps intro). Default 0."})]}),e.jsxs("div",{children:[e.jsx(ne,{children:"Outro Start Delay (seconds)"}),e.jsx(we,{type:"number",step:"0.5",value:n.timing?.outro_start_offset_s,onChange:T=>Ve("outro_start_offset_s",parseFloat(T.target.value||0))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Delay / overlap (negative overlaps content tail). Default 0."})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Background Music"}),e.jsx("div",{className:"space-y-4",children:(n.background_music_rules||[]).map((T,U)=>e.jsxs("div",{className:"p-4 border rounded-lg bg-gray-50 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(ne,{className:"font-semibold",children:["Music Rule #",U+1]}),e.jsxs(M,{variant:"destructive",size:"sm",onClick:()=>Ue(U),children:[e.jsx(zt,{className:"w-4 h-4 mr-2"}),"Remove"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ne,{children:"Apply to Section"}),e.jsxs(Nt,{value:T.apply_to_segments[0],onValueChange:Y=>Ye(U,"apply_to_segments",[Y]),children:[e.jsx(bt,{children:e.jsx(_t,{})}),e.jsxs(jt,{children:[e.jsx(ct,{value:"intro",children:"Intro Section"}),e.jsx(ct,{value:"content",children:"Content Section"}),e.jsx(ct,{value:"outro",children:"Outro Section"})]})]})]}),e.jsxs("div",{children:[e.jsx(ne,{children:"Music File"}),e.jsxs(Nt,{value:T.music_filename,onValueChange:Y=>Ye(U,"music_filename",Y),children:[e.jsx(bt,{children:e.jsx(_t,{placeholder:"Select music..."})}),e.jsx(jt,{children:tt.map(Y=>e.jsx(ct,{value:Y.filename,children:Y.friendly_name||Y.filename.split("_").slice(1).join("_")},Y.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(ne,{children:"Start Offset (sec)"}),e.jsx(we,{type:"number",step:"0.5",value:T.start_offset_s,onChange:Y=>Ye(U,"start_offset_s",parseFloat(Y.target.value||0))})]}),e.jsxs("div",{children:[e.jsx(ne,{children:"End Offset (sec)"}),e.jsx(we,{type:"number",step:"0.5",value:T.end_offset_s,onChange:Y=>Ye(U,"end_offset_s",parseFloat(Y.target.value||0))})]}),e.jsxs("div",{children:[e.jsx(ne,{children:"Fade In (sec)"}),e.jsx(we,{type:"number",step:"0.5",value:T.fade_in_s,onChange:Y=>Ye(U,"fade_in_s",parseFloat(Y.target.value||0))})]}),e.jsxs("div",{children:[e.jsx(ne,{children:"Fade Out (sec)"}),e.jsx(we,{type:"number",step:"0.5",value:T.fade_out_s,onChange:Y=>Ye(U,"fade_out_s",parseFloat(Y.target.value||0))})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(ne,{children:"Volume (dB)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{type:"range",min:"-60",max:"0",step:"1",value:T.volume_db,onChange:Y=>Ye(U,"volume_db",parseInt(Y.target.value,10)),className:"w-full"}),e.jsxs("span",{className:"text-sm font-mono w-16 text-center",children:[T.volume_db," dB"]})]})]})]},T.id))}),e.jsxs(M,{onClick:ze,variant:"outline",className:"mt-4",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Add Music Rule"]})]})]})]}),e.jsx(vn,{value:n?.ai_settings||Sn,onChange:T=>o(U=>({...U,ai_settings:T}))}),e.jsx("div",{className:"flex justify-end items-center mt-6",children:e.jsx(M,{onClick:le,disabled:i||!n.podcast_id||d.length===0,className:"bg-blue-600 hover:bg-blue-700 text-white",children:i?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ws,{className:"w-4 h-4 mr-2"}),"Save Template"]})})}),v&&e.jsx(us,{value:j||null,onChange:T=>S(T),onSelect:T=>A(T?.common_name||T?.name||null),onClose:()=>p(!1),token:r}),e.jsx(ms,{open:W,onOpenChange:T=>{$(T)},children:e.jsxs(Zt,{className:"sm:max-w-[600px]",children:[e.jsxs(es,{children:[e.jsx(ss,{children:"Create with TTS (one-time)"}),e.jsx(Lt,{children:"We’ll synthesize this once and save it to your library. You won’t need to re-generate it every episode."})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{children:[e.jsx(ne,{children:"Script"}),e.jsx(Wt,{value:ee,onChange:T=>{I(T.target.value);const U=(T.target.value||"").trim().split(/\s+/).slice(0,6).join(" "),Y=G?G.segment_type.charAt(0).toUpperCase()+G.segment_type.slice(1):"Segment";_||V(`${Y} TTS – ${U}`.trim())},placeholder:"e.g., Welcome to the show...",className:"mt-1",rows:5})]}),e.jsxs("div",{children:[e.jsx(ne,{children:"Voice"}),e.jsxs(Nt,{value:q||"",onValueChange:T=>te(T),children:[e.jsx(bt,{className:"mt-1",children:e.jsx(_t,{placeholder:"Select a voice"})}),e.jsx(jt,{children:K.map(T=>e.jsx(ct,{value:T.voice_id||T.id||"",children:T.common_name||T.name||T.voice_id||T.id},T.voice_id||T.id||T.name))})]})]}),e.jsxs("div",{children:[e.jsx(ne,{children:"Friendly name (optional)"}),e.jsx(we,{value:_,onChange:T=>V(T.target.value),placeholder:"e.g., Victoria's Intro"})]})]}),e.jsxs(ts,{children:[e.jsx(M,{variant:"outline",onClick:()=>$(!1),children:"Cancel"}),e.jsx(M,{disabled:ie||!ee||!q,onClick:async()=>{if(G){xe(!0);try{const T=G.segment_type,U=T==="intro"||T==="outro"||T==="commercial"?T:"sfx",Y=await Nn({text:ee,voice_id:q,provider:"elevenlabs",category:U,friendly_name:_&&_.trim()?_.trim():void 0,speaking_rate:w&&!Number.isNaN(w)?w:void 0}),O=Y?.filename;if(!O)throw new Error("TTS did not return a filename");const L={id:Y?.id||crypto.randomUUID(),filename:O,friendly_name:Y?.friendly_name||_||O,category:U,content_type:"audio/mpeg"};D(fe=>[...fe,L]),Be(G.id,{source_type:"static",filename:O}),Ae(fe=>({...fe,[G.id]:!0}));try{dt({title:"TTS created",description:"Audio saved to Media and linked to this segment."})}catch{}$(!1)}catch(T){const U=T?.message||String(T);f(U);try{dt({variant:"destructive",title:"TTS failed",description:U})}catch{}}finally{xe(!1)}}},children:ie?"Creating…":"Create"})]})]})})]})}const Cn=({segment:s,onDelete:a,onSourceChange:r,mediaFiles:l,isDragging:n,onOpenTTS:o,justCreated:m,templateVoiceId:k,token:i})=>{const u=l[s.segment_type]||[],[y,f]=t.useState(!1),h=(s?.source?.filename||"").trim(),D=u.find(ee=>ee.filename===h),d=/\.(mp3|wav|m4a|aac|flac|ogg)$/i.test(h),N=!!h&&(h.toLowerCase().startsWith("file-")||!d),j=!h||!D,[S,v]=t.useState(h),[p,b]=t.useState(!1),[A,W]=t.useState(null);t.useEffect(()=>{const ee=s?.source?.voice_id;if(!ee){W(null);return}let I=!1;return(async()=>{try{const te=await ge(i).get(`/api/elevenlabs/voice/${encodeURIComponent(ee)}/resolve`),w=te?.common_name||te?.name||null;I||W(w)}catch{}})(),()=>{I=!0}},[s?.source?.voice_id,i]);const $=(ee,I)=>{const q={...s.source,[ee]:I};ee==="source_type"&&(q.prompt=void 0,q.script=void 0,I==="static"&&(q.filename=""),I==="tts"&&(q.voice_id=s?.source?.voice_id||k||null,q.text_prompt=s?.source?.text_prompt||"",delete q.filename)),r(s.id,q)};if(s.segment_type==="content")return e.jsxs(_e,{className:`transition-shadow ${n?"shadow-2xl scale-105":"shadow-md"} border-green-500 border-2`,children:[e.jsxs(Me,{className:"flex flex-row items-center justify-between p-4 bg-green-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(da,{className:"w-5 h-5 text-gray-400"}),Os.content,e.jsx("span",{className:"font-semibold text-green-800",children:"Main Content"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Cannot be deleted"})]}),e.jsx(Se,{className:"p-6",children:e.jsx("p",{className:"text-gray-600 italic",children:"The main content for your episode will be added here during episode creation. This block serves as a placeholder for its position in the template."})})]});const G=s?.source?.source_type,Q=G==="ai_generated"||G==="tts"&&(typeof s?.source?.script=="string"||typeof s?.source?.prompt=="string");return e.jsxs(_e,{className:`transition-shadow ${n?"shadow-2xl scale-105":"shadow-md"}`,children:[e.jsxs(Me,{className:"flex flex-row items-center justify-between p-4 bg-gray-100 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(da,{className:"w-5 h-5 text-gray-400"}),Os[s.segment_type],e.jsx("span",{className:"font-semibold text-gray-800",children:s.segment_type.charAt(0).toUpperCase()+s.segment_type.slice(1)}),m?e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-700 border border-blue-200",children:"Created from TTS"}):null,s?.source?.source_type==="static"&&j&&e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-yellow-50 text-yellow-800 border border-yellow-200",title:N?"This looks like a temporary file id. Please relink.":"The referenced audio file could not be found. Relink to fix.",children:"Missing audio file"})]}),e.jsx(M,{variant:"ghost",size:"icon",onClick:a,className:"text-red-500 hover:bg-red-100 hover:text-red-700 w-8 h-8",children:e.jsx(zt,{className:"w-4 h-4"})})]}),e.jsxs(Se,{className:"p-6 space-y-4",children:[Q&&e.jsxs("div",{className:"p-3 rounded-md border border-yellow-200 bg-yellow-50 text-yellow-800 flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-sm",children:"Legacy segment type. Convert to file (recommended)."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{size:"sm",variant:"outline",onClick:()=>{const ee={script:s?.source?.script||s?.source?.prompt||"",voice_id:s?.source?.voice_id||void 0,speaking_rate:s?.source?.speaking_rate||void 0,friendly_name:`${s.segment_type.charAt(0).toUpperCase()+s.segment_type.slice(1)} TTS – Legacy`};o(ee)},children:"Convert now"}),e.jsx(M,{size:"sm",variant:"ghost",children:"Keep legacy"})]})]}),e.jsxs("div",{children:[e.jsx(ne,{className:"text-sm font-medium text-gray-600",children:"Audio Source"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx("div",{className:"flex-1",children:e.jsxs(Nt,{value:s?.source?.source_type||"static",onValueChange:ee=>$("source_type",ee),children:[e.jsx(bt,{className:"w-full mt-1",children:e.jsx(_t,{placeholder:"Select source type..."})}),e.jsxs(jt,{children:[e.jsxs(ct,{value:"static",children:[ya.static," Audio file (upload or choose)"]}),e.jsxs(ct,{value:"tts",children:[ya.tts," Per Episode TTS"]})]})]})}),e.jsxs(M,{type:"button",variant:"outline",onClick:()=>o(),children:[e.jsx(Vt,{className:"w-4 h-4 mr-2"}),"Create with TTS (one-time)"]}),s?.source?.source_type==="static"&&j&&e.jsx(M,{type:"button",variant:"secondary",size:"sm",onClick:()=>{v(h||""),f(!0)},children:"Relink"})]})]}),e.jsxs("div",{children:[s?.source?.source_type==="static"&&e.jsxs("div",{children:[e.jsx(ne,{children:"Audio File"}),e.jsxs(Nt,{value:D?s.source.filename:"",onValueChange:ee=>$("filename",ee),children:[e.jsx(bt,{className:"w-full mt-1",children:e.jsx(_t,{placeholder:`Select a ${s.segment_type} file...`})}),e.jsx(jt,{children:u.map(ee=>e.jsx(ct,{value:ee.filename,children:ee.friendly_name||ee.filename.split("_").slice(1).join("_")},ee.id))})]})]}),s?.source?.source_type==="tts"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(ne,{children:"Prompt Label (shown during episode creation)"}),e.jsx(we,{value:s?.source?.text_prompt||"",onChange:ee=>$("text_prompt",ee.target.value),placeholder:"e.g., Intro script"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(ne,{children:"Default Voice (optional)"}),e.jsx("div",{className:"text-sm text-gray-800 mt-1",children:A||s?.source?.voice_id||"Not set"})]}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>b(!0),children:"Choose voice"})]}),p&&e.jsx(us,{value:s?.source?.voice_id||k||null,onChange:ee=>$("voice_id",ee),onSelect:ee=>W(ee?.common_name||ee?.name||null),onClose:()=>b(!1),token:i}),e.jsx("p",{className:"text-xs text-gray-500",children:"This will create a text box during episode creation. The audio is generated per episode."})]})]})]}),e.jsx(ms,{open:y,onOpenChange:f,children:e.jsxs(Zt,{className:"sm:max-w-[520px]",children:[e.jsxs(es,{children:[e.jsx(ss,{children:"Relink audio file"}),e.jsx(Lt,{children:"Choose an existing audio item to replace the missing reference."})]}),e.jsx("div",{className:"space-y-3 py-2",children:e.jsxs("div",{children:[e.jsx(ne,{children:"Select file"}),e.jsxs(Nt,{value:S||"",onValueChange:v,children:[e.jsx(bt,{className:"mt-1",children:e.jsx(_t,{placeholder:`Select a ${s.segment_type} file...`})}),e.jsx(jt,{children:u.map(ee=>e.jsx(ct,{value:ee.filename,children:ee.friendly_name||ee.filename.split("_").slice(1).join("_")},ee.id))})]}),u.length===0&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"No files available for this section yet."})]})}),e.jsxs(ts,{children:[e.jsx(M,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(M,{disabled:!S,onClick:()=>{S&&(r(s.id,{source_type:"static",filename:S}),f(!1))},children:"Save"})]})]})})]})},Es=t.forwardRef(({className:s,value:a,...r},l)=>e.jsx(Ga,{ref:l,className:Fe("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",s),...r,children:e.jsx(Ni,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));Es.displayName=Ga.displayName;function kn({token:s,templates:a,onApply:r}){const[l,n]=t.useState([]),[o,m]=t.useState("1"),[k,i]=t.useState("09:00"),[u,y]=t.useState(""),[f,h]=t.useState(!1);t.useEffect(()=>{ge(s).get("/api/recurring/schedules").then(n).catch(()=>{})},[s]);const D=async()=>{h(!0);try{const N=ge(s);await N.post("/api/recurring/schedules",{day_of_week:parseInt(o),time_of_day:k,template_id:u});const j=await N.get("/api/recurring/schedules");n(j)}finally{h(!1)}},d=async N=>{await ge(s).del(`/api/recurring/schedules/${N}`),n(l.filter(S=>S.id!==N))};return e.jsxs(_e,{className:"mb-6",children:[e.jsx(Me,{children:e.jsx(Re,{children:"Recurring Episode Slots"})}),e.jsxs(Se,{children:[e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4 items-end",children:[e.jsxs("div",{className:"flex flex-col w-28",children:[e.jsx(ne,{htmlFor:"recurring-day",className:"text-xs mb-1",children:"Day"}),e.jsx("select",{id:"recurring-day","aria-label":"Day of week",className:"border rounded px-2 py-1 text-sm",value:o,onChange:N=>m(N.target.value),children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map((N,j)=>e.jsx("option",{value:j,children:N},j))})]}),e.jsxs("div",{className:"flex flex-col w-32",children:[e.jsx(ne,{className:"text-xs mb-1",children:"Time"}),e.jsx(we,{type:"time",value:k,onChange:N=>i(N.target.value),className:"h-9"})]}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-[160px]",children:[e.jsx(ne,{htmlFor:"recurring-template",className:"text-xs mb-1",children:"Template"}),e.jsxs("select",{id:"recurring-template","aria-label":"Template",className:"border rounded px-2 py-1 text-sm",value:u,onChange:N=>y(N.target.value),children:[e.jsx("option",{value:"",children:"Select..."}),a.map(N=>e.jsx("option",{value:N.id,children:N.name},N.id))]})]}),e.jsx("div",{className:"flex",children:e.jsx(M,{onClick:D,disabled:f||!u,children:f?"Adding...":"Add"})})]}),e.jsx("ul",{className:"space-y-2",children:l.map(N=>e.jsxs("li",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{children:[["Mon","Tue","Wed","Thu","Fri","Sat","Sun"][N.day_of_week]," ",N.time_of_day," — ",a.find(j=>j.id===N.template_id)?.name||N.template_id]}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>r&&r(N),children:"Apply"}),e.jsx(M,{size:"sm",variant:"destructive",onClick:()=>d(N.id),children:"Delete"})]},N.id))})]})]})}function En({src:s,height:a=96,start:r,end:l,onReady:n,onMarkersChange:o,onCut:m,markerEnd:k}){const i=t.useRef(null),u=t.useRef(null),y=t.useRef(null),[f,h]=t.useState(null),[D,d]=t.useState(!1);t.useEffect(()=>{if(!i.current)return;const S=an.create({container:i.current,waveColor:"#9CA3AF",progressColor:"#1F2937",cursorColor:"#111827",height:a,normalize:!0,backend:"webaudio"}),v=S.registerPlugin(rn.create());u.current=S,y.current=v,S.on("ready",()=>{typeof n=="function"&&n(S);try{h(S.getDuration())}catch{}if(typeof r=="number"){const p=Math.max(0,r),b=typeof l=="number"&&l>p?l:p+.2;v.clear(),v.addRegion({id:"cut",start:p,end:b,color:"rgba(239, 68, 68, 0.25)",drag:!0,resize:!0})}}),S.on("play",()=>d(!0)),S.on("pause",()=>d(!1)),S.on("finish",()=>d(!1)),v.on("region-updated",p=>{p.id==="cut"&&typeof o=="function"&&o({start:p.start,end:p.end})}),v.on("region-created",p=>{p.id==="cut"&&typeof o=="function"&&o({start:p.start,end:p.end})}),v.on("region-removed",p=>{p.id==="cut"&&typeof o=="function"&&o({start:void 0,end:void 0})});try{S.load(s)}catch{}return()=>{try{S.destroy()}catch{}u.current=null,y.current=null,h(null),d(!1)}},[s,a]),t.useEffect(()=>{const S=y.current;if(!u.current||!S)return;const p=S.getRegions().find(b=>b.id==="cut");if(typeof r=="number"){const b=Math.max(0,r),A=typeof l=="number"&&l>b?l:b+.2;p?p.setOptions({start:b,end:A}):S.addRegion({id:"cut",start:b,end:A,color:"rgba(239, 68, 68, 0.25)",drag:!0,resize:!0})}else p&&p.remove()},[r,l]);const N=()=>{const S=u.current;if(S)try{S.playPause()}catch{}},j=()=>{if(typeof m!="function")return;const S=u.current;if(!S)return;let v=0;try{v=S.getCurrentTime()||0}catch{}m(v)};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:i}),typeof k=="number"&&f&&f>0&&e.jsx("div",{style:{position:"absolute",top:0,bottom:0,width:"2px",backgroundColor:"rgba(239,68,68,0.9)",left:`${Math.max(0,Math.min(1,k/f))*100}%`,pointerEvents:"none"}})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:N,className:"px-2 py-1 text-xs rounded border bg-white hover:bg-gray-50",children:D?"Pause":"Play"}),typeof m=="function"&&e.jsx("button",{type:"button",onClick:j,className:"px-2 py-1 text-xs rounded border bg-red-50 text-red-700 hover:bg-red-100",children:"Cut"})]})]})}function An({contexts:s,open:a,onConfirm:r,onCancel:l}){const[n,o]=t.useState(()=>{const d={};return(s||[]).forEach(N=>{d[N.flubber_index]=!0}),d}),[m,k]=t.useState(null),[i,u]=t.useState({}),y=t.useMemo(()=>(s||[]).filter(d=>n[d.flubber_index]),[s,n]),f=t.useMemo(()=>[...y].sort((d,N)=>(d.flubber_time_s||0)-(N.flubber_time_s||0)),[y]);if(!a)return null;const h=()=>f.map(d=>{const N=d.flubber_index,j=i[N]||{},S=typeof j.startAbs=="number"?j.startAbs:Math.max(0,(d.flubber_time_s||0)-.75),v=d.computed_end_s??(d.flubber_end_s||d.flubber_time_s||0)+.2,p=Math.max(S+.05,typeof j.endAbs=="number"?j.endAbs:v);return[Math.round(S*1e3),Math.round(p*1e3)]}),D=f.length>=1;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs(_e,{className:"w-full max-w-3xl max-h-[80vh] overflow-hidden",children:[e.jsxs(Me,{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Re,{className:"text-base",children:"Review Retakes (Flubber)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{variant:"ghost",size:"sm",onClick:l,children:"Close"}),e.jsxs(M,{size:"sm",disabled:!D,onClick:()=>r(h()),children:[e.jsx(ds,{className:"w-4 h-4 mr-1"}),"Apply Selected"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-700",children:[e.jsx("div",{children:"Click Play, seek on waveform, then press Cut to mark from now to auto end."}),e.jsxs("span",{className:"ml-auto",children:["Marked: ",f.length]})]})]}),e.jsxs(Se,{className:"space-y-3 overflow-y-auto",children:[(!s||s.length===0)&&e.jsx("div",{className:"text-xs text-gray-600",children:"No flubber instances detected."}),(s||[]).map(d=>{const N=m===d.flubber_index;return e.jsxs("div",{className:`border rounded p-2 flex flex-col gap-2 bg-white ${N?"border-green-500":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-[11px] font-mono",children:["t=",Number(d.flubber_time_s||0).toFixed(2),"s window [",Number(d.snippet_start_s||0).toFixed(1)," – ",Number(d.snippet_end_s||0).toFixed(1),"]"]}),e.jsx("div",{className:"flex items-center gap-2",children:n[d.flubber_index]?e.jsxs(M,{size:"xs",variant:"outline",onClick:()=>{o(j=>({...j,[d.flubber_index]:!1})),u(j=>{const S={...j};return delete S[d.flubber_index],S})},children:[e.jsx(Cs,{className:"w-3.5 h-3.5 mr-1"}),"Uncut"]}):e.jsxs(M,{size:"xs",onClick:()=>{const j=audioRefs.current[d.flubber_index],S=j&&typeof j.currentTime=="number"?j.currentTime:0,v=Math.max(0,(d.snippet_start_s||0)+S),p=d.computed_end_s??(d.flubber_end_s||d.flubber_time_s||0)+.2;u(b=>({...b,[d.flubber_index]:{startAbs:v,endAbs:p}})),o(b=>({...b,[d.flubber_index]:!0})),k(d.flubber_index)},children:[e.jsx(ds,{className:"w-3.5 h-3.5 mr-1"}),"Cut"]})})]}),d.url?e.jsxs("div",{className:"space-y-2",children:[e.jsx(En,{src:d.url,height:80,start:n[d.flubber_index]&&i[d.flubber_index]?.startAbs!=null?i[d.flubber_index].startAbs-(d.snippet_start_s||0):void 0,end:n[d.flubber_index]&&i[d.flubber_index]?.endAbs!=null?i[d.flubber_index].endAbs-(d.snippet_start_s||0):void 0,markerEnd:(d.computed_end_s??(d.flubber_end_s||d.flubber_time_s||0)+.2)-(d.snippet_start_s||0),onMarkersChange:({start:j,end:S})=>{if(typeof j=="number"){const v=Math.max(0,(d.snippet_start_s||0)+j);k(d.flubber_index),u(p=>({...p,[d.flubber_index]:{...p[d.flubber_index]||{},startAbs:v}}))}if(typeof S=="number"){const v=Math.max(0,(d.snippet_start_s||0)+S);u(p=>({...p,[d.flubber_index]:{...p[d.flubber_index]||{},endAbs:v}}))}},onCut:j=>{const S=Math.max(0,(d.snippet_start_s||0)+(j||0)),v=d.computed_end_s??(d.flubber_end_s||d.flubber_time_s||0)+.2;u(p=>({...p,[d.flubber_index]:{...p[d.flubber_index]||{},startAbs:S,endAbs:v}})),o(p=>({...p,[d.flubber_index]:!0})),k(d.flubber_index)}}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] text-gray-600",children:[e.jsxs("div",{children:["Auto end: ",(d.computed_end_s??(d.flubber_end_s||0)+.2).toFixed(2),"s"]}),e.jsx("div",{className:"flex gap-2"})]})]}):e.jsx("div",{className:"text-[11px] text-gray-500",children:"Snippet not available"})]},d.flubber_index)})]})]})})}function Tn({open:s,onSubmit:a,onCancel:r,hide:l}){const[n,o]=t.useState({flubber:"no",intern:"no",sfx:"no"});if(t.useEffect(()=>{s&&o({flubber:"no",intern:"no",sfx:"no"})},[s]),!s)return null;const m=l||{},k=["flubber","intern","sfx"].filter(y=>!m[y]).every(y=>["yes","no","unknown"].includes(n[y])),i=({name:y,label:f})=>e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsx("div",{className:"w-64 text-[13px]",children:f}),["yes","no","unknown"].map(h=>e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:y,value:h,checked:n[y]===h,onChange:()=>o(D=>({...D,[y]:h}))}),e.jsx("span",{className:"capitalize",children:h==="unknown"?"I Don't Remember":h})]},h))]}),u=()=>a({flubber:m.flubber?"no":n.flubber,intern:m.intern?"no":n.intern,sfx:m.sfx?"no":n.sfx});return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs(_e,{className:"w-full max-w-2xl",children:[e.jsx(Me,{className:"flex items-center justify-between",children:e.jsx(Re,{className:"text-base",children:"Before We Start"})}),e.jsxs(Se,{className:"space-y-4",children:[!m.flubber&&e.jsx(i,{name:"flubber",label:"Is there a Flubber?"}),!m.intern&&e.jsx(i,{name:"intern",label:"Is there an Intern?"}),!m.sfx&&e.jsx(i,{name:"sfx",label:"Are there any word Sound Effects?"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx(M,{variant:"ghost",onClick:r,children:"Cancel"}),e.jsx(M,{onClick:u,disabled:!k,children:"Continue"})]})]})]})})}const jr=t.forwardRef(function({sourceFile:a,existingUrl:r,value:l,onChange:n,disabled:o,onModeChange:m},k){const i=t.useRef(null),u=t.useRef(null),[y,f]=t.useState(null),[h,D]=t.useState({w:0,h:0}),[d,N]=t.useState({x:0,y:0,size:0}),[j,S]=t.useState(()=>{try{return localStorage.getItem("ppp_cover_mode")||"crop"}catch{return"crop"}}),[v,p]=t.useState(!1),b=t.useRef({dx:0,dy:0}),A=t.useRef(null);t.useEffect(()=>{if(a){const w=URL.createObjectURL(a);return f(w),()=>URL.revokeObjectURL(w)}f(r||null)},[a,r]);const W=t.useCallback(()=>{const w=i.current;if(!w)return;const P=w.naturalWidth,_=w.naturalHeight;if(D({w:P,h:_}),!a&&l){const V=l.split(",").map(K=>parseFloat(K.trim()));if(V.length===4&&V.every(K=>!isNaN(K))){const[K,ue,ie,xe]=V,de=Math.min(P,_,Math.max(0,ie-K),Math.max(0,xe-ue));N({x:Math.max(0,K),y:Math.max(0,ue),size:de});return}}if(a){const V=Math.min(P,_),K=(P-V)/2,ue=(_-V)/2;N({x:K,y:ue,size:V})}},[l]);t.useEffect(()=>{if(!a)return;if(j==="pad"){n?.(null);return}if(!h.w||!d.size)return;const w=Math.round(d.x),P=Math.round(d.y),_=Math.round(d.x+d.size),V=Math.round(d.y+d.size),K=`${w},${P},${_},${V}`;A.current!==K&&(A.current=K,n?.(K))},[d,h,j,n]);const $=w=>{if(o||j!=="crop"||!a||!i.current||!u.current)return;w.preventDefault();const P=u.current.getBoundingClientRect(),_=i.current.getBoundingClientRect(),V=w.clientX-_.left,K=w.clientY-_.top,ue=h.w?_.width/h.w:1,ie=d.x*ue,xe=d.y*ue,de=d.size*ue;V>=ie&&V<=ie+de&&K>=xe&&K<=xe+de&&(b.current={dx:V-ie,dy:K-xe,imageOffsetX:_.left-P.left,imageOffsetY:_.top-P.top},p(!0))},G=w=>{if(!v||o||!i.current)return;const P=i.current.getBoundingClientRect(),_=w.clientX-P.left,V=w.clientY-P.top,K=h.w?P.width/h.w:1;let ue=(_-b.current.dx)/K,ie=(V-b.current.dy)/K;ue=Math.max(0,Math.min(ue,h.w-d.size)),ie=Math.max(0,Math.min(ie,h.h-d.size)),N(xe=>({...xe,x:ue,y:ie}))},Q=()=>p(!1);t.useEffect(()=>(window.addEventListener("mousemove",G),window.addEventListener("mouseup",Q),()=>{window.removeEventListener("mousemove",G),window.removeEventListener("mouseup",Q)}),[G]);const ee=w=>{const P=parseFloat(w.target.value);if(!h.w)return;const _=Math.min(h.w,h.h),V=Math.max(10,Math.min(_,P)),K=d.x+d.size/2,ue=d.y+d.size/2;let ie=K-V/2,xe=ue-V/2;ie=Math.max(0,Math.min(ie,h.w-V)),xe=Math.max(0,Math.min(xe,h.h-V)),N(de=>({...de,x:ie,y:xe,size:V}))},I=()=>(Math.min(h.w,h.h),Math.round(d.size)),q=(()=>{try{if(!i.current||!h.w)return null;const w=document.createElement("canvas");if(!(j==="pad"?Math.max(h.w,h.h):d.size))return null;w.width=200,w.height=200;const _=w.getContext("2d");if(j==="pad"){const V=Math.max(h.w,h.h);_.fillStyle="#FFFFFF",_.fillRect(0,0,200,200);const K=200/V,ue=(V-h.w)/2,ie=(V-h.h)/2;_.drawImage(i.current,0,0,h.w,h.h,ue*K,ie*K,h.w*K,h.h*K)}else{const V=200/d.size;_.drawImage(i.current,d.x,d.y,d.size,d.size,0,0,200,200)}return w.toDataURL("image/png")}catch{return null}})(),te=t.useCallback(()=>{if(!i.current||!h.w)return null;const w=j==="pad"?Math.max(h.w,h.h):d.size||Math.min(h.w,h.h);if(!w)return null;const P=document.createElement("canvas");P.width=w,P.height=w;const _=P.getContext("2d");if(j==="pad"){_.fillStyle="#FFFFFF",_.fillRect(0,0,w,w);const V=(w-h.w)/2,K=(w-h.h)/2;_.drawImage(i.current,V,K,h.w,h.h)}else _.drawImage(i.current,d.x,d.y,d.size,d.size,0,0,w,w);return new Promise(V=>P.toBlob(K=>V(K),"image/png",.92))},[d,h,j]);return t.useImperativeHandle(k,()=>({async getProcessedBlob(){return await te()},getMode(){return j}}),[te,j]),t.useEffect(()=>{m?.(j);try{localStorage.setItem("ppp_cover_mode",j)}catch{}},[j,m]),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{ref:u,className:"relative border rounded overflow-hidden max-h-72 bg-gray-50 flex items-center justify-center",style:{cursor:v?"grabbing":"grab",userSelect:"none"},onMouseDown:$,children:[y?e.jsx("img",{ref:i,src:y,alt:"Cover",onLoad:W,className:"max-w-full max-h-72 select-none",draggable:!1}):e.jsx("div",{className:"text-xs text-gray-500 p-4",children:"No image selected"}),y&&d.size>0&&j==="crop"&&(()=>{if(!i.current||!u.current)return null;const w=i.current.getBoundingClientRect(),P=u.current.getBoundingClientRect(),_=w.width||1,V=w.height||1,K=w.left-P.left,ue=w.top-P.top,ie=_/h.w,xe=V/h.h,de=K+d.x*ie,Ae=ue+d.y*xe,qe=d.size*ie,Ke=d.size*xe;return e.jsx("div",{className:"absolute border-2 border-blue-500/90 shadow-[0_0_0_9999px_rgba(0,0,0,0.35)] box-content",style:{left:de,top:Ae,width:qe,height:Ke},title:"Drag to move. Use slider to resize."})})()]}),h.w>0&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[11px]",children:[e.jsx("button",{type:"button",disabled:o||!a,onClick:()=>S("crop"),className:`px-2 py-1 rounded border ${j==="crop"?"bg-blue-600 text-white border-blue-600":"bg-white"} ${a?"":"opacity-40 cursor-not-allowed"}`,children:"Crop"}),e.jsx("button",{type:"button",disabled:o||!a,onClick:()=>S("pad"),className:`px-2 py-1 rounded border ${j==="pad"?"bg-blue-600 text-white border-blue-600":"bg-white"} ${a?"":"opacity-40 cursor-not-allowed"}`,children:"Pad"}),e.jsx("span",{className:"text-gray-500",children:"Mode"})]}),j==="crop"&&a&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-[10px] uppercase tracking-wide text-gray-500",children:"Crop Size (pixels)"}),e.jsx("input",{type:"range",min:10,max:Math.min(h.w,h.h),value:I(),onChange:ee,disabled:o}),e.jsxs("div",{className:"text-[11px] text-gray-500",children:[Math.round(d.size),"px square • Drag box to reposition."]})]}),j==="pad"&&a&&e.jsxs("div",{className:"text-[11px] text-gray-500",children:["Entire image will be centered on white square (",Math.max(h.w,h.h),"px)."]})]}),q&&e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("div",{className:"text-[11px] text-gray-500",children:"Preview:"}),e.jsx("img",{src:q,alt:"Crop preview",className:"w-16 h-16 rounded border object-cover"}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Stored as ",l||""]})]})]})});function vr({onBack:s,token:a,templates:r,podcasts:l,initialStep:n,testInject:o,preselectedMainFilename:m,preselectedTranscriptReady:k}){const{user:i}=St(),[u,y]=t.useState(n||1),[f,h]=t.useState(null),[D,d]=t.useState(null),[N,j]=t.useState(null),[S,v]=t.useState(!1),[p,b]=t.useState(!1),[A,W]=t.useState(!1),[$,G]=t.useState(!1),[Q,ee]=t.useState(null),[I,q]=t.useState(null),[te,w]=t.useState(""),[P,_]=t.useState(""),[V,K]=t.useState({}),[ue,ie]=t.useState([]),[xe,de]=t.useState(!1),[Ae,qe]=t.useState(null),[Ke,He]=t.useState(null),[tt,Je]=t.useState(!1),[Le,Ve]=t.useState({flubber:null,intern:null,sfx:null}),[Ye,ze]=t.useState(!1),[Ue,Be]=t.useState({has_elevenlabs:!1,has_google_tts:!1,has_any_sfx_triggers:!1}),[Xe,B]=t.useState(!1),[re,le]=t.useState(.8),[ce,T]=t.useState(!1),[U,Y]=t.useState(null),[O,L]=t.useState({season:"1",episodeNumber:"",title:"",description:"",coverArt:null,coverArtPreview:null,cover_image_path:null,cover_crop:null}),[fe,be]=t.useState(!1),[Oe,x]=t.useState(!1),F=t.useRef({title:null,notes:null,tags:null}),c=t.useRef(""),C=t.useRef(!1),[E,z]=t.useState(null),[Z,H]=t.useState([]),[se,ye]=t.useState(null),[me,Ce]=t.useState("draft"),[ke,Ee]=t.useState("public"),[Pe,lt]=t.useState(""),[st,Qe]=t.useState(""),[Ge,at]=t.useState(!1),[yt,Rt]=t.useState(null),[ae,he]=t.useState(!1),[ve,Te]=t.useState(!1),[De,$e]=t.useState(null),[it,ut]=t.useState({}),[mt,Ft]=t.useState(!1),Ut=t.useRef(null),Ct=t.useRef(null),$t=t.useRef(null),[Bt,R]=t.useState(!1),[je,We]=t.useState("crop"),[nt,ot]=t.useState(!1),[kt,ht]=t.useState(null);t.useEffect(()=>{let g=!1;try{m&&!N&&(j(m),y(5),k===!0&&(he(!0),C.current=!0),g=!0)}catch{}if(!g){try{const X=localStorage.getItem("ppp_uploaded_filename"),J=localStorage.getItem("ppp_uploaded_hint"),pe=localStorage.getItem("ppp_start_step"),oe=localStorage.getItem("ppp_transcript_ready");N||(X?j(X):J&&j(J)),pe==="5"&&y(5),oe==="1"&&(he(!0),C.current=!0)}catch{}try{localStorage.removeItem("ppp_start_step"),localStorage.removeItem("ppp_transcript_ready")}catch{}}},[m]),t.useEffect(()=>{if(o)try{o.selectedTemplate&&h(o.selectedTemplate),o.uploadedFilename&&j(o.uploadedFilename),typeof o.transcriptReady=="boolean"&&he(!!o.transcriptReady),o.episodeDetails&&L(g=>({...g,...o.episodeDetails}))}catch{}},[o]),t.useEffect(()=>{if(f||!Array.isArray(r))return;const g=r.filter(X=>X?.is_active!==!1);g.length===1&&(h(g[0]),u===1&&y(2))},[r,f,u]),t.useEffect(()=>{const g=ge(a);(async()=>{try{const J=await g.get("/api/media/");ie(J)}catch(J){_(J.message)}})(),Ur(),(async()=>{try{if(!!!(i&&(i.is_admin||i.role==="admin"))){T(!1);return}const pe=await g.get("/api/admin/settings");pe&&typeof pe.test_mode<"u"&&T(!!pe.test_mode)}catch{T(!1)}})(),(async()=>{try{const J=await g.get("/api/billing/usage");J&&Y(J)}catch{}})(),(async()=>{try{const J=await g.get("/api/users/me/capabilities");J&&Be({has_elevenlabs:!!J.has_elevenlabs,has_google_tts:!!J.has_google_tts,has_any_sfx_triggers:!!J.has_any_sfx_triggers})}catch{}})()},[a,i]),t.useEffect(()=>{if(!D){ht(null);return}let g=null;const X=new Audio,J=()=>{const oe=X&&isFinite(X.duration)?X.duration:null;ht(oe&&oe>0?oe:null),g&&URL.revokeObjectURL(g)},pe=()=>{ht(null),g&&URL.revokeObjectURL(g)};X.addEventListener("loadedmetadata",J),X.addEventListener("error",pe);try{g=URL.createObjectURL(D),X.src=g,X.load()}catch{if(ht(null),g)try{URL.revokeObjectURL(g)}catch{}}return()=>{if(X.removeEventListener("loadedmetadata",J),X.removeEventListener("error",pe),g)try{URL.revokeObjectURL(g)}catch{}}},[D]);const Et=t.useMemo(()=>{if(!ve||!De||!f?.segments)return null;try{return f.segments.find(g=>g.id===De)||null}catch{return null}},[ve,De,f]),Yt=g=>{De&&h(X=>{if(!X?.segments)return X;const J=X.segments.map(pe=>pe.id===De&&pe?.source?.source_type==="tts"?{...pe,source:{...pe.source,voice_id:g}}:pe);return{...X,segments:J}})};t.useEffect(()=>{if(u!==3)return;const g=new Set;try{(f?.segments||[]).forEach(pe=>{if(pe?.source?.source_type==="tts"&&pe?.source?.voice_id){const oe=String(pe.source.voice_id);oe&&oe.toLowerCase()!=="default"&&g.add(oe)}})}catch{}if(!g.size)return;let X=!0;for(const pe of g)if(!it[pe]){X=!1;break}if(X)return;let J=!1;return(async()=>{try{Ft(!0);const pe=await ks("",1,200),oe={};for(const Ie of pe?.items||[]){const xt=Ie.common_name||Ie.name||"";xt&&(oe[Ie.voice_id]=xt)}J||ut(Ie=>({...Ie,...oe}));const Ne=Array.from(g).filter(Ie=>Ie&&Ie.toLowerCase()!=="default"&&!oe[Ie]);if(Ne.length){const Ie=ge(a);for(const xt of Ne)try{const rt=await Ie.get(`/api/elevenlabs/voice/${encodeURIComponent(xt)}/resolve`),At=rt?.common_name||rt?.name||"";At&&!J&&ut(vt=>({...vt,[xt]:At}))}catch{}}}catch{}finally{J||Ft(!1)}})(),()=>{J=!0}},[u,f?.id,a]);const qt=t.useMemo(()=>{if(!kt||!isFinite(kt)||kt<=0)return null;const g=kt/60,X=Math.max(0,Math.floor(g*.75)),J=Math.max(1,Math.ceil(g*1.25));return{low:X,high:J}},[kt]),Ks=t.useRef(!1);t.useEffect(()=>{try{const g=localStorage.getItem("ppp_publish_mode");g&&["now","draft","schedule"].includes(g)&&Ce(g),Ks.current=!!g;const X=localStorage.getItem("ppp_publish_visibility");X&&["public","unpublished"].includes(X)&&Ee(X),localStorage.getItem("ppp_explicit_flag")==="true"&&L(vt=>({...vt,is_explicit:!0}));const pe=localStorage.getItem("ppp_schedule_datetime");let oe;if(pe){const vt=new Date(pe);!isNaN(vt.getTime())&&vt.getTime()>Date.now()+10*6e4&&(oe=vt)}if(!oe){oe=new Date(Date.now()+60*6e4);const vt=oe.getMinutes(),ca=Math.ceil(vt/5)*5;ca>=60?(oe.setHours(oe.getHours()+1),oe.setMinutes(0)):oe.setMinutes(ca),oe.setSeconds(0,0)}const Ne=oe.getFullYear(),Ie=String(oe.getMonth()+1).padStart(2,"0"),xt=String(oe.getDate()).padStart(2,"0"),rt=String(oe.getHours()).padStart(2,"0"),At=String(oe.getMinutes()).padStart(2,"0");lt(`${Ne}-${Ie}-${xt}`),Qe(`${rt}:${At}`)}catch{}},[]),t.useEffect(()=>{try{if(f?.ai_settings?.auto_generate_tags===!1){const g=localStorage.getItem("ppp_last_tags");g&&!O.tags&&L(X=>({...X,tags:g}))}}catch{}},[f]),t.useEffect(()=>{Ks.current||Ce(ce?"draft":"now")},[ce]),t.useEffect(()=>{try{localStorage.setItem("ppp_publish_mode",me)}catch{}},[me]),t.useEffect(()=>{try{localStorage.setItem("ppp_publish_visibility",ke)}catch{}},[ke]),t.useEffect(()=>{try{if(Pe&&st){const g=new Date(`${Pe}T${st}:00`).toISOString();localStorage.setItem("ppp_schedule_datetime",g)}}catch{}},[Pe,st]),t.useEffect(()=>{try{localStorage.setItem("ppp_explicit_flag",O.is_explicit?"true":"false")}catch{}},[O.is_explicit]),t.useEffect(()=>{try{f?.ai_settings?.auto_generate_tags===!1&&O.tags?localStorage.setItem("ppp_last_tags",O.tags):localStorage.removeItem("ppp_last_tags")}catch{}},[O.tags,f]),t.useEffect(()=>{if(u!==5||!f||!ae)return;const g=`${N||""}|${I||""}|${f?.id||""}`;if(c.current===g)return;const X=!!f?.ai_settings?.auto_fill_ai,J=f?.ai_settings?.auto_generate_tags!==!1,pe=f?.ai_settings?.tags_always_include||[];(async()=>{try{if(X&&!O.title){be(!0);const oe=await Zs();oe&&!/[a-f0-9]{16,}/i.test(oe)&&It("title",oe)}}finally{be(!1)}try{if(X&&!O.description?.length){x(!0);const oe=await ea();oe&&!/[a-f0-9]{16,}/i.test(oe)&&It("description",oe)}}finally{x(!1)}if(J){const oe=await Yr(),Ne=new Set,Ie=[];for(const xt of[...pe,...oe]){const rt=String(xt).trim();if(!rt)continue;const At=rt.toLowerCase();if(Ne.has(At)||(Ne.add(At),Ie.push(rt)),Ie.length>=20)break}Ie.sort((xt,rt)=>xt.localeCompare(rt)),It("tags",Ie.join(", "))}c.current=g})()},[u,f?.id,ae,N,I]),t.useEffect(()=>{C.current=ae},[ae]),t.useEffect(()=>{F.current={title:null,notes:null,tags:null},c.current="",u===5&&he(!1)},[N,I,f?.id]),t.useEffect(()=>{if(u!==5||!N&&!I||ae)return;let g=!1;const X=ge(a),J=async()=>{if(!g){try{const oe=[];I&&oe.push(`episode_id=${encodeURIComponent(I)}`),N&&oe.push(`hint=${encodeURIComponent(N)}`);const Ne=`/api/ai/transcript-ready${oe.length?`?${oe.join("&")}`:""}`;if((await X.get(Ne))?.ready){he(!0);return}}catch{}g||setTimeout(J,5e3)}},pe=setTimeout(J,250);return()=>{g=!0,clearTimeout(pe)}},[u,N,I,a,ae]),t.useEffect(()=>{if(f||!Array.isArray(r))return;const g=r.filter(X=>X?.is_active!==!1);g.length===1&&(h(g[0]),u===1&&y(2))},[r,f,u]),t.useEffect(()=>{(async()=>{try{const X=await ge(a).get("/api/episodes/last/numbering");X&&(X.season_number||X.episode_number)&&L(J=>{if(J.episodeNumber||J.season!=="1")return J;const pe=X.season_number?String(X.season_number):"1",oe=X.episode_number?String(Number(X.episode_number)+1):"1";return{...J,season:pe,episodeNumber:oe}})}catch{}})()},[a]);const Ur=async()=>{};t.useEffect(()=>{if(!E)return;const g=ge(a),X=setInterval(async()=>{try{const J=await g.get(`/api/episodes/status/${E}`);if(w(J.status),J.status==="processed"||J.status==="error")if(clearInterval(X),b(!1),J.status==="processed"){if(J.episode&&I&&J.episode.id&&J.episode.id!==I){b(!0),setTimeout(()=>{z(pe=>pe)},750);return}G(!0),ee(J.episode),me==="schedule"?dt({title:"Scheduled",description:"Episode assembled & ready to schedule."}):me==="draft"&&dt({title:"Draft Ready",description:"Episode assembled (draft)."})}else _(J.error||"An error occurred during processing."),dt({variant:"destructive",title:"Error",description:J.error||"An error occurred during processing."})}catch{clearInterval(X),_("Failed to poll for job status."),b(!1)}},5e3);return()=>clearInterval(X)},[E,a]);const Js=[{number:1,title:"Select Template",icon:ua},{number:2,title:"Upload Audio",icon:Ai},{number:3,title:"Customize Segments",icon:Ts},{number:4,title:"Cover Art",icon:ma},{number:5,title:"Details & Schedule",icon:Vs},{number:6,title:"Assemble",icon:Fs}],Br=(u-1)/(Js.length-1)*100,Or=async g=>{try{const J=await ge(a).get(`/api/templates/${g.id}`),oe={...g,...J,ai_settings:{...{auto_fill_ai:!0,title_instructions:"",notes_instructions:"",tags_instructions:"",tags_always_include:[],auto_generate_tags:!0},...J?.ai_settings||g?.ai_settings||{}}},Ne=Array.isArray(oe.segments)?[...oe.segments]:[],Ie=Ne.find(rt=>rt?.source?.source_type==="tts"&&rt?.source?.voice_id)?.source?.voice_id||null,xt=Ne.map(rt=>rt?.source?.source_type==="tts"?{...rt,source:{...rt.source,voice_id:rt.source.voice_id||Ie||rt.source.voice_id}}:rt);h({...oe,segments:xt})}catch{const X={auto_fill_ai:!0,title_instructions:"",notes_instructions:"",tags_instructions:"",tags_always_include:[],auto_generate_tags:!0};h(J=>({...g||J,ai_settings:{...X,...(g||{}).ai_settings||{}}}))}y(2)},Qs=async g=>{if(!g)return;const X=1024*1024;if(!(g.type||"").toLowerCase().startsWith("audio/")){_("Please select an audio file.");return}if(g.size>500*X){_("Audio exceeds 500MB limit.");return}d(g),v(!0),w("Uploading audio file..."),_("");const J=new FormData;J.append("files",g),J.append("friendly_names",JSON.stringify([g.name]));try{const Ne=(await ge(a).raw("/api/media/upload/main_content",{method:"POST",body:J}))[0]?.filename;j(Ne),w("Upload successful!"),Je(!0)}catch(pe){_(pe.message),w(""),d(null)}finally{v(!1)}},Wr=async g=>{if(!(g?.type||"").toLowerCase().startsWith("image/"))throw new Error("Cover must be an image file.");if(g.size>10*1048576)throw new Error("Cover image exceeds 10MB limit.");const pe=new FormData;pe.append("files",g),pe.append("friendly_names",JSON.stringify([g.name]));const Ie=(await ge(a).raw("/api/media/upload/episode_cover",{method:"POST",body:pe}))?.[0]?.filename;if(!Ie)throw new Error("Cover upload: no filename returned.");return L(xt=>({...xt,cover_image_path:Ie})),Ie},As=g=>{g&&(L(X=>({...X,coverArt:g,coverArtPreview:null,cover_image_path:null})),R(!0))},Xs=async()=>{if(!(!O.coverArt||!$t.current))try{ot(!0);const g=await $t.current.getProcessedBlob();if(!g)throw new Error("Could not process image.");const X=new File([g],O.coverArt.name.replace(/\.[^.]+$/,"")+"-square.png",{type:"image/png"});await Wr(X);const J=new FileReader;J.onloadend=()=>{L(pe=>({...pe,coverArtPreview:J.result}))},J.readAsDataURL(g),R(!1),dt({title:"Cover saved",description:"Square cover uploaded."})}catch(g){dt({variant:"destructive",title:"Cover upload failed",description:g.message||String(g)})}finally{ot(!1)}},Vr=(g,X)=>{K(J=>({...J,[g]:X}))},It=(g,X)=>{L(J=>({...J,[g]:X}))},Zs=async(g={})=>{if(!!!g.force&&F.current.title)return F.current.title;const J=ge(a),pe={episode_id:I||crypto.randomUUID(),podcast_id:f?.podcast_id,transcript_path:null,hint:N||null,base_prompt:"",extra_instructions:f?.ai_settings?.title_instructions||""};let oe="";try{oe=(await J.post("/api/ai/title",pe))?.title||""}catch(Ne){if(Ne&&Ne.status===409){he(!1);try{dt({title:"Transcript not ready",description:"Transcript not ready yet — still processing",variant:"default"})}catch{}return""}try{if(Ne&&Ne.status===429)dt({variant:"destructive",title:"AI Title error",description:"Too many requests — please slow down and try again."});else{const Ie=Ne&&Ne.status?` (${Ne.status})`:"";dt({variant:"destructive",title:"AI Title error",description:`Request failed${Ie}. Please try again.`})}}catch{}return""}return F.current.title=oe,oe},ea=async(g={})=>{if(!!!g.force&&F.current.notes)return F.current.notes;const J=ge(a),pe={episode_id:I||crypto.randomUUID(),podcast_id:f?.podcast_id,transcript_path:null,hint:N||null,base_prompt:"",extra_instructions:f?.ai_settings?.notes_instructions||""};let oe="";try{oe=(await J.post("/api/ai/notes",pe))?.description||""}catch(Ne){if(Ne&&Ne.status===409){he(!1);try{dt({title:"Transcript not ready",description:"Transcript not ready yet — still processing",variant:"default"})}catch{}return""}try{if(Ne&&Ne.status===429)dt({variant:"destructive",title:"AI Description error",description:"Too many requests — please slow down and try again."});else{const Ie=Ne&&Ne.status?` (${Ne.status})`:"";dt({variant:"destructive",title:"AI Description error",description:`Request failed${Ie}. Please try again.`})}}catch{}return""}return F.current.notes=oe,oe},Yr=async()=>{if(F.current.tags)return F.current.tags;const g=ge(a),X={episode_id:I||crypto.randomUUID(),podcast_id:f?.podcast_id,transcript_path:null,hint:N||null,tags_always_include:f?.ai_settings?.tags_always_include||[]},J=await g.post("/api/ai/tags",X),pe=Array.isArray(J?.tags)?J.tags:[];return F.current.tags=pe,pe},qr=async()=>{if(!fe){be(!0);try{const g=await Zs({force:!0});g&&!/[a-f0-9]{16,}/i.test(g)&&It("title",g)}finally{be(!1)}}},Hr=async()=>{if(!Oe){x(!0);try{const X=(await ea({force:!0})||"").replace(/^(?:\*\*?)?description:?(\*\*)?\s*/i,"").replace(/^#+\s*description\s*/i,"").trim();X&&It("description",X)}finally{x(!1)}}},Gr=g=>{if(!g)return[];let X=Array.isArray(g)?g:String(g).split(",");const J=[];for(let pe of X){const oe=String(pe).trim();if(!oe)continue;let Ne=oe.slice(0,30);if(J.includes(Ne)||J.push(Ne),J.length>=20)break}return J},Kr=async()=>{if(sa){_("Monthly episode quota reached. Upgrade your plan to continue."),window.dispatchEvent(new Event("ppp:navigate-billing"));return}if(!N||!f||!O.title){_("A template, title, and audio file are required.");return}if((!O.season||!String(O.season).trim())&&L(g=>({...g,season:"1"})),me==="schedule"){if(!Pe||!st){_("Pick date & time for scheduling");return}const g=new Date(`${Pe}T${st}:00`);if(isNaN(g.getTime())||g.getTime()<Date.now()+10*6e4){_("Scheduled time must be at least 10 minutes in the future.");return}}if(O.coverArt&&!O.cover_image_path)try{w("Processing cover before assembly..."),await Xs()}catch{_("Cover processing failed; you can retry or remove the cover.");return}G(!1),ee(null),at(!1),q(null),b(!0),w("Assembling your episode..."),_(""),y(6);try{const g=ge(a),X={title:O.title,description:O.description,season:O.season,episodeNumber:O.episodeNumber,cover_image_path:O.cover_image_path||null,explicit:O.is_explicit||!1,tags:Gr(O.tags)};let J;try{J=await g.post("/api/episodes/assemble",{template_id:f.id,main_content_filename:N,output_filename:O.title.toLowerCase().replace(/\s+/g,"-"),tts_values:V,episode_details:X,flubber_cuts_ms:Array.isArray(Ke)&&Ke.length?Ke:null,intents:Le})}catch(pe){if(pe&&pe.status===402){const oe="Monthly episode quota reached. Upgrade your plan to continue.";_(oe),w(""),dt({variant:"destructive",title:"Quota Reached",description:oe}),b(!1),window.dispatchEvent(new Event("ppp:navigate-billing"));return}throw pe}J.episode_id&&q(J.episode_id),z(J.job_id),at(!0),w(`Episode assembly has been queued. Job ID: ${J.job_id}`)}catch(g){_(g.message),w(""),b(!1)}},Jr=g=>{He(g||[]),de(!1),y(3)},Qr=()=>{He([]),de(!1),y(3)},Xr=async g=>{Ve(g),Je(!1);try{if(N&&(g.flubber==="yes"||g.flubber==="unknown")){w("Scanning for retakes (flubber)..."),ze(!0);const X=ge(a),J={filename:N,intents:{flubber:g.flubber}};let pe=[];try{for(let oe=0;oe<20;oe++){try{const Ne=await X.post("/api/flubber/prepare-by-file",J);pe=Array.isArray(Ne?.contexts)?Ne.contexts:[];break}catch(Ne){if(Ne&&Ne.status===425){await new Promise(Ie=>setTimeout(Ie,1e3));continue}break}await new Promise(Ne=>setTimeout(Ne,1e3))}}catch{}if(ze(!1),pe.length>0){qe(pe),de(!0);return}if(g.flubber==="yes"){B(!0);return}}}catch{}ze(!1),y(3)},ta=U?.episodes_remaining_this_month;U?.max_episodes_month;const sa=typeof ta=="number"&&ta<=0,aa=U?.processing_minutes_used_this_month,hs=U?.max_processing_minutes_month,ps=typeof hs=="number"&&typeof aa=="number"?hs-aa:null,ra=typeof ps=="number"&&typeof hs=="number"&&ps>0&&ps<=Math.ceil(hs*.1),ia=!O.title||!O.title.trim(),na=!O.episodeNumber||!String(O.episodeNumber).trim(),la=sa,oa=!ia&&!na&&!la;t.useEffect(()=>{if(u!==5||!ce)return;const g=new Date,X=String(g.getHours()).padStart(2,"0"),J=String(g.getMinutes()).padStart(2,"0"),pe=`${X}${J}`,oe=String(g.getDate()),Ne=(()=>{try{if(D?.name)return D.name.replace(/\.[^./\\]+$/,"");if(N)return String(N).replace(/\.[^./\\]+$/,"")}catch{}return"Episode"})();L(Ie=>({...Ie,title:Ie.title&&Ie.title.trim()?Ie.title:`Test - ${Ne}`,season:oe,episodeNumber:pe}))},[u,D,N,ce]),t.useEffect(()=>{if(!$||!Ge||!Q)return;if(yt&&Q.id===yt){at(!1);return}if(me==="draft"){at(!1),w("Draft created (processing complete).");return}let g=me==="schedule",X=null,J=null;if(g){const pe=new Date(`${Pe}T${st}:00`);if(!isNaN(pe.getTime())&&pe.getTime()>Date.now()+9*6e4)X=pe.toISOString().replace(/\.\d{3}Z$/,"Z"),J=`${Pe} ${st}`;else{dt({variant:"destructive",title:"Schedule invalid",description:"Falling back to draft."}),at(!1);return}}(async()=>{W(!0);try{await Zr({scheduleEnabled:g,publish_at:X,publish_at_local:J})}finally{W(!1),at(!1)}})()},[$,Ge,Q]);const Zr=async({scheduleEnabled:g,publish_at:X,publish_at_local:J})=>{let pe=se;if(!pe&&f&&f.podcast_id&&(pe=f.podcast_id),!pe){dt({variant:"destructive",title:"Missing show",description:"Template needs a show association."});return}const Ne={spreaker_show_id:pe,publish_state:g?"unpublished":ke};X&&(Ne.publish_at=X,J&&(Ne.publish_at_local=J));try{const Ie=ge(a);let xt=await Ie.post(`/api/episodes/${Q.id}/publish`,Ne);const rt=g?"Episode scheduled successfully.":"Episode published successfully.";dt({title:"Publish",description:rt}),w(rt);try{Q?.id&&Rt(Q.id)}catch{}try{const At=await Ie.get(`/api/episodes/${Q.id}/publish/status`);At.spreaker_episode_id?w(vt=>vt.includes("Spreaker ID")?vt:vt+" (Spreaker ID "+At.spreaker_episode_id+")"):At.last_error&&dt({variant:"destructive",title:"Publish downstream error",description:At.last_error})}catch{}}catch(Ie){dt({variant:"destructive",title:"Publish failed",description:Ie.message||String(Ie)})}},ei=()=>{switch(u){case 1:return e.jsxs("div",{className:"space-y-8",children:[e.jsx(Me,{className:"text-center",children:e.jsx(Re,{style:{color:"#2C3E50"},children:"Step 1: Choose a Template"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(g=>e.jsx(_e,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>Or(g),children:e.jsxs(Se,{className:"p-6 text-center space-y-4",children:[e.jsx(ua,{className:"w-12 h-12 mx-auto text-blue-600"}),e.jsx("h3",{className:"text-xl font-semibold",children:g.name}),e.jsx("p",{className:"text-gray-500 text-sm",children:g.description||"No description available."})]})},g.id))})]});case 2:return e.jsxs("div",{className:"space-y-8",children:[e.jsx(Me,{className:"text-center",children:e.jsx(Re,{style:{color:"#2C3E50"},children:"Step 2: Upload Main Content"})}),e.jsx(_e,{className:"border-2 border-dashed border-gray-200 bg-white",children:e.jsx(Se,{className:"p-8",children:e.jsxs("div",{className:"border-2 border-dashed rounded-xl p-12 text-center",onDragOver:g=>g.preventDefault(),onDrop:g=>{g.preventDefault(),g.dataTransfer.files[0]&&Qs(g.dataTransfer.files[0])},children:[D?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ti,{className:"w-16 h-16 mx-auto text-green-600"}),e.jsx("p",{className:"text-xl font-semibold text-green-600",children:"File Ready!"}),e.jsx("p",{className:"text-gray-600",children:D.name})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Vt,{className:"w-16 h-16 mx-auto text-gray-400"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-700",children:"Drag your audio file here"}),e.jsx("p",{className:"text-gray-500",children:"or"}),e.jsx(M,{onClick:()=>Ut.current?.click(),size:"lg",className:"text-white",style:{backgroundColor:"#2C3E50"},disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-5 h-5 mr-2 animate-spin"})," Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"w-5 h-5 mr-2"})," Choose Audio File"]})})]}),e.jsx("input",{ref:Ut,type:"file",accept:"audio/*",onChange:g=>Qs(g.target.files[0]),className:"hidden"})]})})}),e.jsx("div",{className:"flex justify-start pt-8",children:e.jsxs(M,{onClick:()=>y(1),variant:"outline",size:"lg",children:[e.jsx(pt,{className:"w-5 h-5 mr-2"}),"Back to Templates"]})})]});case 3:{const g=X=>{if(X.segment_type==="content")return e.jsxs("div",{className:"mt-2 bg-blue-50 p-3 rounded-md",children:[e.jsx("p",{className:"font-semibold text-blue-800",children:"Your Uploaded Audio:"}),e.jsx("p",{className:"text-gray-700",children:D?.name||"No file uploaded"})]});if(X.source.source_type==="tts"){const J=X?.source?.voice_id||"",pe=it[J];return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-gray-500",title:J||void 0,children:["Voice: ",pe||J||"default",mt&&!pe?"…":""]}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>{$e(X.id),Te(!0)},children:"Change voice"})]}),e.jsx(ne,{htmlFor:X.id,className:"text-sm font-medium text-gray-700 mb-2 block",children:X.source.text_prompt||"TTS Script"}),e.jsx(Wt,{id:X.id,placeholder:"Enter text to be converted to speech...",className:"min-h-[100px] resize-none text-base bg-white",value:V[X.id]||"",onChange:oe=>Vr(X.id,oe.target.value)})]})}if(X.source.source_type==="static"){const J=ue.find(oe=>oe.filename.endsWith(X.source.filename)),pe=J?J.friendly_name:X.source.filename;return e.jsxs("p",{className:"text-gray-600 mt-2",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Audio File:"})," ",pe]})}return e.jsx("p",{className:"text-red-500 mt-2",children:"Unknown segment source type"})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs(Me,{className:"text-center",children:[e.jsx(Re,{style:{color:"#2C3E50"},children:"Step 3: Customize Your Episode"}),e.jsx("p",{className:"text-md text-gray-500 pt-2",children:"Review the structure and fill in the required text for any AI-generated segments."})]}),e.jsx(_e,{className:"border-0 shadow-lg bg-white",children:e.jsx(Se,{className:"p-6 space-y-4",children:f&&f.segments?f.segments.map((X,J)=>e.jsxs("div",{className:"p-4 rounded-md bg-gray-50 border border-gray-200",children:[e.jsx("h4",{className:"font-semibold text-lg text-gray-800 capitalize",children:X.segment_type.replace("_"," ")}),g(X)]},X.id||J)):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-lg text-gray-600",children:"This template has no segments to display."})})})}),e.jsxs("div",{className:"flex justify-between pt-8",children:[e.jsxs(M,{onClick:()=>y(2),variant:"outline",size:"lg",children:[e.jsx(pt,{className:"w-5 h-5 mr-2"}),"Back to Upload"]}),e.jsxs(M,{onClick:()=>y(4),size:"lg",className:"px-8 py-3 text-lg font-semibold text-white",style:{backgroundColor:"#2C3E50"},children:["Continue to Details",e.jsx(pt,{className:"w-5 h-5 ml-2 rotate-180"})]})]})]})}case 4:return e.jsxs("div",{className:"space-y-8",children:[e.jsx(Me,{className:"text-center",children:e.jsx(Re,{style:{color:"#2C3E50"},children:"Step 4: Cover Art"})}),e.jsx(_e,{className:"border-0 shadow-lg bg-white",children:e.jsx(Se,{className:"p-8 space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[!O.coverArt&&!O.coverArtPreview&&e.jsxs("div",{className:"border-2 border-dashed rounded-xl p-10 text-center",onDragOver:g=>g.preventDefault(),onDrop:g=>{g.preventDefault(),g.dataTransfer.files[0]&&As(g.dataTransfer.files[0])},children:[e.jsx(ma,{className:"w-16 h-16 mx-auto text-gray-400"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Drag & drop a cover image or click below."}),e.jsxs(M,{className:"mt-4",variant:"outline",onClick:()=>Ct.current?.click(),children:[e.jsx(rs,{className:"w-4 h-4 mr-2"}),"Choose Image"]}),e.jsx("input",{ref:Ct,type:"file",accept:"image/*",onChange:g=>As(g.target.files[0]),className:"hidden"}),e.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"Recommended: ≥1400x1400 JPG/PNG."})]}),O.coverArt&&!O.coverArtPreview&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(jr,{ref:$t,sourceFile:O.coverArt,existingUrl:null,value:O.cover_crop,onChange:g=>L(X=>({...X,cover_crop:g})),onModeChange:g=>We(g)}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>Ct.current?.click(),children:[e.jsx(rs,{className:"w-4 h-4 mr-1"}),"Replace"]}),e.jsx(M,{size:"sm",variant:"ghost",onClick:()=>{L(g=>({...g,coverArt:null,coverArtPreview:null,cover_image_path:null,cover_crop:null})),R(!1)},children:"Remove"}),Bt&&e.jsx("span",{className:"text-xs text-amber-600 font-medium",children:"Will upload on Continue"})]})]}),O.coverArtPreview&&e.jsxs("div",{className:"flex flex-col md:flex-row gap-10 items-start",children:[e.jsx("div",{className:"w-48 h-48 rounded-lg overflow-hidden border bg-gray-50",children:e.jsx("img",{src:O.coverArtPreview,alt:"Cover preview",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("p",{className:"text-gray-600",children:["Square cover uploaded",O.cover_image_path&&e.jsxs(e.Fragment,{children:[" as ",e.jsx("span",{className:"text-green-600",children:O.cover_image_path})]}),"."]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>{Ct.current?.click()},children:[e.jsx(rs,{className:"w-4 h-4 mr-1"}),"Replace"]}),e.jsx(M,{size:"sm",variant:"ghost",onClick:()=>{L(g=>({...g,coverArt:null,coverArtPreview:null,cover_image_path:null,cover_crop:null})),R(!1)},children:"Remove"})]}),e.jsx("input",{ref:Ct,type:"file",accept:"image/*",onChange:g=>As(g.target.files[0]),className:"hidden"})]})]})]})})}),e.jsxs("div",{className:"flex justify-between pt-8",children:[e.jsxs(M,{onClick:()=>y(3),variant:"outline",size:"lg",children:[e.jsx(pt,{className:"w-5 h-5 mr-2"}),"Back"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(M,{onClick:()=>y(5),variant:"outline",size:"lg",children:"Skip"}),e.jsxs(M,{onClick:async()=>{O.coverArt&&Bt&&await Xs(),y(5)},size:"lg",disabled:nt,className:"px-8 py-3 text-lg font-semibold text-white disabled:opacity-70",style:{backgroundColor:"#2C3E50"},children:[Bt?"Upload & Continue":"Continue"," ",e.jsx(pt,{className:"w-5 h-5 ml-2 rotate-180"})]})]})]})]});case 5:return e.jsxs("div",{className:"space-y-8",children:[e.jsx(Me,{className:"text-center",children:e.jsx(Re,{style:{color:"#2C3E50"},children:"Step 5: Episode Details & Scheduling"})}),e.jsx(_e,{className:"border-0 shadow-lg bg-white",children:e.jsxs(Se,{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:e.jsxs("div",{className:"col-span-2 md:col-span-1",children:[e.jsx(ne,{htmlFor:"title",children:"Episode Title *"}),e.jsx(we,{id:"title",placeholder:"e.g., The Future of AI",value:O.title,onChange:g=>It("title",g.target.value)}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsxs(M,{type:"button",variant:"secondary",onClick:qr,disabled:!ae||p||A||fe,children:[e.jsx(Ts,{className:"w-4 h-4 mr-1"})," AI Suggest Title"]}),!ae&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(et,{className:"w-3 h-3 animate-spin"})," Waiting for transcript…"]})]})]})}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx(ne,{htmlFor:"season",children:"Season Number *"}),e.jsx(we,{id:"season",type:"number",placeholder:"e.g., 1",value:O.season,onChange:g=>It("season",g.target.value)})]}),e.jsxs("div",{children:[e.jsx(ne,{htmlFor:"episodeNumber",children:"Episode Number *"}),e.jsx(we,{id:"episodeNumber",type:"number",placeholder:"e.g., 12",value:O.episodeNumber,onChange:g=>It("episodeNumber",g.target.value)})]}),e.jsxs("div",{className:"flex items-center pt-6 gap-2",children:[e.jsx("input",{id:"explicitFlag",type:"checkbox",checked:!!O.is_explicit,onChange:g=>It("is_explicit",g.target.checked)}),e.jsx(ne,{htmlFor:"explicitFlag",className:"cursor-pointer",children:"Explicit"})]})]}),e.jsxs("div",{children:[e.jsx(ne,{htmlFor:"description",children:"Episode Description"}),e.jsx(Wt,{id:"description",placeholder:"Describe what this episode is about...",className:"min-h-[120px]",value:O.description,onChange:g=>It("description",g.target.value)}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsxs(M,{type:"button",variant:"secondary",onClick:Hr,disabled:!ae||p||A||Oe,children:[e.jsx(Ts,{className:"w-4 h-4 mr-1"})," AI Suggest Description"]}),!ae&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(et,{className:"w-3 h-3 animate-spin"})," Waiting for transcript…"]})]})]}),e.jsxs("div",{children:[e.jsx(ne,{htmlFor:"tags",children:"Tags (comma separated, max 20)"}),e.jsx(Wt,{id:"tags",placeholder:"tag1, tag2",className:"min-h-[64px]",value:O.tags||"",onChange:g=>It("tags",g.target.value)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Each tag ≤30 chars. Enforced on publish."})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[e.jsx(ne,{className:"font-medium",children:"Publish Options"}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pubmode",value:"now",checked:me==="now",onChange:()=>Ce("now")}),"Publish Immediately (after assembly)"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pubmode",value:"draft",checked:me==="draft",onChange:()=>Ce("draft")}),"Save as Draft (no publish)"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"pubmode",value:"schedule",checked:me==="schedule",onChange:()=>Ce("schedule")}),"Schedule Publish"]})]}),me==="schedule"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-date",className:"text-xs font-medium mb-1 block",children:"Date"}),e.jsx("input",{id:"schedule-date","aria-label":"Schedule date",type:"date",className:"border rounded p-2 w-full",value:Pe,onChange:g=>lt(g.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"schedule-time",className:"text-xs font-medium mb-1 block",children:"Time"}),e.jsx("input",{id:"schedule-time","aria-label":"Schedule time",type:"time",step:300,className:"border rounded p-2 w-full",value:st,onChange:g=>Qe(g.target.value)})]}),e.jsx("div",{className:"col-span-2 text-xs text-gray-500",children:"Must be ≥10 minutes in the future. Converted to UTC automatically."})]}),me==="now"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-xs font-medium",children:"Visibility:"}),e.jsxs("div",{className:"flex gap-4 mt-1 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"vis",value:"public",checked:ke==="public",onChange:()=>Ee("public")}),"Public"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"radio",name:"vis",value:"unpublished",checked:ke==="unpublished",onChange:()=>Ee("unpublished")}),"Private"]})]})]})]})]})}),e.jsxs("div",{className:"flex justify-between pt-8",children:[e.jsxs(M,{onClick:()=>y(4),variant:"outline",size:"lg",children:[e.jsx(pt,{className:"w-5 h-5 mr-2"}),"Back"]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs(M,{onClick:Kr,disabled:!oa||p,size:"lg",className:"px-8 py-3 text-lg font-semibold text-white disabled:opacity-70",style:{backgroundColor:"#2C3E50"},children:[p?"Assembling...":"Assemble & Review",e.jsx(pt,{className:"w-5 h-5 ml-2 rotate-180"})]}),!oa&&e.jsx("div",{className:"text-xs text-red-600 mt-2 max-w-sm text-right",children:la?"Quota exceeded – upgrade or wait for reset.":ia?"Enter a title to continue.":na?"Enter an episode number to continue.":""})]})]})]});case 6:return $?e.jsxs("div",{className:"space-y-8",children:[e.jsx(Me,{className:"text-center",children:e.jsxs(Re,{style:{color:"#2C3E50"},children:["Step 6: ",me==="draft"?"Draft Ready":me==="schedule"?"Scheduled":"Completed"]})}),e.jsx(_e,{className:"border-0 shadow-lg bg-white",children:e.jsxs(Se,{className:"p-6 space-y-6",children:[e.jsx("h3",{className:"text-2xl font-bold",children:Q.title}),e.jsx("p",{className:"text-gray-600",children:Q.description}),Q.final_audio_url&&e.jsxs("div",{className:"mt-4",children:[e.jsx(ne,{children:"Listen to the final episode:"}),e.jsx("audio",{controls:!0,src:Q.final_audio_url,className:"w-full mt-2",children:"Your browser does not support the audio element."})]}),e.jsxs("div",{className:"p-4 border rounded bg-gray-50 text-sm",children:[me==="draft"&&"Episode saved as draft.",me==="schedule"&&"Episode assembled and scheduled.",me==="now"&&"Episode assembled; publish dispatched."]}),te&&te.includes("Removed fillers")&&e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:te.split(" | ").slice(1).join(" | ")}),te&&e.jsx("div",{className:"text-sm text-gray-600",children:te}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(M,{onClick:s,children:"Back to Dashboard"})})]})})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsx(Me,{className:"text-center",children:e.jsx(Re,{style:{color:"#2C3E50"},children:"Step 6: Assembly In Progress"})}),e.jsx(_e,{className:"border-0 shadow-lg bg-white",children:e.jsxs(Se,{className:"p-8 space-y-6 text-center",children:[e.jsx(et,{className:"w-16 h-16 mx-auto text-blue-600 animate-spin"}),e.jsx("p",{className:"text-xl font-semibold text-blue-600 mt-4",children:"We're assembling your episode in the background."}),qt?e.jsxs("p",{className:"text-gray-700 max-w-xl mx-auto",children:["Processing time for this episode should be approximately ",qt.low,"-",qt.high," min. You can stay here or go back to the dashboard and we'll let you know when it's done."]}):e.jsx("p",{className:"text-gray-600 max-w-xl mx-auto",children:"You can safely leave this screen. You'll receive a notification when it's ready. This typically takes a few minutes depending on length and cleanup."}),e.jsx("div",{className:"text-sm text-gray-500",children:"If you stay, this page will auto-update when complete."}),e.jsx(M,{onClick:s,variant:"outline",className:"mt-4",children:"Back to Dashboard"})]})})]});default:return e.jsx("div",{children:"Invalid Step"})}};return e.jsxs("div",{className:"bg-gray-50 min-h-screen",children:[Ye&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-md p-6 shadow-lg flex flex-col items-center gap-3",children:[e.jsx(et,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("div",{className:"text-sm text-gray-700",children:"Scanning for retakes (this can take a few minutes on long audio)…"}),e.jsx("div",{className:"flex gap-2 mt-2",children:e.jsx(M,{variant:"outline",size:"sm",onClick:()=>{ze(!1),y(3)},children:"Skip for now"})})]})}),xe&&e.jsx(An,{contexts:Ae||[],open:xe,onConfirm:Jr,onCancel:Qr}),tt&&e.jsx(Tn,{open:tt,onSubmit:Xr,onCancel:()=>{Je(!1),y(3)},hide:{flubber:!1,intern:!(Ue.has_elevenlabs||Ue.has_google_tts),sfx:!Ue.has_any_sfx_triggers}}),Xe&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs(_e,{className:"w-full max-w-md",children:[e.jsx(Me,{children:e.jsx(Re,{className:"text-base",children:"No retakes detected"})}),e.jsxs(Se,{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"You answered “Yes” to Flubber but nothing was found. Try a fuzzier search?"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Fuzzy threshold (0.5–0.95):"}),e.jsx("input",{type:"range",min:.5,max:.95,step:.05,value:re,onChange:g=>le(parseFloat(g.target.value)),className:"w-full"}),e.jsxs("div",{className:"text-xs",children:["Current: ",re.toFixed(2)]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(M,{variant:"ghost",onClick:()=>{B(!1),y(3)},children:"Skip"}),e.jsx(M,{onClick:async()=>{if(B(!1),!N){y(3);return}try{ze(!0);const g=ge(a),X={filename:N,intents:{flubber:"yes"},fuzzy_threshold:re};let J=[];for(let pe=0;pe<20;pe++)try{const oe=await g.post("/api/flubber/prepare-by-file",X);J=Array.isArray(oe?.contexts)?oe.contexts:[];break}catch(oe){if(oe&&oe.status===425){await new Promise(Ne=>setTimeout(Ne,1e3));continue}break}ze(!1),J.length?(qe(J),de(!0)):y(3)}catch{ze(!1),y(3)}},children:"Retry"})]})]})]})}),e.jsx("header",{className:"border-b border-gray-200 px-4 py-6 bg-white shadow-sm sticky top-0 z-10",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(M,{variant:"ghost",className:"text-gray-600",onClick:s,children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsx("h1",{className:"text-3xl font-bold",style:{color:"#2C3E50"},children:"Episode Creator"}),e.jsx("div",{className:"w-48 text-right",children:f&&e.jsxs("span",{className:"text-sm text-gray-500",children:["Template: ",f.name]})})]})})}),e.jsx("div",{className:"px-4 py-6 bg-white border-b border-gray-100",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsx(kn,{token:a,templates:r,onApply:g=>{h(r.find(X=>X.id===g.template_id)),lt("2025-08-19"),Qe(g.time_of_day),Ce("schedule"),y(2)}}),e.jsx(Es,{value:Br,className:"h-2 mb-6"}),e.jsx("div",{className:"flex justify-between",children:Js.map(g=>e.jsxs("div",{className:`flex flex-col items-center transition-all w-40 text-center ${u>=g.number?"text-blue-600":"text-gray-600"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center mb-3 transition-all ${u>=g.number?"text-white shadow-lg":"bg-gray-100 text-gray-600"}`,style:{backgroundColor:u>=g.number?"#2C3E50":void 0},children:u>g.number?e.jsx(Dt,{className:"w-6 h-6"}):e.jsx(g.icon,{className:"w-6 h-6"})}),e.jsx("div",{className:"font-semibold text-sm",children:g.title})]},g.number))})]})}),e.jsx("div",{className:"px-4 py-2 bg-yellow-50 border-b border-yellow-100 text-sm",children:U&&e.jsxs("div",{className:`text-center ${ra?"text-amber-600 font-medium":""}`,children:["Processing minutes remaining this month: ",e.jsx("span",{className:"font-semibold",children:U?.max_processing_minutes_month==null?"∞":ps??"—"}),U?.max_processing_minutes_month==null?" (unlimited during beta)":ra?" (near limit)":""]})}),e.jsx("main",{className:"container mx-auto max-w-6xl px-4 py-8",role:"main","aria-label":"Episode Creator main content",tabIndex:-1,children:ei()}),ve&&Et&&e.jsx(us,{value:Et?.source?.voice_id||null,onChange:g=>Yt(g),onClose:()=>{Te(!1),$e(null)}})]})}function wr({onBack:s,token:a}){const[r,l]=t.useState([]),[n,o]=t.useState(!0),[m,k]=t.useState(null),[i,u]=t.useState([]),[y,f]=t.useState("music"),[h,D]=t.useState(!1),[d,N]=t.useState(null),[j,S]=t.useState(""),[v,p]=t.useState(""),{toast:b}=gt(),A=async()=>{o(!0);try{const P=await ge(a).get("/api/media/");l(P)}catch(w){k(w.message)}finally{o(!1)}};t.useEffect(()=>{a&&A()},[a]);const W=w=>{const V={intro:52428800,outro:52428800,music:52428800,commercial:52428800,sfx:26214400}[y]??50*1048576,K=Array.from(w.target.files||[]),ue=[];for(const ie of K){if(!(ie.type||"").toLowerCase().startsWith("audio/")){b({variant:"destructive",title:"Invalid file type",description:`${ie.name}: only audio files are allowed for ${y}.`});continue}if(ie.size>V){const de=Math.floor(V/1048576);b({variant:"destructive",title:"File too large",description:`${ie.name}: exceeds ${de}MB limit for ${y}.`});continue}ue.push({file:ie,friendly_name:ie.name.split(".").slice(0,-1).join(".")})}u(ue)},$=(w,P)=>{const _=[...i];_[w].friendly_name=P,u(_)},G=async()=>{if(i.length===0)return;D(!0),k(null);const w=new FormData,P=[];for(const _ of i)w.append("files",_.file),P.push(_.friendly_name);w.append("friendly_names",JSON.stringify(P));try{await ge(a).raw(`/api/media/upload/${y}`,{method:"POST",body:w}),u([]),document.getElementById("media-upload").value="",b({title:"Success!",description:"Media uploaded successfully."}),A()}catch(_){k(_.message)}finally{D(!1)}},Q=w=>{N(w.id),S(w.friendly_name||w.filename.split("_").slice(1).join("_")),p(w.trigger_keyword||"")},ee=()=>{N(null),S(""),p("")},I=async w=>{try{const P={friendly_name:j,trigger_keyword:v||null};await ge(a).put(`/api/media/${w}`,P),b({title:"Saved"}),l(V=>V.map(K=>K.id===w?{...K,friendly_name:j,trigger_keyword:v||null}:K)),ee()}catch(P){b({title:"Error",description:P.message,variant:"destructive"})}},q=async w=>{if(window.confirm("Are you sure you want to permanently delete this file?"))try{await ge(a).del(`/api/media/${w}`),l(_=>_.filter(V=>V.id!==w)),b({description:"File deleted."})}catch(P){k(P.message)}},te=t.useMemo(()=>r.reduce((w,P)=>((w[P.category]=w[P.category]||[]).push(P),w),{}),[r]);return e.jsxs("div",{className:"p-6",children:[e.jsxs(M,{onClick:s,variant:"ghost",className:"mb-4",children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsxs(_e,{className:"mb-6",children:[e.jsx(Me,{children:e.jsx(Re,{children:"Upload New Media"})}),e.jsxs(Se,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"media-category",children:"Category"}),e.jsxs(Nt,{value:y,onValueChange:f,children:[e.jsx(bt,{id:"media-category",children:e.jsx(_t,{})}),e.jsx(jt,{children:["intro","outro","music","commercial","sfx"].map(w=>e.jsx(ct,{value:w,children:w.charAt(0).toUpperCase()+w.slice(1)},w))})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(ne,{htmlFor:"media-upload",children:"File(s)"}),e.jsx(we,{id:"media-upload",type:"file",accept:"audio/*",multiple:!0,onChange:W})]})]}),i.length>0&&e.jsxs("div",{className:"space-y-2 pt-4 border-t",children:[e.jsx(ne,{children:"Files to Upload:"}),i.map((w,P)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{value:w.friendly_name,onChange:_=>$(P,_.target.value),className:"flex-grow",placeholder:"Enter a friendly name"}),e.jsx("p",{className:"text-sm text-gray-500 truncate",children:w.file.name})]},P))]}),e.jsx(M,{onClick:G,disabled:h||i.length===0,className:"w-full mt-4",children:h?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"mr-2 h-4 w-4 animate-spin"})," Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"w-4 h-4 mr-2"})," Upload ",i.length," File(s)"]})})]}),m&&e.jsx("p",{className:"text-sm text-red-500 p-6 pt-0",children:m})]}),n&&e.jsx("p",{children:"Loading media library..."}),e.jsx("div",{className:"space-y-6",children:Object.entries(te).map(([w,P])=>e.jsxs(_e,{children:[e.jsx(Me,{children:e.jsx(Re,{className:"capitalize",children:w.replace("_"," ")})}),e.jsx(Se,{children:e.jsx("div",{className:"space-y-2",children:P.map(_=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ns,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}),e.jsx("div",{className:"flex flex-col gap-1",children:d===_.id?e.jsxs(e.Fragment,{children:[e.jsx(we,{value:j,onChange:V=>S(V.target.value),className:"h-8"}),e.jsx(we,{value:v,onChange:V=>p(V.target.value.toLowerCase()),className:"h-8",placeholder:"Trigger keyword (optional)"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:_.friendly_name||_.filename.split("_").slice(1).join("_")}),_.trigger_keyword&&e.jsx("span",{className:"text-[10px] uppercase tracking-wide bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:_.trigger_keyword})]})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[d===_.id?e.jsxs(e.Fragment,{children:[e.jsx(M,{onClick:()=>I(_.id),variant:"ghost",size:"icon",className:"h-8 w-8 text-green-600 hover:text-green-700",children:e.jsx(ws,{className:"w-4 h-4"})}),e.jsx(M,{onClick:ee,variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-500 hover:text-gray-700",children:e.jsx(Ii,{className:"w-4 h-4"})})]}):e.jsx(M,{onClick:()=>Q(_),variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-500 hover:text-gray-700",children:e.jsx(ir,{className:"w-4 h-4"})}),e.jsx(M,{onClick:()=>q(_.id),variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-700",children:e.jsx(zt,{className:"w-4 h-4"})})]})]},_.id))})})]},w))})]})}function In({episodes:s,onEdit:a,onDelete:r,formatPublishAt:l}){const[n,o]=t.useState(null),m=t.useRef({}),k=i=>{if(n&&n!==i){const y=m.current[n];if(y)try{y.pause(),y.currentTime=0}catch{}}const u=m.current[i];if(u)if(n===i&&!u.paused)u.pause(),o(null);else try{u.play(),o(i)}catch{}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"New Grid Concept"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 xl:grid-cols-5 gap-4",children:s.slice(0,15).map(i=>{const u=i.cover_url||`/api/episodes/${i.id}/cover`;return e.jsxs("div",{className:"group relative rounded-lg overflow-hidden border bg-white shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"aspect-square bg-gray-100 relative",children:[e.jsx("img",{src:u,alt:"cover",className:"absolute inset-0 w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-between p-2 text-white",children:[e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx("button",{onClick:()=>a?.(i),className:"bg-white/20 hover:bg-white/30 rounded p-1",title:"Edit",children:e.jsx(Pi,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>r?.(i),className:"bg-white/20 hover:bg-white/30 rounded p-1",title:"Delete",children:e.jsx(zt,{className:"w-4 h-4"})}),e.jsx("button",{className:"bg-white/20 hover:bg-white/30 rounded p-1",title:"More",children:e.jsx(Di,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>k(i.id),className:"bg-white/25 hover:bg-white/40 rounded-full w-10 h-10 flex items-center justify-center mx-auto mb-2",title:"Play preview",children:n===i.id?e.jsx(ys,{className:"w-5 h-5"}):e.jsx(Xt,{className:"w-5 h-5 ml-0.5"})}),e.jsx("div",{className:"text-center text-[10px] font-medium line-clamp-2 leading-tight",children:i.title||"Untitled"})]})]})]}),e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsx("div",{className:"text-xs font-semibold leading-snug line-clamp-2",title:i.title,children:i.title||"Untitled Episode"}),e.jsxs("div",{className:"text-[10px] text-gray-500 flex items-center gap-1",title:i.publish_at||"",children:[i.publish_at&&e.jsx($s,{className:"w-3 h-3"}),i.publish_at?l(i.publish_at):"—"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>k(i.id),className:`text-[10px] px-2 py-1 rounded border inline-flex items-center gap-1 ${n===i.id?"bg-blue-600 text-white border-blue-600":"hover:bg-gray-100"}`,children:[n===i.id?e.jsx(ys,{className:"w-3 h-3"}):e.jsx(Xt,{className:"w-3 h-3"}),n===i.id?"Pause":"Play"]}),typeof i.plays_total=="number"&&e.jsxs("span",{className:"text-[10px] text-gray-500",children:[i.plays_total," plays"]})]}),e.jsx("audio",{ref:y=>{y&&(m.current[i.id]=y)},src:i.playback_url||i.stream_url||i.final_audio_url||"",preload:"none",onEnded:()=>o(y=>y===i.id?null:y),className:"hidden"})]})]},i.id)})})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"New List Concept (Micro Player)"}),e.jsxs("div",{className:"bg-white border rounded-md overflow-hidden divide-y",children:[s.slice(0,20).map(i=>{const u=n===i.id;return e.jsxs("div",{className:"flex items-stretch gap-3 px-3 py-2 hover:bg-gray-50 text-sm",children:[e.jsx("button",{onClick:()=>k(i.id),className:`mt-0.5 rounded-full w-8 h-8 flex items-center justify-center border ${u?"bg-blue-600 text-white border-blue-600":"hover:bg-gray-100"}`,children:u?e.jsx(ys,{className:"w-4 h-4"}):e.jsx(Xt,{className:"w-4 h-4 ml-0.5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"font-medium truncate",title:i.title,children:i.title||"Untitled Episode"}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>a?.(i),className:"text-[11px] text-blue-600 hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>r?.(i),className:"text-[11px] text-red-600 hover:underline",children:"Delete"})]})]}),i.description&&e.jsx("div",{className:"text-[11px] text-gray-500 line-clamp-1",title:i.description,children:i.description}),e.jsxs("div",{className:"mt-1 flex items-center gap-4 text-[10px] text-gray-500",children:[i.publish_at&&e.jsx("span",{children:l(i.publish_at)}),typeof i.plays_total=="number"&&e.jsxs("span",{children:[i.plays_total," plays"]}),i.status&&e.jsx("span",{className:"uppercase tracking-wide text-[9px] font-semibold px-1.5 py-0.5 rounded bg-gray-100 border",children:i.status})]}),e.jsx("audio",{ref:y=>{y&&(m.current[i.id]=y)},src:i.playback_url||i.stream_url||i.final_audio_url||"",preload:"none",onEnded:()=>o(y=>y===i.id?null:y),className:"hidden"})]})]},i.id)}),s.length===0&&e.jsx("div",{className:"px-3 py-6 text-center text-xs text-gray-500",children:"No episodes loaded."})]})]})]})}const Nr=t.forwardRef(({className:s,...a},r)=>e.jsx(Ka,{ref:r,className:Fe("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...a,children:e.jsx(_i,{className:Fe("flex items-center justify-center text-current"),children:e.jsx(rr,{className:"h-4 w-4"})})}));Nr.displayName=Ka.displayName;function Pn({episodeId:s,token:a,onClose:r}){const[l,n]=t.useState(!0),[o,m]=t.useState(""),[k,i]=t.useState([]),[u,y]=t.useState({}),[f,h]=t.useState(!1),[D,d]=t.useState(null),N=async()=>{if(s){n(!0),m(""),d(null);try{const b=await ge(a).get(`/api/flubber/contexts/${s}`);i(b.contexts||[]);const A={};b.contexts?.forEach(W=>{A[W.flubber_index]=!0}),y(A)}catch(p){m(p.message)}finally{n(!1)}}};t.useEffect(()=>{N()},[s]);const j=p=>y(b=>({...b,[p]:!b[p]})),S=async()=>{const p=k.filter(b=>u[b.flubber_index]).map(b=>({start_s:Math.max(0,b.flubber_time_s-.75),end_s:b.flubber_time_s+.25}));if(!p.length){m("No cuts selected");return}h(!0),m(""),d(null);try{const A=await ge(a).post(`/api/flubber/apply/${s}`,p);d(A)}catch(b){m(b.message)}finally{h(!1)}},v=async()=>{if(s){n(!0),m("");try{await ge(a).post(`/api/flubber/prepare/${s}`,{}),await N()}catch(p){m(p.message)}finally{n(!1)}}};return e.jsxs(_e,{className:"mt-4",children:[e.jsxs(Me,{className:"flex flex-row items-center justify-between",children:[e.jsx(Re,{className:"text-base",children:"Manual Flubber Review"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:v,disabled:l,children:[e.jsx(ds,{className:"w-4 h-4 mr-1"}),"Prepare"]}),e.jsxs(M,{variant:"outline",size:"sm",onClick:N,disabled:l,children:[e.jsx(_s,{className:"w-4 h-4 mr-1"}),"Reload"]}),e.jsx(M,{variant:"ghost",size:"sm",onClick:r,children:"Close"})]})]}),e.jsxs(Se,{className:"space-y-4",children:[l&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(et,{className:"w-4 h-4 animate-spin"})," Loading contexts..."]}),o&&e.jsx("div",{className:"text-sm text-red-600",children:o}),!l&&!o&&k.length===0&&e.jsx("div",{className:"text-xs text-gray-500",children:"No flubber contexts found."}),!l&&k.length>0&&e.jsx("div",{className:"space-y-3",children:k.map(p=>e.jsxs("div",{className:"border rounded p-2 flex flex-col gap-2 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs font-mono",children:["t=",p.flubber_time_s.toFixed(2),"s window [",p.snippet_start_s.toFixed(1)," – ",p.snippet_end_s.toFixed(1),"]"]}),e.jsxs("label",{className:"flex items-center gap-1 text-xs cursor-pointer",children:[e.jsx(Nr,{checked:!!u[p.flubber_index],onCheckedChange:()=>j(p.flubber_index)})," Cut"]})]}),e.jsx("audio",{controls:!0,className:"w-full",src:p.url,preload:"metadata"}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Relative flubber @ ",p.relative_flubber_ms,"ms inside snippet"]})]},p.flubber_index))}),k.length>0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(M,{onClick:S,disabled:f,className:"flex items-center gap-1",children:[f?e.jsx(et,{className:"w-4 h-4 animate-spin"}):e.jsx(ds,{className:"w-4 h-4"}),f?"Applying...":"Apply Selected Cuts"]}),D&&e.jsxs("div",{className:"text-xs text-green-600",children:["Removed ",(D.removed_ms/1e3).toFixed(2),"s → ",D.cleaned_audio_new]})]})]})]})}const as=s=>String(s||"").toLowerCase(),Dn=s=>!s||/[zZ]|[+\-]\d{2}:?\d{2}$/.test(s)?s:/\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(s)?s.replace(" ","T")+"Z":/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}$/.test(s)?s+"Z":s,ls=s=>{if(!s)return null;const a=new Date(Dn(s));return isNaN(a.getTime())?null:a},gs=s=>ls(s.publish_at)||ls(s.processed_at)||ls(s.created_at)||new Date(0),ba=s=>{const a=ls(s);return a?Date.now()-a.getTime()<24*3600*1e3:!1},Ms=s=>{if(!s)return"";try{const a=ls(s);if(!a)return s;const r=a.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),l=a.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"}),n=Date.now(),o=Math.round((a.getTime()-n)/6e4);let m="";if(Math.abs(o)<1440*7){if(o>0)m=o<60?`in ${o}m`:o<1440?`in ${Math.round(o/60)}h`:`in ${Math.round(o/60/24)}d`;else if(o<0){const k=Math.abs(o);m=k<60?`${k}m ago`:k<1440?`${Math.round(k/60)}h ago`:`${Math.round(k/60/24)}d ago`}}return`${r} ${l}${m?" · "+m:""}`}catch{return s}};function _r({token:s,onBack:a}){const[r,l]=t.useState([]),[n,o]=t.useState(!1),[m,k]=t.useState(""),[i,u]=t.useState("grid"),[y,f]=t.useState(""),[h,D]=t.useState("all"),[d,N]=t.useState("newest"),[j,S]=t.useState(null),[v,p]=t.useState({title:"",description:"",publish_state:"",tags:"",is_explicit:!1,image_crop:"",cover_file:null,cover_uploading:!1,season_number:null,episode_number:null}),[b,A]=t.useState(!1),[W,$]=t.useState(!1),[G,Q]=t.useState(new Set),[ee,I]=t.useState(null),[q,te]=t.useState(!1),[w,P]=t.useState(""),[_,V]=t.useState(!1),K=x=>{S(x),p({title:x.title||"",description:x.description||"",publish_state:"",tags:(x.tags||[]).join(", "),is_explicit:!!x.is_explicit,image_crop:x.image_crop||"",cover_file:null,cover_uploading:!1,season_number:x.season_number??null,episode_number:x.episode_number??null}),$(!1)},ue=()=>{b||S(null)},ie=()=>j&&(v.title!==(j.title||"")||v.description!==(j.description||"")||v.publish_state&&v.publish_state.trim()!==""||v.tags!==(Array.isArray(j.tags)?j.tags.join(", "):"")||v.is_explicit!==!!j.is_explicit||v.image_crop!==(j.image_crop||"")||!!v.cover_file||v.season_number!==(j.season_number??null)||v.episode_number!==(j.episode_number??null)),xe=t.useRef(null),[de,Ae]=t.useState(null),[qe,Ke]=t.useState(""),[He,tt]=t.useState(""),[Je,Le]=t.useState(!1),[Ve,Ye]=t.useState(""),[ze,Ue]=t.useState(null),Be=async x=>{if(x){l(F=>F.map(c=>c.id===x?{...c,_publishing:!0}:c));try{await ge(s).post(`/api/episodes/${x}/publish`,{publish_state:"public"}),l(c=>c.map(C=>C.id===x?{...C,status:"published",_publishing:!1}:C))}catch(F){const c=Tt(F)?F.detail||F.error||F.message:String(F);alert(c||"Failed to publish"),l(C=>C.map(E=>E.id===x?{...E,_publishing:!1}:E))}}},Xe=x=>{Ae(x),Le(!1),Ye("");const F=new Date(Date.now()+60*6e4),c=F.getFullYear(),C=String(F.getMonth()+1).padStart(2,"0"),E=String(F.getDate()).padStart(2,"0"),z=F.getMinutes(),Z=Math.ceil(z/5)*5;Z>=60&&(F.setHours(F.getHours()+1),F.setMinutes(0));const H=String(F.getHours()).padStart(2,"0"),se=String(Z>=60?0:Z).padStart(2,"0");Ke(`${c}-${C}-${E}`),tt(`${H}:${se}`)},B=()=>{Je||Ae(null)},re=async()=>{if(de){Le(!0),Ye("");try{if(!qe||!He)throw new Error("Date & time required");const x=new Date(`${qe}T${He}:00`);if(isNaN(x.getTime()))throw new Error("Invalid date/time");if(x.getTime()<=Date.now()+60*1e3)throw new Error("Choose a time at least 1 minute in the future");let F=x.toISOString();F=F.replace(/\.\d{3}Z$/,"Z"),l(C=>C.map(E=>E.id===de.id?{...E,_scheduling:!0}:E)),await ge(s).post(`/api/episodes/${de.id}/publish`,{publish_state:"public",publish_at:F,publish_at_local:`${qe} ${He}`}),l(C=>C.map(E=>E.id===de.id?{...E,status:"scheduled",publish_at:F,publish_at_local:`${qe} ${He}`,_scheduling:!1}:E)),Ae(null)}catch(x){const F=Tt(x)?x.detail||x.error||x.message:String(x);Ye(F||"Failed to schedule"),l(c=>c.map(C=>C.id===de.id?{...C,_scheduling:!1}:C))}finally{Le(!1)}}},le=async()=>{if(!j)return;if(!ie()){ue();return}A(!0);const x={};try{v.title!==(j.title||"")&&(x.title=v.title.trim()),v.description!==(j.description||"")&&(x.description=v.description),v.publish_state&&(x.publish_state=v.publish_state);const F=v.tags.split(",").map(z=>z.trim()).filter(Boolean);F.join("")!==(Array.isArray(j.tags)?j.tags.join(""):"")&&(x.tags=F),v.is_explicit!==!!j.is_explicit&&(x.is_explicit=v.is_explicit),v.image_crop!==(j.image_crop||"")&&(x.image_crop=v.image_crop),v.season_number!==(j.season_number??null)&&(x.season_number=v.season_number),v.episode_number!==(j.episode_number??null)&&(x.episode_number=v.episode_number);let c=null;if(v.cover_file){p(z=>({...z,cover_uploading:!0}));try{const z=new FormData;let Z=v.cover_file;if(xe.current)try{const se=await xe.current.getProcessedBlob();se&&(Z=new File([se],v.cover_file.name.replace(/\.[^.]+$/,"")+"-square.png",{type:"image/png"})),xe.current.getMode&&xe.current.getMode()==="pad"&&x.image_crop&&delete x.image_crop}catch{}z.append("file",Z);const H=ge(s);try{const se=await H.raw("/api/media/upload/cover_art",{method:"POST",body:z});c=se?.filename||se?.path||se?.stored_as||null}catch(se){console.warn("Cover upload failed",se)}}catch(z){console.warn("Cover upload error",z)}p(z=>({...z,cover_uploading:!1}))}c&&(x.cover_image_path=c);const E=await ge(s).patch(`/api/episodes/${j.id}`,x);l(z=>z.map(Z=>Z.id===j.id?{...Z,...E?.episode||{},...E?.episode?{}:{title:x.title??Z.title,description:x.description??Z.description,tags:x.tags??Z.tags,is_explicit:x.is_explicit??Z.is_explicit,image_crop:x.image_crop??Z.image_crop,cover_path:c||Z.cover_path,season_number:x.season_number??Z.season_number,episode_number:x.episode_number??Z.episode_number}}:Z)),ue()}catch(F){const c=Tt(F)?F.detail||F.error||F.message:String(F);alert(c||"Failed to save changes")}finally{A(!1)}},ce=t.useCallback(async()=>{o(!0),k("");const x=new AbortController;try{let F=[];const c=ge(s),C=await c.get("/api/episodes/?limit=500",{signal:x.signal});F=Array.isArray(C?.items)?C.items:[];const E=C?.total??F.length;for(let z=F.length;z<E;z+=500){let Z;try{Z=await c.get(`/api/episodes/?limit=500&offset=${z}`,{signal:x.signal})}catch{break}const H=Array.isArray(Z?.items)?Z.items:[];if(!H.length||(F=F.concat(H),H.length<500))break}try{const z=await c.get("/api/spreaker/analytics/plays/episodes?window=last30d",{signal:x.signal});if(Array.isArray(z?.items)&&z.items.length){const Z=new Map(z.items.map(H=>[String(H.episode_id),H.plays_total]));F=F.map(H=>({...H,plays_total:Z.has(String(H.id))?Z.get(String(H.id)):H.plays_total}))}}catch{}l(F)}catch(F){if(F.name!=="AbortError"){const c=Tt(F)?F.detail||F.error||F.message:String(F);k(c||"Failed to load episodes.")}}finally{o(!1)}return()=>x.abort()},[s]);t.useEffect(()=>{ce()},[ce]);const T=x=>{I(x),te(!1),P(""),V(!1)},U=async(x=!1)=>{if(ee){te(!0),P("");try{await ge(s).post(`/api/episodes/${ee.id}/unpublish`,{force:x}),l(c=>c.map(C=>C.id===ee.id?{...C,status:"processed",publish_at:null,spreaker_episode_id:null}:C)),I(null),setTimeout(ce,800)}catch(F){F&&typeof F=="object"&&F.status===409&&V(!0);const c=Tt(F)?F.detail||F.error||F.message:String(F);P(c||"Failed to unpublish")}finally{te(!1)}}},Y=async x=>{if(x&&window.confirm(`Delete this episode permanently? This cannot be undone.
Deleting does not return processing minutes.`)){Q(F=>new Set(F).add(x));try{await ge(s).del(`/api/episodes/${x}`),l(c=>c.filter(C=>C.id!==x))}catch(F){const c=Tt(F)?F.detail||F.error||F.message:String(F);k(c||"Delete failed")}finally{Q(F=>{const c=new Set(F);return c.delete(x),c})}}},O=x=>{switch(as(x)){case"published":return e.jsxs(ft,{className:"bg-green-600 hover:bg-green-600",children:[e.jsx(is,{className:"w-4 h-4 mr-1"}),"Published"]});case"scheduled":return e.jsxs(ft,{className:"bg-purple-600 hover:bg-purple-600",children:[e.jsx($s,{className:"w-4 h-4 mr-1"}),"Scheduled"]});case"processed":return e.jsxs(ft,{className:"bg-blue-600 hover:bg-blue-600",children:[e.jsx(nr,{className:"w-4 h-4 mr-1"}),"Processed"]});case"processing":return e.jsxs(ft,{className:"bg-amber-600 hover:bg-amber-600",children:[e.jsx(et,{className:"w-4 h-4 mr-1 animate-spin"}),"Processing"]});case"error":return e.jsxs(ft,{className:"bg-red-600 hover:bg-red-600",children:[e.jsx(Ys,{className:"w-4 h-4 mr-1"}),"Error"]});default:return e.jsx(ft,{variant:"outline",children:x||"Unknown"})}},L=t.useMemo(()=>{let x=[...r];if(y.trim()){const F=y.trim().toLowerCase();x=x.filter(c=>(c.title||"").toLowerCase().includes(F)||(c.description||"").toLowerCase().includes(F))}switch(h!=="all"&&(x=x.filter(F=>String(F.status||"").toLowerCase()===h)),d){case"oldest":x.sort((F,c)=>gs(F)-gs(c));break;case"title":x.sort((F,c)=>(F.title||"").localeCompare(c.title||""));break;case"status":x.sort((F,c)=>(F.status||"").localeCompare(c.status||""));break;case"plays":x.sort((F,c)=>(c.plays_total||0)-(F.plays_total||0));break;case"newest":default:x.sort((F,c)=>gs(c)-gs(F))}return x},[r,y,h,d]),fe=()=>e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6",children:L.map(x=>{const F=x.cover_url||`/api/episodes/${x.id}/cover`;let c=x.playback_url||x.stream_url||x.final_audio_url||"";c&&!c.startsWith("http")&&!c.startsWith("/")&&(c=`/${c}`);const C=c&&x.final_audio_exists===!1&&x.playback_type!=="stream",E=as(x.status)==="scheduled"||as(x.status)==="published"&&ba(x.publish_at);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_e,{className:"group overflow-hidden border border-gray-200 relative",children:[e.jsxs("div",{className:"w-full h-36 bg-gray-100 flex items-center justify-center relative",children:[e.jsx("img",{src:F,alt:"Cover",className:"w-full h-full object-cover",onError:z=>{z.currentTarget.style.display="none";const Z=z.currentTarget.nextSibling;Z&&(Z.style.display="flex")}}),e.jsxs("div",{className:"hidden w-full h-full items-center justify-center text-gray-400",children:[e.jsx(Li,{className:"w-8 h-8 mr-2"})," No cover"]}),E&&e.jsxs("button",{className:"absolute top-1 left-1 bg-white/85 hover:bg-white text-amber-700 border border-amber-300 rounded p-1 shadow-sm text-[11px] font-medium opacity-0 group-hover:opacity-100 transition-opacity",title:"Unpublish episode (revert to processed)",onClick:()=>T(x),children:[e.jsx(ha,{className:"w-3 h-3 inline mr-1"}),"Unpublish"]}),e.jsx("button",{className:"absolute top-1 right-10 bg-white/80 hover:bg-white text-blue-700 border border-blue-300 rounded p-1 shadow-sm",title:"Manual Flubber Review",onClick:()=>Ue(z=>z===x.id?null:x.id),children:e.jsx(ds,{className:"w-4 h-4"})}),e.jsx("button",{className:"absolute top-1 right-1 bg-white/80 hover:bg-white text-red-600 border border-red-300 rounded p-1 shadow-sm disabled:opacity-50",title:"Delete episode",onClick:()=>Y(x.id),disabled:G.has(x.id),children:G.has(x.id)?e.jsx(et,{className:"w-4 h-4 animate-spin"}):e.jsx(zt,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute bottom-1 left-1 text-[10px] text-gray-600 bg-white/70 px-1 rounded hidden group-hover:block",children:"Deleting doesn’t return minutes."}),x.status==="processed"&&e.jsxs("div",{className:"absolute bottom-1 right-1 flex gap-1",children:[e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white text-[11px] font-medium px-2 py-1 rounded shadow disabled:opacity-60",onClick:()=>Be(x.id),title:"Publish now",children:"Publish"}),e.jsx("button",{className:"bg-purple-600 hover:bg-purple-700 text-white text-[11px] font-medium px-2 py-1 rounded shadow disabled:opacity-60",onClick:()=>Xe(x),title:"Schedule future publication",children:"Schedule"})]})]}),e.jsxs(Me,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx(Re,{className:"text-base font-semibold leading-tight line-clamp-2",title:x.title,children:x.season_number!=null&&x.episode_number!=null?`S${x.season_number}E${x.episode_number} · ${x.title||"Untitled Episode"}`:x.title||"Untitled Episode"}),e.jsx(M,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:()=>K(x),children:"Edit"}),typeof x.plays_total=="number"&&e.jsxs(ft,{variant:"secondary",className:"text-[11px] font-medium",children:[x.plays_total," plays"]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[O(x.status),x.cleanup_stats&&e.jsxs("span",{className:"text-[10px] text-gray-500",children:["FW:",x.cleanup_stats.fillers_removed," PC:",x.cleanup_stats.pauses_compressed]}),x.publish_at&&e.jsxs("span",{className:"text-[11px] text-gray-500 flex items-center gap-1",title:x.publish_at,children:[e.jsx($s,{className:"w-3 h-3"})," ",x.status==="scheduled"?"Publishes":"Publish",": ",Ms(x.publish_at)]}),x.playback_type==="local"&&e.jsx("span",{className:"text-[10px] text-gray-500",children:"Local file"})]})]}),e.jsxs(Se,{className:"space-y-2 pt-0",children:[x.description&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-3",children:x.description}),c?e.jsx("audio",{controls:!0,src:c,className:"w-full",preload:"none"}):e.jsxs("div",{className:"text-gray-500 text-xs flex items-center",children:[e.jsx(Xt,{className:"w-3 h-3 mr-1"}),"No audio"]}),C&&e.jsx("div",{className:"text-[10px] text-red-600",children:"File missing on server"})]})]}),ze===x.id&&e.jsx(Pn,{episodeId:x.id,token:s,onClose:()=>Ue(null)})]},x.id)})}),be=()=>e.jsxs("div",{className:"border border-gray-200 rounded-md overflow-hidden divide-y",children:[e.jsxs("div",{className:"grid grid-cols-12 bg-gray-50 text-[11px] uppercase tracking-wide text-gray-500 px-3 py-2 font-medium",children:[e.jsx("div",{className:"col-span-5",children:"Episode"}),e.jsx("div",{className:"col-span-2",children:"Status"}),e.jsx("div",{className:"col-span-2",children:"Publish"}),e.jsx("div",{className:"col-span-2",children:"Plays"}),e.jsx("div",{className:"col-span-1 text-right",children:"Actions"})]}),L.map(x=>{let F=x.playback_url||x.stream_url||x.final_audio_url||"";F&&!F.startsWith("http")&&!F.startsWith("/")&&(F=`/${F}`);const c=as(x.status)==="scheduled"||as(x.status)==="published"&&ba(x.publish_at);return e.jsxs("div",{className:"group grid grid-cols-12 items-start px-3 py-3 gap-2 text-sm hover:bg-gray-50",children:[e.jsxs("div",{className:"col-span-5 flex flex-col",children:[e.jsx("span",{className:"font-medium truncate",title:x.title,children:x.season_number!=null&&x.episode_number!=null?`S${x.season_number}E${x.episode_number} · ${x.title||"Untitled Episode"}`:x.title||"Untitled Episode"}),x.description&&e.jsx("span",{className:"text-[11px] text-gray-500 line-clamp-1",title:x.description,children:x.description})]}),e.jsx("div",{className:"col-span-2 flex items-center flex-wrap gap-1",children:O(x.status)}),e.jsx("div",{className:"col-span-2 text-[11px] text-gray-600",children:x.publish_at?Ms(x.publish_at,x.publish_at_local):"-"}),e.jsx("div",{className:"col-span-2 text-[11px]",children:typeof x.plays_total=="number"?x.plays_total:"—"}),e.jsxs("div",{className:"col-span-1 flex justify-end",children:[c&&e.jsx("button",{className:"mr-2 text-amber-600 hover:text-amber-700 text-xs underline opacity-0 group-hover:opacity-100 transition-opacity",title:"Unpublish episode (revert to processed)",onClick:()=>T(x),children:"Unpublish"}),e.jsx("button",{className:"text-red-600 hover:text-red-800 disabled:opacity-50",title:"Delete episode",onClick:()=>Y(x.id),disabled:G.has(x.id),children:G.has(x.id)?e.jsx(et,{className:"w-4 h-4 animate-spin"}):e.jsx(zt,{className:"w-4 h-4"})}),e.jsx("span",{className:"ml-2 text-[10px] text-gray-500 hidden md:inline",children:"Deleting doesn’t return minutes."}),e.jsx("button",{className:"ml-2 text-blue-600 hover:text-blue-800 text-xs underline",onClick:()=>K(x),children:"Edit"}),x.status==="processed"&&e.jsx("button",{className:"ml-2 text-green-600 hover:text-green-700 text-xs underline",onClick:()=>Be(x.id),children:"Publish"}),x.status==="processed"&&e.jsx("button",{className:"ml-1 text-purple-600 hover:text-purple-700 text-xs underline",onClick:()=>Xe(x),children:"Schedule"})]}),F&&e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("audio",{controls:!0,src:F,className:"w-full",preload:"none"})})]},x.id)}),L.length===0&&e.jsx("div",{className:"px-3 py-6 text-center text-sm text-gray-500",children:"No matching episodes."})]}),Oe=()=>e.jsx("div",{className:"rounded-lg",children:e.jsx(In,{episodes:L,onEdit:x=>K(x),onDelete:x=>Y(x.id),formatPublishAt:Ms})});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a&&e.jsxs(M,{onClick:a,variant:"ghost",className:"text-gray-700 hover:bg-gray-100",children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsx("h2",{className:"text-2xl font-bold",children:"Episode History"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(M,{onClick:ce,variant:"outline",size:"sm",className:"h-8",children:[e.jsx(_s,{className:"w-4 h-4 mr-1"}),"Refresh"]}),e.jsxs("div",{className:"flex items-center border rounded px-2 h-8 bg-white",children:[e.jsx(Mi,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search...",className:"ml-2 outline-none text-sm placeholder:text-gray-400 bg-transparent",value:y,onChange:x=>f(x.target.value)})]}),e.jsxs("select",{className:"h-8 border rounded text-sm px-2 bg-white",value:h,onChange:x=>D(x.target.value),children:[e.jsx("option",{value:"all",children:"All statuses"}),e.jsx("option",{value:"published",children:"Published"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"processed",children:"Processed"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"error",children:"Error"})]}),e.jsxs("select",{className:"h-8 border rounded text-sm px-2 bg-white",value:d,onChange:x=>N(x.target.value),children:[e.jsx("option",{value:"newest",children:"Newest"}),e.jsx("option",{value:"oldest",children:"Oldest"}),e.jsx("option",{value:"title",children:"Title"}),e.jsx("option",{value:"status",children:"Status"}),e.jsx("option",{value:"plays",children:"Plays"})]}),e.jsxs("div",{className:"flex border rounded overflow-hidden",children:[e.jsx("button",{className:`px-2 h-8 text-sm flex items-center gap-1 ${i==="grid"?"bg-gray-200 font-medium":"bg-white hover:bg-gray-50"}`,onClick:()=>u("grid"),title:"Grid view",children:e.jsx(Ri,{className:"w-4 h-4"})}),e.jsx("button",{className:`px-2 h-8 text-sm flex items-center gap-1 border-l ${i==="mosaic"?"bg-gray-200 font-medium":"bg-white hover:bg-gray-50"}`,onClick:()=>u("mosaic"),title:"Mosaic view",children:e.jsx(Fi,{className:"w-4 h-4"})}),e.jsx("button",{className:`px-2 h-8 text-sm flex items-center gap-1 border-l ${i==="list"?"bg-gray-200 font-medium":"bg-white hover:bg-gray-50"}`,onClick:()=>u("list"),title:"List view",children:e.jsx($i,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:[r.length," total"]}),y&&e.jsxs("span",{children:["• ",L.length," match"]})]})]}),n&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(et,{className:"w-5 h-5 mr-2 animate-spin"}),"Loading…"]}),m&&e.jsx("div",{className:"text-red-600 text-sm",children:m}),!n&&(i==="grid"?fe():i==="mosaic"?Oe():be()),j&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-end z-50",children:e.jsxs("div",{className:"w-full max-w-md h-full bg-white shadow-xl flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Edit Episode"}),e.jsx("button",{onClick:ue,className:"text-gray-500 hover:text-gray-800 text-sm",children:"Close"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Season Number"}),e.jsx("input",{type:"number",min:"0",className:"w-full border rounded px-2 py-1 text-sm",value:v.season_number??"",onChange:x=>p(F=>({...F,season_number:x.target.value===""?null:parseInt(x.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Episode Number"}),e.jsx("input",{type:"number",min:"0",className:"w-full border rounded px-2 py-1 text-sm",value:v.episode_number??"",onChange:x=>p(F=>({...F,episode_number:x.target.value===""?null:parseInt(x.target.value)}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Title"}),e.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:v.title,onChange:x=>p(F=>({...F,title:x.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Description / Show Notes"}),e.jsx("textarea",{rows:6,className:"w-full border rounded px-2 py-1 text-sm resize-vertical",value:v.description,onChange:x=>p(F=>({...F,description:x.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Visibility"}),e.jsxs("select",{className:"w-full border rounded px-2 py-1 text-sm",value:v.publish_state,onChange:x=>p(F=>({...F,publish_state:x.target.value})),children:[e.jsx("option",{value:"",children:"(no change)"}),e.jsx("option",{value:"public",children:"Public"}),e.jsx("option",{value:"unpublished",children:"Unpublished"}),e.jsx("option",{value:"limited",children:"Limited"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Tags (comma separated)"}),e.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:v.tags,onChange:x=>p(F=>({...F,tags:x.target.value})),placeholder:"tag1, tag2"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"explicitFlag",type:"checkbox",className:"h-4 w-4",checked:v.is_explicit,onChange:x=>p(F=>({...F,is_explicit:x.target.checked}))}),e.jsx("label",{htmlFor:"explicitFlag",className:"text-xs font-medium text-gray-600",children:"Explicit content"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600",children:"Cover Image & Crop"}),e.jsx("input",{type:"file",accept:"image/*",className:"w-full text-xs",onChange:x=>p(F=>({...F,cover_file:x.target.files?.[0]||null}))}),v.cover_uploading&&e.jsx("div",{className:"text-[11px] text-blue-600",children:"Uploading cover..."}),e.jsx(jr,{ref:xe,sourceFile:v.cover_file,existingUrl:j?.cover_url||(j?`/api/episodes/${j.id}/cover`:null),value:v.cover_file?v.image_crop:j?.image_crop||"",onChange:x=>p(F=>{if(!F.cover_file)return F;const c=x||"";return F.image_crop===c?F:{...F,image_crop:c}}),disabled:b||!v.cover_file})]}),e.jsx("div",{className:"text-[11px] text-gray-500",children:"Saving updates local DB & pushes supported fields (title, description, visibility, cover when implemented) to Spreaker immediately if already published."})]}),e.jsxs("div",{className:"px-4 py-3 border-t flex items-center justify-end gap-2",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:ue,disabled:b,children:"Cancel"}),W&&e.jsx("div",{className:"text-[11px] text-red-600 mr-auto",children:"Duplicate season/episode for this podcast"}),e.jsx(M,{size:"sm",onClick:le,disabled:b||!ie()||W,children:b?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 mr-1 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})}),ee&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded shadow-lg p-5 space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 text-amber-700",children:[e.jsx(ha,{className:"w-5 h-5"}),"Unpublish Episode"]}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[e.jsxs("p",{children:["Revert ",e.jsx("strong",{children:ee.title||"Untitled Episode"})," back to processed? It will be removed from the feed and can be republished."]}),e.jsx("p",{className:"text-[11px] text-gray-500",children:"Allowed within 24 hours of original publication. Remote delete attempted."}),w&&e.jsx("div",{className:"text-red-600 text-xs",children:w}),_&&!q&&e.jsx("div",{className:"text-amber-700 text-[11px]",children:"Outside standard window. You may force unpublish anyway."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(M,{variant:"outline",size:"sm",disabled:q,onClick:()=>I(null),children:"Cancel"}),_&&e.jsx(M,{variant:"destructive",size:"sm",disabled:q,onClick:()=>U(!0),children:q?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 mr-1 animate-spin"}),"Forcing…"]}):"Force Unpublish"}),!_&&e.jsx(M,{size:"sm",disabled:q,onClick:()=>U(!1),children:q?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 mr-1 animate-spin"}),"Unpublishing…"]}):"Unpublish"})]})]})}),de&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white w-full max-w-sm rounded shadow-lg p-5 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-700",children:"Schedule Publication"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-3",children:[e.jsxs("p",{children:["Pick a local date & time to publish ",e.jsx("strong",{children:de.title||"Untitled Episode"}),". We'll convert it to UTC for the server."]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Date"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:qe,onChange:x=>Ke(x.target.value)}),e.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Time"}),e.jsx("input",{type:"time",step:300,className:"border rounded px-2 py-1 text-sm",value:He,onChange:x=>tt(x.target.value)})]}),e.jsx("p",{className:"text-[11px] text-gray-500",children:"Must be at least 1 minute in the future. Local time is converted to exact UTC ISO for Spreaker."}),Ve&&e.jsx("div",{className:"text-red-600 text-xs",children:Ve})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(M,{variant:"outline",size:"sm",disabled:Je,onClick:B,children:"Cancel"}),e.jsx(M,{size:"sm",disabled:Je||!qe||!He,onClick:re,children:Je?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 mr-1 animate-spin"}),"Scheduling…"]}):"Schedule"})]})]})}),!n&&r.length===0&&e.jsx("div",{className:"text-gray-500",children:"No episodes yet."})]})}const Mn=[{code:"en",label:"English"},{code:"es",label:"Spanish"},{code:"fr",label:"French"},{code:"de",label:"German"},{code:"it",label:"Italian"},{code:"pt",label:"Portuguese"},{code:"pt-br",label:"Portuguese (Brazil)"},{code:"nl",label:"Dutch"},{code:"sv",label:"Swedish"},{code:"no",label:"Norwegian"},{code:"da",label:"Danish"},{code:"fi",label:"Finnish"},{code:"pl",label:"Polish"},{code:"ru",label:"Russian"},{code:"ja",label:"Japanese"},{code:"zh",label:"Chinese"},{code:"ar",label:"Arabic"}];function Rn({isOpen:s,onClose:a,podcast:r,onSave:l,token:n,userEmail:o}){const[m,k]=t.useState({name:"",description:"",cover_path:"",podcast_type:"",language:"",copyright_line:"",owner_name:"",author_name:"",spreaker_show_id:"",contact_email:"",category_id:"",category_2_id:"",category_3_id:""}),[i,u]=t.useState([]),[y,f]=t.useState({loading:!1,error:"",loaded:!1}),[h,D]=t.useState(null),[d,N]=t.useState(!1),[j,S]=t.useState(""),[v,p]=t.useState(!1),[b,A]=t.useState(null),[W,$]=t.useState(""),{toast:G}=gt(),Q=t.useRef(!1);t.useEffect(()=>{r&&(y.loaded||Q.current&&s||(Q.current=!0,k({name:r.name||"",description:r.description||"",cover_path:r.cover_path||"",podcast_type:r.podcast_type||"",language:r.language||"",copyright_line:r.copyright_line||"",owner_name:r.owner_name||"",author_name:r.author_name||"",spreaker_show_id:r.spreaker_show_id||"",contact_email:r.contact_email||o||"",category_id:r.category_id?String(r.category_id):"",category_2_id:r.category_2_id?String(r.category_2_id):"",category_3_id:r.category_3_id?String(r.category_3_id):""}),S(r.spreaker_show_id||""),$(ee(r.cover_path))))},[r,y.loaded,s,o]),t.useEffect(()=>{async function P(){if(!(!s||!r?.id||!n)){f(_=>({..._,loading:!0,error:""}));try{const K=(await ge(n).get(`/api/spreaker/show/${r.id}?mapped=true`)).mapped||{},ue=["name","description","language","author_name","owner_name","copyright_line","category_id","category_2_id","category_3_id","contact_email","podcast_type","spreaker_show_id","cover_path"];k(ie=>{const xe={...ie};return ue.forEach(de=>{K[de]!==void 0&&K[de]!==null&&(xe[de]=String(K[de]))}),xe}),D(K),K.cover_path&&$(ee(K.cover_path)),f({loading:!1,error:"",loaded:!0})}catch(_){const V=Tt(_)?_.detail||_.error||_.message:String(_);f({loading:!1,error:V||"Failed remote fetch",loaded:!1})}}}P()},[s,r?.id,n]),t.useEffect(()=>{async function P(){try{const V=await ge(n).get("/api/spreaker/categories");u(V.categories||[])}catch{}}s&&P()},[s,n]);const ee=P=>P?P.startsWith("http")?P:`/static/media/${P.replace(/^\/+/,"").split("/").pop()}`:"",I=P=>{const{id:_,value:V}=P.target;k(K=>({...K,[_]:V}))},q=(P,_)=>{k(V=>({...V,[P]:_}))},te=P=>{const _=P.target.files?.[0];_&&(A(_),$(URL.createObjectURL(_)))},w=async P=>{if(P.preventDefault(),j&&m.spreaker_show_id&&m.spreaker_show_id!==j&&!v){G({title:"Confirmation Required",description:"Check the confirmation box to change the Spreaker Show ID.",variant:"destructive"});return}N(!0);try{let _;const V=ge(n);if(b){const K=new FormData;Object.entries(m).forEach(([ue,ie])=>{ie!=null&&ie!==""&&K.append(ue,ie)}),K.append("cover_image",b),j&&m.spreaker_show_id!==j&&v&&K.append("allow_spreaker_id_change","true"),_=await V.raw(`/api/podcasts/${r.id}`,{method:"PUT",body:K})}else{const K={...m};j&&m.spreaker_show_id!==j&&v&&(K.allow_spreaker_id_change=!0),_=await V.put(`/api/podcasts/${r.id}`,K)}l(_),G({title:"Success",description:"Podcast updated successfully."}),a()}catch(_){const V=Tt(_)?_.detail||_.error||_.message:String(_);G({title:"Error",description:V,variant:"destructive"})}finally{N(!1)}};return e.jsx(ms,{open:s,onOpenChange:a,children:e.jsxs(Zt,{className:"sm:max-w-[520px] w-full md:w-[520px]",children:[e.jsxs(es,{children:[e.jsx(ss,{children:"Edit Podcast"}),e.jsx(Lt,{children:"Make changes to your podcast here. Click save when you're done."})]}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"text-xs -mb-1 flex items-center justify-between",children:[e.jsxs("span",{className:"text-muted-foreground",children:[y.loading&&"Loading Spreaker metadata...",!y.loading&&y.loaded&&"Values loaded from Spreaker",!y.loading&&y.error&&`Remote load failed (${y.error}) using local data`]}),e.jsx("button",{type:"button",className:"underline text-blue-600",onClick:async()=>{f({loading:!0,error:"",loaded:!1});try{const V=(await ge(n).get(`/api/spreaker/show/${r.id}?mapped=true`)).mapped||{},K=["name","description","language","author_name","owner_name","copyright_line","category_id","category_2_id","category_3_id","contact_email","podcast_type","spreaker_show_id","cover_path"];k(ue=>{const ie={...ue};return K.forEach(xe=>{V[xe]!==void 0&&V[xe]!==null&&(ie[xe]=String(V[xe]))}),ie}),D(V),V.cover_path&&$(ee(V.cover_path)),f({loading:!1,error:"",loaded:!0})}catch(P){const _=Tt(P)?P.detail||P.error||P.message:String(P);f({loading:!1,error:_,loaded:!1})}},children:"Refresh"})]}),e.jsxs("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto pr-1",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{htmlFor:"name",children:"Name"}),e.jsx(we,{id:"name",value:m.name,onChange:I})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{htmlFor:"spreaker_show_id",children:"Spreaker Show ID"}),e.jsx(we,{id:"spreaker_show_id",value:m.spreaker_show_id,onChange:I})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{htmlFor:"description",children:"Description"}),e.jsx(Wt,{id:"description",rows:5,value:m.description,onChange:I})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{htmlFor:"podcast_type",children:"Podcast Type"}),e.jsxs(Nt,{value:m.podcast_type,onValueChange:P=>q("podcast_type",P),children:[e.jsx(bt,{children:e.jsx(_t,{placeholder:"Select type"})}),e.jsxs(jt,{children:[e.jsx(ct,{value:"episodic",children:"Episodic"}),e.jsx(ct,{value:"serial",children:"Serial"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{htmlFor:"language",children:"Language"}),e.jsxs(Nt,{value:m.language,onValueChange:P=>q("language",P),children:[e.jsx(bt,{children:e.jsx(_t,{placeholder:"Select language"})}),e.jsx(jt,{className:"max-h-64 overflow-y-auto",children:Mn.map(P=>e.jsx(ct,{value:P.code,children:P.label},P.code))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{htmlFor:"owner_name",children:"Owner Name"}),e.jsx(we,{id:"owner_name",value:m.owner_name,onChange:I})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{htmlFor:"author_name",children:"Author Name"}),e.jsx(we,{id:"author_name",value:m.author_name,onChange:I})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{htmlFor:"copyright_line",children:"Copyright Line"}),e.jsx(we,{id:"copyright_line",value:m.copyright_line,onChange:I})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{htmlFor:"contact_email",children:"Contact Email"}),e.jsx(we,{id:"contact_email",type:"email",value:m.contact_email,onChange:I})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{children:"Cover"}),e.jsxs("div",{className:"flex items-start gap-4",children:[W&&e.jsx("img",{src:W,alt:"cover preview",className:"w-16 h-16 rounded object-cover border"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(we,{type:"file",accept:"image/*",onChange:te}),!b&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Leave blank to keep existing cover."})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{children:"Categories"}),e.jsxs("div",{className:"space-y-1",children:[["category_id","category_2_id","category_3_id"].map((P,_)=>{const V=m[P]===""?void 0:String(m[P]);return e.jsxs(Nt,{value:V,onValueChange:K=>{K==="__none__"?q(P,""):q(P,K)},children:[e.jsx(bt,{children:e.jsx(_t,{placeholder:_===0?"Primary category":"Optional"})}),e.jsxs(jt,{className:"max-h-60 overflow-y-auto",children:[_>0&&e.jsx(ct,{value:"__none__",children:"(none)"}),i.map(K=>e.jsx(ct,{value:String(K.category_id),children:K.name},K.category_id))]})]},P)}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Primary + up to two optional categories."})]})]}),(r?.rss_url_locked||r?.rss_url)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{children:"RSS Feed"}),e.jsx(we,{value:r.rss_url_locked||r.rss_url,readOnly:!0,className:"text-xs"})]}),r?.rss_url_locked&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{children:"RSS (Locked)"}),e.jsx(we,{value:r.rss_url_locked,readOnly:!0,className:"text-xs"})]})]}),j&&m.spreaker_show_id!==j&&e.jsxs("div",{className:"col-span-4 -mt-2 mb-2 p-3 border border-amber-300 bg-amber-50 rounded text-xs space-y-2",children:[e.jsx("p",{className:"font-semibold text-amber-800",children:"Changing the Spreaker Show ID can break existing episode links."}),e.jsxs("label",{className:"flex items-start gap-2 text-amber-900",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:P=>p(P.target.checked)}),e.jsx("span",{children:"I understand the risk and want to proceed with changing the Show ID."})]})]}),e.jsxs(ts,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),e.jsxs(M,{type:"submit",disabled:d,children:[d?e.jsx(et,{className:"w-4 h-4 animate-spin mr-2"}):"","Save changes"]})]})]})]})})}const Fn={},Gt=({children:s})=>e.jsx("div",{className:"py-4",children:s}),$n=({open:s,onOpenChange:a,token:r,onPodcastCreated:l})=>{const[n,o]=t.useState(1),[m,k]=t.useState({podcastName:"",podcastDescription:"",coverArt:null,elevenlabsApiKey:""}),[i,u]=t.useState(!1),{toast:y}=gt(),f=Fn?.VITE_ENABLE_BYOK==="true",h=[{id:"welcome",title:"Welcome"},{id:"showDetails",title:"About your show"},{id:"coverArt",title:"Cover art"},{id:"spreaker",title:"Connect hosting"},...f?[{id:"elevenlabs",title:"AI voices (optional)"}]:[],{id:"finish",title:"All set"}],D=h.length,d=h[n-1]?.id;t.useEffect(()=>{const b=A=>{A.origin===window.location.origin&&A.data==="spreaker_connected"&&(u(!0),y({title:"Success!",description:"Your Spreaker account is now connected."}))};return window.addEventListener("message",b),()=>window.removeEventListener("message",b)},[y]);const N=()=>o(b=>Math.min(b+1,D)),j=()=>o(b=>Math.max(b-1,1)),S=b=>{const{id:A,value:W,files:$}=b.target;k(G=>({...G,[A]:$?$[0]:W}))},v=async()=>{try{const b=await fetch("/api/spreaker/auth/login",{headers:{Authorization:`Bearer ${r}`}});if(!b.ok)throw new Error("Could not start the Spreaker connection process.");const{auth_url:A}=await b.json(),W=window.open(A,"spreakerAuth","width=600,height=700"),$=setInterval(()=>{(!W||W.closed)&&(clearInterval($),fetch("/api/auth/users/me",{headers:{Authorization:`Bearer ${r}`}}).then(G=>G.json()).then(G=>{G.spreaker_access_token&&u(!0)}))},1e3)}catch(b){y({title:"Connection Error",description:b.message,variant:"destructive"})}},p=async()=>{try{if(m.elevenlabsApiKey&&!(await fetch("/api/users/me/elevenlabs-key",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({api_key:m.elevenlabsApiKey})})).ok)try{y({variant:"destructive",title:"ElevenLabs key not saved",description:"You can add it later in Settings."})}catch{}const b=new FormData;b.append("name",m.podcastName),b.append("description",m.podcastDescription),m.coverArt&&b.append("cover_image",m.coverArt);const A=await fetch("/api/podcasts/",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:b});if(!A.ok){const $=await A.json();throw new Error($.detail||"Failed to create the podcast show.")}const W=await A.json();y({title:"Success!",description:"Your new podcast show has been created."}),l(W)}catch(b){y({title:"An Error Occurred",description:b.message,variant:"destructive"})}finally{a(!1)}};return e.jsx(ms,{open:s,onOpenChange:a,children:e.jsxs(Zt,{className:"sm:max-w-[550px]",children:[e.jsx(es,{children:e.jsxs(ss,{children:["Let's Create Your First Podcast! (Step ",n," of ",D,")"]})}),d==="welcome"&&e.jsxs(Gt,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Welcome"}),e.jsx("p",{className:"text-sm text-gray-600",children:"We’ll guide you one step at a time. You can’t break anything, and we save as you go."})]}),d==="showDetails"&&e.jsxs(Gt,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"About your show"}),e.jsx(Lt,{className:"mb-4",children:"Tell us the name and what it’s about. You can change this later."}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ne,{htmlFor:"podcastName",className:"text-right",children:"Name"}),e.jsx(we,{id:"podcastName",value:m.podcastName,onChange:S,className:"col-span-3",placeholder:"e.g., 'The Morning Cup'"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ne,{htmlFor:"podcastDescription",className:"text-right",children:"Description"}),e.jsx(Wt,{id:"podcastDescription",value:m.podcastDescription,onChange:S,className:"col-span-3",placeholder:"e.g., 'A daily podcast about the latest tech news.'"})]})]})]}),d==="coverArt"&&e.jsxs(Gt,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Cover art"}),e.jsx(Lt,{className:"mb-2",children:"Upload a square image (at least 1400×1400). We’ll preview how it looks."}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"No artwork yet? You can skip and add it later."}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ne,{htmlFor:"coverArt",className:"text-right",children:"Image"}),e.jsx(we,{id:"coverArt",type:"file",onChange:S,className:"col-span-3",accept:"image/png, image/jpeg"})]})]}),d==="spreaker"&&e.jsxs(Gt,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Connect hosting"}),e.jsx(Lt,{className:"mb-2",children:"Link your hosting so your episodes can publish. We’ll open a secure window."}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Keep your phone nearby in case a code is needed."}),e.jsx("div",{className:"flex justify-center items-center p-6 bg-gray-50 rounded-md",children:i?e.jsxs(M,{variant:"secondary",disabled:!0,className:"bg-green-500 text-white hover:bg-green-500",children:[e.jsx(Dt,{className:"w-5 h-5 mr-2"}),"Connected"]}):e.jsx(M,{onClick:v,children:"Connect to Spreaker"})})]}),d==="elevenlabs"&&e.jsxs(Gt,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"AI voices (optional)"}),e.jsx(Lt,{className:"mb-2",children:"Want AI voices? You can always turn this on later."}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"If you’re not sure, choose ‘Skip’—you won’t lose anything."}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ne,{htmlFor:"elevenlabsApiKey",className:"text-right",children:"ElevenLabs API Key"}),e.jsx(we,{id:"elevenlabsApiKey",type:"password",value:m.elevenlabsApiKey,onChange:S,className:"col-span-3",placeholder:"(Optional) Paste your key here"})]})]}),d==="finish"&&e.jsxs(Gt,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"All set"}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Nice work. You can publish now or explore your dashboard first."}),e.jsx("p",{className:"text-xs text-gray-500",children:"There’s a short tour on the next screen if you’d like it."})]}),e.jsxs(ts,{children:[n>1&&e.jsx(M,{variant:"outline",onClick:j,children:"Back"}),n<D&&e.jsx(M,{onClick:N,children:"Continue"}),n===D&&e.jsx(M,{onClick:p,children:"Finish"})]})]})})},Kt={};function Sr({onBack:s,token:a,podcasts:r,setPodcasts:l}){const[n,o]=t.useState(null),[m,k]=t.useState(""),[i,u]=t.useState(!1),[y,f]=t.useState(!1),[h,D]=t.useState(null),[d,N]=t.useState(!1),{toast:j}=gt(),S=Q=>{D(Q),f(!0)},v=()=>{D(null),f(!1)},p=Q=>{l(ee=>ee.map(I=>I.id===Q.id?Q:I)),v()},b=Q=>{o(Q),k("")},A=()=>{o(null)},W=()=>{if(Kt?.VITE_ONBOARDING_FULLPAGE==="true"||Kt?.ONBOARDING_FULLPAGE==="true")try{window.location.href="/onboarding"}catch{}else N(!0)},$=Q=>{l(ee=>[Q,...ee]),N(!1)},G=async()=>{if(n){u(!0);try{if(!(await fetch(`/api/podcasts/${n.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok)throw new Error("Failed to delete the show.");l(ee=>ee.filter(I=>I.id!==n.id)),j({title:"Success",description:`Show "${n.name}" has been deleted.`}),A()}catch(Q){j({title:"Error",description:Q.message,variant:"destructive"})}finally{u(!1)}}};return e.jsxs("div",{className:"p-6",children:[e.jsxs(M,{onClick:s,variant:"ghost",className:"mb-4",children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsxs(_e,{children:[e.jsx(Me,{children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx(Re,{children:"Manage Your Podcasts"}),e.jsx(wt,{children:"Here you can create, import, edit, or delete your podcasts."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:W,children:[e.jsx(cs,{className:"w-4 h-4 mr-2"})," New Podcast"]}),e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>{try{window.dispatchEvent(new CustomEvent("ppp:navigate-view",{detail:"rssImporter"}))}catch{}},children:[e.jsx(lr,{className:"w-4 h-4 mr-2"})," Import"]})]})]})}),e.jsx(Se,{children:r.length>0?e.jsx("div",{className:"space-y-4",children:r.map(Q=>e.jsxs(_e,{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[Q.cover_path?e.jsx("img",{src:Q.cover_path.startsWith("http")?Q.cover_path:`/static/media/${Q.cover_path.replace(/^\/+/,"").split("/").pop()}`,alt:`${Q.name} cover`,className:"w-16 h-16 rounded-md object-cover",onError:ee=>{ee.currentTarget.style.display="none";const I=ee.currentTarget.nextSibling;I&&(I.style.display="flex")}}):e.jsx("div",{className:"w-16 h-16 rounded-md bg-gray-100 flex items-center justify-center",children:e.jsx(Ls,{className:"w-8 h-8 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:Q.name}),e.jsx("p",{className:"text-sm text-gray-500 line-clamp-2",children:Q.description||"No description."})]})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:()=>S(Q),children:"Edit"}),e.jsxs(M,{variant:"destructive",size:"sm",onClick:()=>b(Q),children:[e.jsx(zt,{className:"w-4 h-4 mr-2"})," Delete"]})]})]},Q.id))}):e.jsxs("div",{className:"text-center py-10",children:[e.jsx("p",{className:"mb-4",children:"You haven't created any podcasts yet."}),e.jsxs(M,{onClick:W,children:[e.jsx(cs,{className:"w-4 h-4 mr-2"})," ",Kt?.VITE_ONBOARDING_FULLPAGE==="true"||Kt?.ONBOARDING_FULLPAGE==="true"?"Get started":"Create Your First Show"]})]})})]}),e.jsx(ms,{open:!!n,onOpenChange:A,children:e.jsxs(Zt,{children:[e.jsxs(es,{children:[e.jsx(ss,{children:"Are you absolutely sure?"}),e.jsxs(Lt,{children:["This action cannot be undone. This will permanently delete the podcast",e.jsxs("strong",{className:"text-red-600",children:[' "',n?.name,'" ']}),"and all of its associated episodes."]})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs(ne,{htmlFor:"delete-confirm",children:["Please type ",e.jsx("strong",{className:"text-red-600",children:"delete"})," to confirm."]}),e.jsx(we,{id:"delete-confirm",value:m,onChange:Q=>k(Q.target.value),className:"mt-2"})]}),e.jsxs(ts,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:A,children:"Cancel"}),e.jsx(M,{variant:"destructive",disabled:m!=="delete"||i,onClick:G,children:i?e.jsx(et,{className:"w-4 h-4 animate-spin"}):"Delete Podcast"})]})]})}),y&&h&&e.jsx(Rn,{isOpen:y,onClose:v,podcast:h,onSave:p,token:a,userEmail:h?.user?.email||void 0}),!(Kt?.VITE_ONBOARDING_FULLPAGE==="true"||Kt?.ONBOARDING_FULLPAGE==="true")&&e.jsx($n,{open:d,onOpenChange:N,token:a,onPodcastCreated:$})]})}function Ln({onBack:s,token:a}){const[r,l]=t.useState(""),[n,o]=t.useState(!1),{toast:m}=gt(),k=async()=>{if(!r){m({title:"Error",description:"Please enter an RSS feed URL.",variant:"destructive"});return}o(!0);try{const i=await fetch("/api/import/rss",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({rss_url:r})}),u=await i.json();if(!i.ok)throw new Error(u.detail||"Failed to import from RSS feed.");m({title:"Import Successful!",description:`Imported "${u.podcast_name}" with ${u.episodes_imported} episodes.`}),s()}catch(i){m({title:"Import Failed",description:i.message,variant:"destructive"})}finally{o(!1)}};return e.jsxs("div",{className:"p-6",children:[e.jsxs(M,{onClick:s,variant:"ghost",className:"mb-4",children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsxs(_e,{className:"max-w-xl mx-auto",children:[e.jsxs(Me,{children:[e.jsxs(Re,{className:"flex items-center gap-2",children:[e.jsx(lr,{})," Import from RSS Feed"]}),e.jsx(wt,{children:"Enter the URL of a public RSS feed to import a podcast and its episodes for testing."})]}),e.jsxs(Se,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"rss-url",children:"RSS Feed URL"}),e.jsx(we,{id:"rss-url",placeholder:"https://example.com/podcast.xml",value:r,onChange:i=>l(i.target.value)})]}),e.jsx(M,{onClick:k,disabled:n,className:"w-full",children:n?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"mr-2 h-4 w-4 animate-spin"}),"Importing..."]}):"Import Podcast"})]})]})]})}function zn({token:s}){const[a,r]=t.useState(!1),{toast:l}=gt(),n=async()=>{if(window.confirm("ARE YOU SURE? This will permanently delete all data, including users, shows, and templates.")){r(!0);try{const o=await fetch("/api/dev/reset-database",{method:"POST",headers:{Authorization:`Bearer ${s}`}}),m=await o.json();if(!o.ok)throw new Error(m.detail||"Failed to reset database.");l({title:"Database Reset!",description:"The database has been wiped and recreated. Please log out and sign up again."})}catch(o){l({title:"Reset Failed",description:o.message,variant:"destructive"})}finally{r(!1)}}};return e.jsx("div",{className:"p-6",children:e.jsxs(_e,{className:"max-w-xl mx-auto border-red-500",children:[e.jsxs(Me,{children:[e.jsxs(Re,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(Ys,{})," Developer Tools"]}),e.jsx(wt,{children:"Use these tools to manage the development state of your application."})]}),e.jsxs(Se,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"Reset Database"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This will completely wipe all data and recreate the database tables from the current code models. This is useful after making changes to `podcast.py` or other models."}),e.jsx(M,{variant:"destructive",onClick:n,disabled:a,children:a?e.jsx(et,{className:"mr-2 h-4 w-4 animate-spin"}):"Force Reset Database"})]})]})})}function Un({user:s,token:a,onBack:r,onTemplateCreated:l}){const[n,o]=t.useState([{role:"assistant",content:`AI Template Wizard is coming soon.

Soon you'll be able to:
• Describe your show in plain language.
• Get a draft template with segments and timing.
• Edit details before saving.

Tip: You can change templates later. Your work is safe.

For now, please use the manual Template Builder.`}]),[m,k]=t.useState(""),i=t.useRef(null),u=t.useRef(null),y=()=>{i.current?.scrollIntoView({behavior:"smooth"})};return t.useEffect(()=>{y()},[n]),t.useEffect(()=>{u.current?.focus()},[]),t.useEffect(()=>{const f=h=>{h.key==="Escape"&&(h.preventDefault(),r?.())};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[r]),e.jsx("div",{className:"fixed inset-0 bg-black/50 flex justify-center items-center p-4 z-50",role:"dialog","aria-modal":"true","aria-labelledby":"template-wizard-heading",children:e.jsxs(_e,{className:"w-full max-w-2xl h-full max-h-[90vh] flex flex-col",children:[e.jsxs(Me,{className:"flex flex-row items-center justify-between",children:[e.jsxs(Re,{id:"template-wizard-heading",tabIndex:-1,ref:u,className:"flex items-center gap-2 outline-none",children:[e.jsx(zs,{"aria-hidden":!0,className:"w-5 h-5"}),"Template Wizard (preview)"]}),e.jsxs(M,{variant:"ghost",onClick:r,className:"h-11 min-h-[44px] px-3",children:[e.jsx(pt,{className:"w-4 h-4 mr-2","aria-hidden":!0}),"Back"]})]}),e.jsxs(Se,{className:"flex-grow overflow-y-auto p-4 space-y-4",children:[e.jsx("div",{role:"status","aria-live":"polite",className:"text-sm text-muted-foreground",children:"AI Template Wizard is coming soon."}),e.jsx("div",{className:"rounded-md border bg-muted/50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(zi,{"aria-hidden":!0,className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"What you'll be able to do"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1 text-sm text-muted-foreground",children:[e.jsx("li",{children:"Describe your show in plain language."}),e.jsx("li",{children:"Get a draft template with segments and timing."}),e.jsx("li",{children:"Edit details before saving."})]}),e.jsx("p",{className:"mt-3 text-sm text-muted-foreground",children:"Tip: You can change templates later. Your work is safe."})]})]})}),n.map((f,h)=>e.jsxs("div",{className:`flex items-start gap-3 ${f.role==="user"?"justify-end":""}`,children:[f.role==="assistant"&&e.jsx(zs,{className:"w-6 h-6 text-blue-500","aria-hidden":!0}),e.jsx("div",{className:`rounded-lg p-3 max-w-[80%] ${f.role==="user"?"bg-blue-500 text-white":"bg-gray-100"}`,children:e.jsx("p",{className:"whitespace-pre-line text-sm",children:f.content})}),f.role==="user"&&e.jsx(or,{className:"w-6 h-6 text-gray-500","aria-hidden":!0})]},h)),e.jsx("div",{ref:i})]}),e.jsx(mr,{className:"p-4 border-t",children:e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsx(we,{disabled:!0,placeholder:"AI Wizard is disabled (coming soon)",value:m,readOnly:!0}),e.jsxs(M,{disabled:!0,variant:"outline",className:"h-11 min-h-[44px] px-5",children:[e.jsx(Ui,{className:"w-4 h-4 mr-2","aria-hidden":!0}),"Send"]})]})})]})})}const Mt=t.forwardRef(({className:s,...a},r)=>e.jsx(Ja,{className:Fe("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...a,ref:r,children:e.jsx(Si,{className:Fe("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Mt.displayName=Ja.displayName;const Rs={removeFillers:!0,fillerWords:["um","uh","like"],fillerLeadTrimMs:100,removePauses:!0,maxPauseSeconds:1.8,targetPauseSeconds:.6,commands:{flubber:{action:"rollback_restart",trigger_keyword:"flubber"},intern:{action:"ai_command",trigger_keyword:"intern",end_markers:["stop","stop intern"],remove_end_marker:!0,keep_command_token_in_transcript:!0}}};function ja(s){return s?s.split(/[|,]/).map(a=>a.trim()).filter(Boolean).filter((a,r,l)=>l.indexOf(a)===r):[]}function Bn({className:s}){const{token:a}=St(),[r,l]=t.useState(null),[n,o]=t.useState(!1),[m,k]=t.useState(!1),[i,u]=t.useState(null),[y,f]=t.useState(!1),[h,D]=t.useState(""),[d,N]=t.useState([]),j=250,S=1e3,v=0,p=a?{Authorization:`Bearer ${a}`}:{},b=t.useCallback(async()=>{o(!0),u(null);try{const I=await fetch("/api/users/me/audio-cleanup-settings",{headers:{...p}});if(!I.ok)throw new Error("Failed to load settings");const te=(await I.json()).settings||{},w=te&&Object.keys(te).length?te:Rs,P={...w,commands:{...Rs.commands,...w.commands||{}}};l(P),f(!1)}catch(I){u(I.message||String(I)),r||l(Rs)}finally{o(!1)}},[a]);t.useEffect(()=>{b()},[b]),t.useEffect(()=>{(async()=>{try{const q=await fetch("/api/media/",{headers:{...p}});if(!q.ok)return;const P=(await q.json()||[]).filter(_=>_.category==="sfx").map(_=>({id:_.id,label:_.friendly_name||_.filename?.split("_").slice(1).join("_")||_.filename,value:`media_uploads/${_.filename}`}));N(P)}catch{}})()},[a]);const A=I=>{l(q=>({...q,...I})),f(!0)},W=(I,q)=>{l(te=>({...te,commands:{...te.commands||{},[I]:{...te.commands?.[I]||{},...q}}})),f(!0)},$=I=>{l(q=>{const te={...q.commands||{}};return delete te[I],{...q,commands:te}}),f(!0)},G=()=>{const I=h.trim().toLowerCase().replace(/\s+/g,"_");!I||r.commands?.[I]||(A({commands:{...r.commands||{},[I]:{action:"sfx",trigger_keyword:I}}}),D(""))},Q=async()=>{if(r){k(!0),u(null);try{const I={settings:r};if(!(await fetch("/api/users/me/audio-cleanup-settings",{method:"PUT",headers:{"Content-Type":"application/json",...p},body:JSON.stringify(I)})).ok)throw new Error("Save failed");f(!1)}catch(I){u(I.message||String(I))}finally{k(!1)}}};if(t.useEffect(()=>{if(!r?.censorEnabled)return;(r.censorBeepMs!==j||r.censorBeepFreq!==S||r.censorBeepGainDb!==v)&&(l(q=>({...q,censorBeepMs:j,censorBeepFreq:S,censorBeepGainDb:v})),f(!0))},[r?.censorEnabled]),!r)return e.jsx(_e,{className:s,children:e.jsxs(Se,{className:"p-4 text-sm flex items-center gap-2",children:[e.jsx(_s,{className:"w-4 h-4 animate-spin"})," Loading…"]})});const ee=Object.entries(r.commands||{});return e.jsxs(_e,{className:`${s||""} p-6 md:p-8`,children:[e.jsxs(Me,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Re,{className:"text-2xl",children:"Make your audio sound better"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Simple, predictable cleanup while you record."})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[y&&e.jsx("span",{className:"text-sm text-amber-600",children:"Unsaved"}),e.jsxs(M,{size:"sm",variant:"outline",disabled:n,onClick:b,className:"bg-transparent",children:[e.jsx(_s,{className:`w-4 h-4 mr-1 ${n?"animate-spin":""}`}),"Reload"]}),e.jsxs(M,{size:"sm",disabled:!y||m,onClick:Q,style:{backgroundColor:"#2C3E50",color:"white"},children:[e.jsx(ws,{className:"w-4 h-4 mr-1"}),m?"Saving…":"Save"]})]})]}),i&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:i})]}),e.jsxs(Se,{className:"space-y-8 text-[15px]",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(ne,{className:"text-base font-semibold",children:"Quick cleanup"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600 max-w-[70%]",children:"Trim long pauses so it flows better."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Shorten long pauses"}),e.jsx(Mt,{checked:!!r.removePauses,onCheckedChange:I=>A({removePauses:I})})]})]}),(()=>{const I=r.maxPauseSeconds??1.5,q=r.targetPauseSeconds??.5,te=!!r.removePauses&&(q<=0||I<q);return e.jsxs("div",{className:`space-y-2 ${r.removePauses?"":"opacity-60 pointer-events-none"}`,children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Pauses that are",e.jsx(we,{type:"number",step:"0.1",value:I,onChange:w=>A({maxPauseSeconds:parseFloat(w.target.value||"1.5")}),className:"inline-block w-20 mx-2"}),"seconds or more will be condensed down to",e.jsx(we,{type:"number",step:"0.1",value:q,onChange:w=>A({targetPauseSeconds:parseFloat(w.target.value||"0.5")}),className:"inline-block w-20 mx-2"}),"seconds."]}),te&&e.jsx("div",{className:"text-xs text-red-600",children:"Please choose numbers where “max” ≥ “condensed to”, and “condensed to” is greater than 0."})]})})()]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ne,{className:"text-base font-semibold",children:"Bleep out words"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600 max-w-[70%]",children:["Pick words or phrases to bleep. Your transcript will show ","{beep}",". Use our short built‑in beep or a sound from your library."]}),e.jsx(Mt,{checked:!!r.censorEnabled,onCheckedChange:I=>A({censorEnabled:I})})]}),r.censorEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(ne,{className:"text-xs text-gray-600",children:"Words or phrases to bleep"}),e.jsx(va,{values:r.censorWords||[],onChange:I=>A({censorWords:I}),placeholder:"Type word or phrase + Enter"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Mt,{checked:!!r.censorFuzzy,onCheckedChange:I=>A({censorFuzzy:I})}),e.jsx("span",{className:"text-sm text-gray-700",children:"Catch near‑matches too"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"text-xs text-gray-600",children:"How strict"}),e.jsx(we,{type:"number",step:"0.05",min:"0",max:"1",value:r.censorMatchThreshold??.8,onChange:I=>A({censorMatchThreshold:parseFloat(I.target.value||"0.8")}),className:"w-24"})]}),(()=>{const I=Number(r.censorMatchThreshold??.8);let q="Balanced: good at catching obvious matches.";return I<=.6?q="Looser: bleeps more, may bleep close matches you didn’t intend.":I>=.9&&(q="Stricter: bleeps less, may miss variations like endings or slang."),e.jsx("span",{className:"text-xs text-gray-600",children:q})})()]})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(ne,{className:"text-xs text-gray-600",children:"Beep sound"}),e.jsxs(Nt,{value:r.censorBeepFile&&r.censorBeepFile.trim()?r.censorBeepFile:"__builtin__",onValueChange:I=>{A(I==="__builtin__"?{censorBeepFile:"",censorBeepMs:j,censorBeepFreq:S,censorBeepGainDb:v}:{censorBeepFile:I,censorBeepMs:j,censorBeepFreq:S,censorBeepGainDb:v})},children:[e.jsx(bt,{className:"w-full",children:e.jsx(_t,{placeholder:"Built‑in short beep (250ms)"})}),e.jsxs(jt,{children:[e.jsx(ct,{value:"__builtin__",children:"Built‑in short beep (250ms)"}),d.map(I=>e.jsx(ct,{value:I.value,children:I.label},I.id))]})]}),e.jsx("div",{className:"text-[12px] text-gray-600 mt-1",children:"Upload SFX in Media Library (category “sfx”). We’ll play it once instead of the beep."})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ne,{className:"text-base font-semibold",children:"Filler words (optional)"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600 max-w-[70%]",children:"Turn this on to remove common hesitation words (like “um”, “uh”). Add or remove any words you want to include."}),e.jsx(Mt,{checked:!!r.removeFillers,onCheckedChange:I=>A({removeFillers:I})})]}),r.removeFillers&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(ne,{className:"text-xs text-gray-600",children:"Words to remove"}),e.jsx(va,{values:r.fillerWords||[],onChange:I=>A({fillerWords:I}),placeholder:"Type word + Enter"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx(ne,{className:"text-xs text-gray-600",children:"Trim a tiny bit before each cut (ms)"}),e.jsx(we,{type:"number",value:r.fillerLeadTrimMs||0,onChange:I=>A({fillerLeadTrimMs:parseInt(I.target.value||"0",10)})})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ne,{className:"text-base font-semibold",children:"Magic words (say these while recording)"}),e.jsx("div",{className:"text-sm text-gray-600",children:"You can rename these to whatever feels natural. Separate alternatives with commas."}),e.jsxs("div",{className:"text-xs bg-blue-50 border border-blue-200 text-blue-900 rounded p-3",children:["Examples:",e.jsxs("ul",{className:"list-disc pl-5 mt-1 space-y-1",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Redo last bit"}),": say “flubber” (or your word) after a mistake. We’ll cut the mistake and restart that sentence."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Ask your helper"}),": say “intern,” then your question. We’ll insert the answer in the next pause."]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{className:"text-xs text-gray-600",children:"Redo last bit (default: “flubber”)"}),e.jsx(we,{value:r.commands?.flubber?.trigger_keyword??"flubber",onChange:I=>W("flubber",{trigger_keyword:I.target.value}),placeholder:"flubber, do‑over, go back"}),e.jsx("div",{className:"text-[11px] text-gray-500",children:"Say this to cut the mistake and restart that sentence."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{className:"text-xs text-gray-600",children:"Ask your helper (default: “intern”)"}),e.jsx(we,{value:r.commands?.intern?.trigger_keyword??"intern",onChange:I=>W("intern",{trigger_keyword:I.target.value}),placeholder:"intern, sidekick, helper"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ne,{className:"text-xs text-gray-600",children:"Stop phrase(s) next to it"}),e.jsx(we,{value:(r.commands?.intern?.end_markers||["stop","stop intern"]).join(", "),onChange:I=>{const q=ja(I.target.value);W("intern",{end_markers:q})},placeholder:"stop, stop intern"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] text-gray-500 pr-4",children:"Say “intern,” then your request, then your stop phrase. We’ll anchor the answer at the stop and remove the spoken stop word."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-700",children:"Remove spoken stop"}),e.jsx(Mt,{checked:!!(r.commands?.intern?.remove_end_marker??!0),onCheckedChange:I=>W("intern",{remove_end_marker:I})})]})]})]})]})]}),e.jsxs("details",{className:"rounded-md border bg-white/60",children:[e.jsx("summary",{className:"cursor-pointer px-3 py-2 text-sm font-medium",children:"Optional: make your own magic word"}),e.jsxs("div",{className:"p-3 space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Add a phrase and choose what it does. Keep it simple."}),e.jsxs("div",{className:"space-y-3",children:[ee.filter(([I])=>!["flubber","intern"].includes(I)).map(([I,q])=>{const te=ja(q.trigger_keyword);return e.jsxs("div",{className:"border rounded-md p-3 bg-gray-50 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-sm",style:{color:"#2C3E50"},children:I}),e.jsx(M,{size:"icon",variant:"ghost",className:"text-gray-400 hover:text-red-600",onClick:()=>$(I),children:e.jsx(zt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{className:"text-xs text-gray-600",children:"What you say"}),e.jsx(we,{value:q.trigger_keyword||"",onChange:w=>W(I,{trigger_keyword:w.target.value}),placeholder:"rim shot, drum hit"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:te.map(w=>e.jsx(ft,{variant:"secondary",className:"text-xs bg-blue-600 text-white",children:w},w))}),e.jsx(ne,{className:"text-xs text-gray-600 mt-2",children:"What happens"}),e.jsx(we,{value:q.action||"sfx",onChange:w=>W(I,{action:w.target.value}),placeholder:"sfx"})]})]},I)}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(we,{placeholder:"new magic word name",value:h,onChange:I=>D(I.target.value),onKeyDown:I=>{I.key==="Enter"&&(I.preventDefault(),G())}}),e.jsxs(M,{type:"button",variant:"outline",onClick:G,className:"bg-transparent",children:[e.jsx(Bi,{className:"w-4 h-4 mr-1"}),"Add"]})]})]})]})]}),e.jsx("div",{className:"pt-2 flex justify-end",children:e.jsx(M,{size:"sm",disabled:!y||m,onClick:Q,style:{backgroundColor:"#2C3E50",color:"white"},children:m?"Saving…":"Save Changes"})})]})]})}function va({values:s,onChange:a,placeholder:r}){const[l,n]=t.useState(""),o=k=>{const i=k.trim();!i||s.includes(i)||(a([...s,i]),n(""))},m=k=>a(s.filter(i=>i!==k));return e.jsxs("div",{className:"border rounded-md p-2 bg-white",children:[e.jsx("div",{className:"flex flex-wrap gap-1 mb-1",children:s.map(k=>e.jsxs(ft,{variant:"secondary",className:"cursor-pointer bg-blue-600 text-white",onClick:()=>m(k),children:[k," ×"]},k))}),e.jsx(we,{value:l,placeholder:r,onChange:k=>n(k.target.value),onKeyDown:k=>{k.key==="Enter"&&(k.preventDefault(),o(l)),k.key==="Backspace"&&!l&&s.length&&m(s[s.length-1])}})]})}function On({token:s,initial:a=null,onSaved:r}){const{toast:l}=gt(),[n,o]=Ot.useState(a),[m,k]=Ot.useState(!1),[i,u]=Ot.useState(null);Ot.useEffect(()=>{if(a!=null){o(a);return}if(!s)return;let D=!1;return(async()=>{try{const N=await ge(s).get("/api/admin/settings");D||o(N||{test_mode:!1,default_user_active:!0})}catch{D||o({test_mode:!1,default_user_active:!0})}})(),()=>{D=!0}},[s,a]);const y=async(D,d)=>{if(s){k(!0),u(null);try{const j=await ge(s).put("/api/admin/settings",D);o(j),r&&r(j)}catch(N){u(N?.message||"Failed");try{l({title:"Error",description:"Failed to update admin settings",variant:"destructive"})}catch{}d&&o(d)}finally{k(!1)}}},f=D=>{const d={...n||{}},N={...d,test_mode:!!D};o(N),y(N,d)},h=D=>{const d={...n||{}},N={...d,default_user_active:!!D};o(N),y(N,d)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ne,{className:"text-base font-medium text-gray-700",children:"Test Mode (Admin)"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"When enabled, new episodes default to draft and season/episode numbers are overridden to day-of-month and HHMM."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[m&&e.jsx("span",{className:"text-xs text-gray-400",children:"Saving…"}),i&&e.jsx("span",{className:"text-xs text-red-500",title:i,children:"Err"}),e.jsx(Mt,{checked:!!(n&&n.test_mode),disabled:m,onCheckedChange:f})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ne,{className:"text-base font-medium text-gray-700",children:"New Users Are Active By Default"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"When disabled, newly created accounts start as inactive and will see the Closed-Alpha gate until approved."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[m&&e.jsx("span",{className:"text-xs text-gray-400",children:"Saving…"}),i&&e.jsx("span",{className:"text-xs text-red-500",title:i,children:"Err"}),e.jsx(Mt,{checked:!!(n&&n.default_user_active),disabled:m,onCheckedChange:h})]})]})]})}function Wn(){const{user:s,token:a}=St(),{toast:r}=gt(),[l,n]=t.useState(!1),[o,m]=t.useState(!1),[k,i]=t.useState(!1);return t.useEffect(()=>{(async()=>{try{if(!(s&&(s.is_admin||s.role==="admin"))){i(!1);return}const u=await fetch("/api/admin/settings",{headers:{Authorization:`Bearer ${a}`}});if(u.ok){const y=await u.json();i(!0),m(!!y.test_mode)}else u.status===403&&i(!1)}catch{}})()},[a,s]),k?e.jsxs(_e,{className:"mt-4",children:[e.jsx(Me,{children:e.jsx(Re,{children:"Admin Settings"})}),e.jsx(Se,{children:e.jsx(On,{token:a,initial:{test_mode:o},onSaved:u=>m(!!u?.test_mode)})})]}):null}function Cr({token:s}){const{toast:a}=gt(),{user:r,refreshUser:l}=St(),[n,o]=t.useState(!1);t.useEffect(()=>{r&&o(!!r.spreaker_access_token),new URLSearchParams(window.location.search).get("spreaker_connected")==="true"&&(a({title:"Spreaker Connected",description:"Your Spreaker account has been successfully connected!"}),window.history.replaceState({},document.title,window.location.pathname))},[r,s]);const m=async()=>{try{const y=await ge(s).get("/api/spreaker/auth/login");window.location.href=y.auth_url}catch(u){a({title:"Error",description:u.message||"An unexpected error occurred.",variant:"destructive"})}},k=async()=>{if(window.confirm("Are you sure you want to disconnect your Spreaker account?"))try{await ge(s).post("/api/spreaker/disconnect",{}),a({title:"Spreaker Disconnected",description:"Your Spreaker account has been successfully disconnected."}),l({force:!0})}catch(u){a({title:"Error",description:u.message||"An unexpected error occurred.",variant:"destructive"})}},i=()=>{window.location.href="/"};return e.jsxs("div",{className:"p-6 bg-white rounded-xl shadow-md space-y-4",children:[e.jsx("div",{children:e.jsxs("button",{onClick:i,className:"flex items-center text-sm text-gray-600 hover:text-gray-900 group","aria-label":"Back to dashboard",children:[e.jsx(pt,{className:"w-4 h-4 mr-1 transition-transform group-hover:-translate-x-0.5"}),e.jsx("span",{children:"Back to Dashboard"})]})}),e.jsxs(_e,{children:[e.jsx(Me,{children:e.jsx(Re,{children:"Your Settings"})}),e.jsx(Se,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Your profile"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"We’ll use this to say hello and label your work."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 uppercase tracking-wide",children:"First name"}),e.jsx("input",{type:"text",defaultValue:r?.first_name||"",id:"firstNameInput",className:"w-full border rounded px-2 py-2 text-sm",placeholder:"Jane"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 uppercase tracking-wide",children:"Last name"}),e.jsx("input",{type:"text",defaultValue:r?.last_name||"",id:"lastNameInput",className:"w-full border rounded px-2 py-2 text-sm",placeholder:"Doe"})]})]}),e.jsx(M,{variant:"secondary",onClick:async()=>{const u=document.getElementById("firstNameInput").value,y=document.getElementById("lastNameInput").value;try{await ge(s).patch("/api/auth/users/me/prefs",{first_name:u,last_name:y}),a({title:"Saved your profile"}),l({force:!0})}catch(f){a({title:"Error",description:f.message||"Could not update profile",variant:"destructive"})}},children:"Save Profile"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Publish to Spreaker"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connect your Spreaker account so finished episodes can be posted for you."})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-md",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Spreaker"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"One-time connect, then you can send shows with one click."})]}),n?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-green-600 font-medium",children:"Connected"}),e.jsx(M,{onClick:k,variant:"destructive",children:"Disconnect"})]}):e.jsx(M,{onClick:m,children:"Connect to Spreaker"})]})]})})]}),e.jsx(Bn,{}),e.jsx(Wn,{}),e.jsx("div",{className:"pt-6",children:e.jsx("button",{type:"button",onClick:()=>{try{window.location.href="/ab"}catch{}},className:"text-xs text-muted-foreground hover:underline font-normal",children:"A/B workspace"})})]})}function kr({onBack:s,token:a,setCurrentView:r}){const[l,n]=t.useState([]),[o,m]=t.useState(!0),[k,i]=t.useState(null),[u,y]=t.useState(null),f=async()=>{m(!0),y(null);try{const j=await ge(a).get("/api/templates/");n(j)}catch(N){i(N.message)}finally{m(!1)}};t.useEffect(()=>{f()},[a]);const h=()=>{y("new")},D=async N=>{if(window.confirm("Are you sure you want to delete this template?"))try{await ge(a).del(`/api/templates/${N}`),f()}catch(j){i(j.message)}},d=async N=>{try{const j=ge(a),S={...N,is_active:N?.is_active===!1};await j.put(`/api/templates/${N.id}`,S),f()}catch(j){i(j.message)}};return u?e.jsx(br,{templateId:u,onBack:()=>y(null),token:a,onTemplateSaved:f}):e.jsxs("div",{className:"p-6",children:[e.jsxs(M,{onClick:s,variant:"ghost",className:"mb-4",children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Template Manager"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(M,{type:"button",variant:"outline",disabled:!0,className:"opacity-60 cursor-not-allowed",title:"AI Template Wizard is coming soon",children:[e.jsx(zs,{className:"w-4 h-4 mr-2"}),"Create with AI Wizard"]}),e.jsx("span",{className:"text-xs text-muted-foreground hidden sm:inline",children:"coming soon"}),e.jsxs(M,{onClick:h,children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Create New Template"]})]})]}),o&&e.jsx("div",{className:"flex justify-center",children:e.jsx(et,{className:"w-8 h-8 animate-spin"})}),k&&e.jsx("p",{className:"text-red-500",children:k}),!o&&!k&&e.jsxs(_e,{children:[e.jsxs(Me,{children:[e.jsx(Re,{children:"Your Templates"}),e.jsx(wt,{children:"Select a template to edit or create a new one."})]}),e.jsx(Se,{children:l.length>0?e.jsx("div",{className:"space-y-2",children:l.map(N=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold",children:N.name}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full border ${N?.is_active!==!1?"bg-green-50 text-green-700 border-green-200":"bg-gray-100 text-gray-700 border-gray-300"}`,children:N?.is_active!==!1?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:()=>d(N),children:N?.is_active!==!1?"Disable":"Enable"}),e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>y(N.id),children:[e.jsx(ir,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(M,{variant:"destructive",size:"sm",onClick:()=>D(N.id),children:[e.jsx(zt,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]},N.id))}):e.jsx("p",{children:"No templates found. Get started by creating one!"})})]})]})}function Er({token:s,onBack:a}){const{refreshUser:r}=St(),[l,n]=t.useState(null),[o,m]=t.useState(null),[k,i]=t.useState(!0),[u,y]=t.useState(null),[f,h]=t.useState(!1),[D,d]=t.useState(!1),[N,j]=t.useState(null),[S,v]=t.useState(!1),[p,b]=t.useState(!1),{toast:A}=(()=>{try{return gt()}catch{return{toast:()=>{}}}})(),W=t.useRef(null);if(!W.current)try{W.current=sessionStorage.getItem("ppp_tab_id")||Math.random().toString(36).slice(2)}catch{W.current=Math.random().toString(36).slice(2)}const $=t.useRef(null);t.useEffect(()=>{try{$.current=new BroadcastChannel("ppp_checkout_owner"),$.current.onmessage=q=>{q?.data?.type==="owner_claimed"&&q.data.owner!==W.current&&new URLSearchParams(window.location.search).get("checkout")==="success"&&(window.close(),setTimeout(()=>{try{document.hidden||window.location.replace("/")}catch{}},200))}}catch{}return()=>{try{$.current&&$.current.close()}catch{}}},[]);const G=async()=>{try{const q=ge(s),[te,w]=await Promise.all([q.get("/api/billing/subscription"),q.get("/api/billing/usage")]);n(te),m(w)}catch(q){const te=Tt(q)?q.detail||q.error||q.message:String(q);y(te)}finally{i(!1)}};t.useEffect(()=>{G()},[s]),t.useEffect(()=>{const q=new URLSearchParams(window.location.search),te=q.get("checkout")==="success",w=q.get("session_id"),P=typeof window<"u"&&window.opener&&window.name==="ppp_stripe_checkout";te&&(async()=>{try{const V=localStorage.getItem("ppp_checkout_owner");if(V&&V!==W.current){window.close(),setTimeout(()=>{try{document.hidden||window.location.replace("/")}catch{}},150);return}else if(!V){localStorage.setItem("ppp_checkout_owner",W.current);try{$.current?.postMessage({type:"owner_claimed",owner:W.current})}catch{}}}catch{}try{A({title:"Processing Purchase",description:"Finalizing your subscription...",duration:4e3})}catch{}if(w)for(let V=0;V<5;V++){try{const ue=await ge(s).get(`/api/billing/checkout_result?session_id=${w}`);j(ue),v(!0);try{const ie=new BroadcastChannel("ppp_billing");ie.postMessage({type:"checkout_success",payload:ue}),ie.close()}catch{}try{localStorage.setItem("ppp_last_checkout",JSON.stringify({ts:Date.now(),data:ue}))}catch{}break}catch{}await new Promise(K=>setTimeout(K,300*(V+1)))}let _=!1;if(w)for(let V=0;V<6&&!_;V++){try{const ue=await ge(s).post("/api/billing/force_sync_session",{session_id:w});if(ue?.plan_key&&ue.plan_key!=="free"){n(ie=>({...ie||{},plan_key:ue.plan_key,current_period_end:ue.current_period_end})),_=!0,r({force:!0}),setTimeout(()=>r({force:!0}),1200),A({title:"Subscription Upgraded",description:`You are now on the ${ue.plan_key} plan.`,duration:5e3});try{const ie=new BroadcastChannel("ppp_billing");ie.postMessage({type:"subscription_updated",payload:ue}),ie.close()}catch{}}}catch{}_||await new Promise(K=>setTimeout(K,800))}if(!_&&!P){b(!0);let V=0;const K=async()=>{V+=1;try{const ie=await ge(s).get("/api/billing/subscription");if(n(ie),ie.plan_key!=="free"){r({force:!0}),setTimeout(()=>r({force:!0}),1200),A({title:"Subscription Upgraded",description:`You are now on the ${ie.plan_key} plan.`,duration:5e3});try{const xe=new BroadcastChannel("ppp_billing");xe.postMessage({type:"subscription_updated",payload:ie}),xe.close()}catch{}b(!1);return}}catch{}if(V<15)setTimeout(K,1e3);else{b(!1);try{A({title:"Upgrade Pending",description:"Payment complete. Your plan will reflect the upgrade shortly.",duration:6e3})}catch{}}};K()}if(!P){G();try{window.history.replaceState(null,"",window.location.pathname)}catch{}}setTimeout(()=>{try{localStorage.getItem("ppp_checkout_owner")===W.current&&localStorage.removeItem("ppp_checkout_owner")}catch{}},5e3),P&&setTimeout(()=>{try{window.close()}catch{}},600)})()},[s,A]);const Q=async(q,te="monthly")=>{try{h(!0);const P=await ge(s).post("/api/billing/checkout",{plan_key:q,billing_cycle:te}),_=window.open(P.url,"ppp_stripe_checkout","width=720,height=850,noopener");if(!_)window.location.href=P.url;else try{_.focus()}catch{}}catch(w){const P=Tt(w)?w.detail||w.error||w.message:String(w);y(P)}finally{h(!1)}},ee=async()=>{try{d(!0);const te=await ge(s).post("/api/billing/portal",{});window.location.href=te.url}catch(q){const te=Tt(q)?q.detail||q.error||q.message:String(q);y(te)}finally{d(!1)}},I=q=>{try{const te=new Date(q),w=String(te.getMonth()+1).padStart(2,"0"),P=String(te.getDate()).padStart(2,"0"),_=te.getFullYear();return`${w}-${P}-${_}`}catch{return q}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsx(M,{variant:"ghost",onClick:a,children:"Back"}),e.jsx("h2",{className:"text-2xl font-semibold",children:"Billing"})]}),u&&e.jsx("div",{className:"text-red-600 text-sm",children:u}),e.jsxs(_e,{children:[e.jsx(Me,{children:e.jsx(Re,{children:"Current Plan"})}),e.jsxs(Se,{className:"space-y-4",children:[k&&e.jsx("div",{className:"text-sm text-gray-500",children:"Loading..."}),!k&&l&&e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["Plan: ",e.jsx("span",{className:"font-medium capitalize",children:l.plan_key})]}),l.plan_key!=="free"&&l.current_period_end&&e.jsxs("div",{children:["Renews: ",I(l.current_period_end)]})]}),p&&e.jsx("div",{className:"text-xs text-amber-600",children:"Finalizing upgrade..."}),e.jsxs("div",{className:"flex flex-col gap-2",children:[l?.plan_key==="free"&&e.jsxs(e.Fragment,{children:[e.jsx(M,{disabled:f,onClick:()=>Q("creator","monthly"),children:"Upgrade to Creator (Monthly)"}),e.jsx(M,{variant:"outline",disabled:f,onClick:()=>Q("creator","annual"),children:"Creator Annual"}),e.jsx(M,{disabled:f,onClick:()=>Q("pro","monthly"),children:"Pro Monthly"}),e.jsx(M,{variant:"outline",disabled:f,onClick:()=>Q("pro","annual"),children:"Pro Annual"})]}),l?.plan_key==="creator"&&e.jsxs(e.Fragment,{children:[e.jsx(M,{disabled:f,onClick:()=>Q("pro","monthly"),children:"Upgrade to Pro (Monthly)"}),e.jsx(M,{variant:"outline",disabled:f,onClick:()=>Q("pro","annual"),children:"Pro Annual"}),e.jsx(M,{disabled:D,variant:"secondary",onClick:ee,children:"Manage Subscription"})]}),l?.plan_key==="pro"&&e.jsx(M,{disabled:D,onClick:ee,children:"Manage Subscription"})]})]})]}),e.jsxs(_e,{children:[e.jsx(Me,{children:e.jsx(Re,{children:"Usage"})}),e.jsxs(Se,{className:"space-y-3",children:[!o&&e.jsx("div",{className:"text-sm text-gray-500",children:"Loading usage..."}),o&&(()=>{const q=typeof o.processing_minutes_used_this_month=="number"?o.processing_minutes_used_this_month:typeof o.minutes_used=="number"?o.minutes_used:null,te=typeof o.max_processing_minutes_month=="number"?o.max_processing_minutes_month:o.max_processing_minutes_month==null?null:void 0,w=te==null?"∞":q==null?null:Math.max(0,te-q),P=te&&typeof q=="number"?Math.min(100,q/Math.max(1,te)*100):null;return e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Minutes"}),e.jsxs("span",{children:[q??"—"," / ",te??"∞"]})]}),typeof P=="number"&&e.jsx(Es,{value:P}),w!==null&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Minutes left: ",w]})]})})()]})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6 space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Subscription Updated"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:["Plan: ",e.jsx("span",{className:"font-medium capitalize",children:N?.plan_key}),N?.billing_cycle&&e.jsxs("span",{className:"ml-1 text-gray-500",children:["(",N.billing_cycle,")"]})]}),N?.plan_key!=="free"&&N?.renewal_date&&e.jsxs("div",{children:["Renewal: ",I(N.renewal_date)]}),N?.applied_credit&&e.jsxs("div",{children:["Prorated credit from previous plan: $",N.applied_credit.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(M,{variant:"outline",onClick:()=>v(!1),children:"Close"}),e.jsx(M,{onClick:()=>{v(!1),a&&a()},children:"Go to Dashboard"})]})]})})]})}function Ar({onBack:s,token:a,onFinish:r,onSaved:l}){const[n,o]=t.useState(!1),[m,k]=t.useState(!1),[i,u]=t.useState(!1),[y,f]=t.useState(0),[h,D]=t.useState(""),[d,N]=t.useState([]),[j,S]=t.useState(""),[v,p]=t.useState(""),[b,A]=t.useState(!1),[W,$]=t.useState(0),[G,Q]=t.useState(""),[ee,I]=t.useState(""),[q,te]=t.useState(null),[w,P]=t.useState(!1),[_,V]=t.useState(""),[K,ue]=t.useState(""),[ie,xe]=t.useState(!1),[de,Ae]=t.useState(!1),[qe,Ke]=t.useState(""),[He,tt]=t.useState(!1),[Je,Le]=t.useState(0),Ve=t.useRef(null),Ye=t.useRef(null),ze=t.useRef([]),Ue=t.useRef(null),Be=t.useRef(null),Xe=t.useRef(null),B=t.useRef(null),re=t.useRef(null),le=t.useRef(!1),ce=t.useRef(!1),{toast:T}=gt(),U=t.useRef(null),Y=t.useRef(null),O=t.useRef(0),L=t.useRef(null),fe=t.useRef(null),be=t.useRef(null),Oe=500*1024*1024,x=t.useMemo(()=>{try{return/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent||"")}catch{return!1}},[]),F=ae=>{const he=Math.floor(ae/60).toString().padStart(2,"0"),ve=Math.floor(ae%60).toString().padStart(2,"0");return`${he}:${ve}`},c=()=>{if(window.MediaRecorder){if(MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm;codecs=opus"))return"audio/webm;codecs=opus";if(MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/mp4;codecs=aac"))return"audio/mp4;codecs=aac"}return""},C=async ae=>{const he=await ae.arrayBuffer(),ve=window.AudioContext||window.webkitAudioContext;if(!ve)throw new Error("No AudioContext available");const Te=new ve;try{const De=await Te.decodeAudioData(he),$e=Math.min(2,Math.max(1,De.numberOfChannels||1)),it=De.sampleRate,ut=De.length,mt=[];for(let nt=0;nt<$e;nt++)mt[nt]=De.getChannelData(nt);const Ut=$e*2,Ct=it*Ut,$t=ut*Ut,Bt=new ArrayBuffer(44+$t),R=new DataView(Bt);let je=0;R.setUint32(je,1380533830,!1),je+=4,R.setUint32(je,36+$t,!0),je+=4,R.setUint32(je,1463899717,!1),je+=4,R.setUint32(je,1718449184,!1),je+=4,R.setUint32(je,16,!0),je+=4,R.setUint16(je,1,!0),je+=2,R.setUint16(je,$e,!0),je+=2,R.setUint32(je,it,!0),je+=4,R.setUint32(je,Ct,!0),je+=4,R.setUint16(je,Ut,!0),je+=2,R.setUint16(je,16,!0),je+=2,R.setUint32(je,1684108385,!1),je+=4,R.setUint32(je,$t,!0),je+=4;const We=nt=>{const ot=Math.max(-1,Math.min(1,nt));R.setInt16(je,ot<0?ot*32768:ot*32767,!0),je+=2};if($e===1){const nt=mt[0];for(let ot=0;ot<ut;ot++)We(nt[ot])}else{const nt=mt[0],ot=mt[1];for(let kt=0;kt<ut;kt++)We(nt[kt]),We(ot[kt])}return new Blob([Bt],{type:"audio/wav"})}finally{try{await Te.close()}catch{}}},E=()=>{const ae=new Date,he=ae.getFullYear(),ve=String(ae.getMonth()+1).padStart(2,"0"),Te=String(ae.getDate()).padStart(2,"0"),De=String(ae.getHours()).padStart(2,"0"),$e=String(ae.getMinutes()).padStart(2,"0");return`My Recording ${he}-${ve}-${Te} ${De}${$e}`},z=ae=>{if(!ae)return"";const he=ae.lastIndexOf(".");return he>0?ae.slice(0,he):ae},Z=()=>{try{Ye.current&&Ye.current.getTracks().forEach(ae=>ae.stop())}catch{}Ye.current=null},H=()=>{try{Be.current&&cancelAnimationFrame(Be.current),Be.current=null,Xe.current&&Xe.current.close()}catch{}Xe.current=null,B.current=null,re.current=null},se=ae=>{try{const he=new(window.AudioContext||window.webkitAudioContext),ve=he.createMediaStreamSource(ae),Te=he.createAnalyser();Te.fftSize=2048,ve.connect(Te),Xe.current=he,B.current=Te,re.current=ve;const De=new Uint8Array(Te.fftSize),$e=()=>{Te.getByteTimeDomainData(De);let it=0;for(let ut=0;ut<De.length;ut++){const mt=Math.abs(De[ut]-128)/128;mt>it&&(it=mt)}$(Math.min(1,it)),Be.current=requestAnimationFrame($e)};Be.current=requestAnimationFrame($e)}catch{}},ye=async()=>{try{const ae={audio:!0},he=await navigator.mediaDevices.getUserMedia(ae);try{const Te=(await navigator.mediaDevices.enumerateDevices()).filter(De=>De.kind==="audioinput"&&De.deviceId);N(Te),!j&&Te[0]?.deviceId&&S(Te[0].deviceId)}finally{try{he.getTracks().forEach(ve=>ve.stop())}catch{}}}catch(ae){const he=ae?.name||"";throw D(he==="NotAllowedError"||he==="SecurityError"||he==="PermissionDeniedError"?"Microphone access was blocked. Please allow microphone permission in your browser, then try again. Tip: Click the mic/camera icon in the address bar to grant access.":he==="NotFoundError"?"No microphone was found. Plug in or enable a microphone and try again.":"Could not access microphone."),ae}},me=async ae=>{const he=[],ve=ae?{exact:ae}:void 0;he.push({audio:{deviceId:ve,channelCount:1,noiseSuppression:{ideal:!0},echoCancellation:{ideal:!0}}}),he.push({audio:{deviceId:ve,channelCount:1}}),he.push({audio:{deviceId:ve}}),he.push({audio:!0});let Te;for(const De of he)try{const $e=await navigator.mediaDevices.getUserMedia(De);return Ye.current=$e,se($e),$e}catch($e){Te=$e}throw Te||new Error("getUserMedia failed")},Ce=async()=>{D(""),I(he=>(he&&URL.revokeObjectURL(he),"")),te(null),u(!1),f(0),ze.current=[];try{be.current&&(be.current.pause(),be.current.currentTime=0)}catch{}k(!1),ce.current=!1;const ae=c();if(!ae){D("Recording not supported in this browser.");return}p(ae);try{if(!navigator.mediaDevices?.getUserMedia){D("Recording not supported in this browser.");return}const he=await me(j),ve=new MediaRecorder(he,{mimeType:ae});ze.current=[];let Te=0;if(ve.ondataavailable=De=>{const $e=Date.now();!De?.data||De.data.size===0||$e-Te<50||(Te=$e,ze.current.push(De.data))},ve.onpause=()=>{k(!0),ce.current=!0},ve.onresume=()=>{k(!1),ce.current=!1},ve.onstop=()=>{Promise.resolve().then(async()=>{try{const De=ze.current||[],$e=new Blob(De,{type:ae});let it=$e;try{it=await C($e),p("audio/wav")}catch{it=$e}te(it);const ut=URL.createObjectURL(it);I(ut),u(!0)}catch{}})},Ve.current=ve,ve.start(),o(!0),le.current=!0,Ue.current)try{clearInterval(Ue.current)}catch{}Ue.current=setInterval(()=>{le.current&&!ce.current&&f(De=>De+1)},1e3);try{navigator.wakeLock?.request&&(fe.current=await navigator.wakeLock.request("screen"))}catch{}}catch(he){console.error(he);const ve=he?.name||"";D(ve==="NotAllowedError"||ve==="SecurityError"||ve==="PermissionDeniedError"?"Microphone permission denied. Allow access in your browser and try again.":ve==="NotFoundError"?"No microphone detected.":"Could not access microphone."),Z(),H()}},ke=()=>{try{Ve.current&&Ve.current.state!=="inactive"&&Ve.current.stop()}catch{}o(!1),le.current=!1,k(!1),ce.current=!1,Ue.current&&clearInterval(Ue.current),Ue.current=null;try{be.current&&be.current.pause()}catch{}H(),Z();try{fe.current?.release&&fe.current.release()}catch{}fe.current=null},Ee=()=>{if(!(n||He)){if(Le(3),tt(!0),L.current)try{clearInterval(L.current)}catch{}L.current=setInterval(()=>{Le(ae=>{if(ae<=1){try{clearInterval(L.current)}catch{}return L.current=null,tt(!1),Ce(),0}return ae-1})},1e3)}},Pe=()=>{if(!(!m||He)){if(Le(3),tt(!0),L.current)try{clearInterval(L.current)}catch{}L.current=setInterval(()=>{Le(ae=>{if(ae<=1){try{clearInterval(L.current)}catch{}L.current=null,tt(!1);try{Ve.current?.resume?.()}catch{}return 0}return ae-1})},1e3)}},lt=()=>{try{L.current&&clearInterval(L.current)}catch{}L.current=null,tt(!1),Le(0)},st=()=>{if(!n){if(He){lt();return}Ee();return}if(!m){try{Ve.current?.pause?.()}catch{}return}Pe()},Qe=()=>{m&&ke()},Ge=async()=>{if(!(n||b)){A(!0);try{if(!d||d.length===0)try{await ye()}catch{}const ae=await me(j);await new Promise(he=>setTimeout(he,3e3)),H(),ae.getTracks().forEach(he=>he.stop())}catch(ae){const he=ae?.name||"";D(he==="NotAllowedError"||he==="SecurityError"||he==="PermissionDeniedError"?"Microphone permission is blocked. Allow access in your browser and try again.":he==="NotFoundError"||he==="OverconstrainedError"?"Could not start mic check for the selected device. Try another microphone or unplug/replug it.":"Could not start mic check.")}finally{A(!1)}}},at=(ae,he)=>ae?ae.toLowerCase().endsWith(he)?ae:`${ae}${he}`:`untitled${he}`,yt=async()=>{if(!(!q||w)){if(q.size>Oe){T({variant:"destructive",title:"Too large",description:"Recording too long to upload (over 500 MB)."});return}if(!_)try{P(!0);const ae=G&&G.trim()?G.trim():E();let he=".webm";v.includes("wav")?he=".wav":v.includes("webm")?he=".webm":(v.includes("mp4")||v.includes("aac"))&&(he=".m4a");const ve=at(ae,he);Ke(ve);const Te=new File([q],ve,{type:v||q.type||"audio/webm"}),De=new FormData;De.append("files",Te),De.append("friendly_names",JSON.stringify([ae]));const it=await ge(a).raw("/api/media/upload/main_content",{method:"POST",body:De}),ut=Array.isArray(it)?it:it&&it.data?it.data:null,mt=Array.isArray(ut)?ut[0]:null,Ft=mt&&(mt.filename||mt.name||mt.stored_name);if(!Ft)throw new Error("Upload response missing filename");V(Ft),ue(z(Ft)),T({title:"Saved",description:"Saved. Transcription has started."});try{window.dispatchEvent(new CustomEvent("ppp:media-uploaded",{detail:mt}))}catch{}try{typeof l=="function"&&l(mt)}catch{}}catch(ae){const he=ae&&(ae.detail||ae.message)||"Upload failed";T({variant:"destructive",title:"Upload error",description:he})}finally{P(!1)}}};t.useEffect(()=>((async()=>{try{if(navigator.permissions?.query)try{(await navigator.permissions.query({name:"microphone"}))?.state==="denied"&&D("Microphone access is blocked. Enable it in your browser site settings, then press Record.")}catch{}const he=(await navigator.mediaDevices.enumerateDevices()).filter(ve=>ve.kind==="audioinput"&&ve.deviceId);if(he.length){N(he);let ve="";try{ve=localStorage.getItem("ppp_mic_device_id")||""}catch{}ve&&he.find(Te=>Te.deviceId===ve)?S(ve):j||S(he[0].deviceId)}}catch{}})(),()=>{try{Ue.current&&clearInterval(Ue.current)}catch{}try{L.current&&clearInterval(L.current)}catch{}H(),Z(),ee&&URL.revokeObjectURL(ee);try{U.current&&clearInterval(U.current)}catch{}try{Y.current&&Y.current.abort()}catch{}try{fe.current?.release&&fe.current.release()}catch{}}),[]),t.useEffect(()=>{if(xe(!1),Ae(!1),!K){try{U.current&&clearInterval(U.current)}catch{}try{Y.current&&Y.current.abort()}catch{}U.current=null,Y.current=null;return}const ae=ge(a),he=600*1e3;O.current=Date.now();const ve=async()=>{try{Y.current&&Y.current.abort()}catch{}const Te=new AbortController;Y.current=Te;try{const $e=await ae.get(`/api/ai/transcript-ready?hint=${encodeURIComponent(K)}`,{signal:Te.signal});if($e&&($e.ready===!0||$e.status==="ready"||$e===!0)){xe(!0);try{U.current&&clearInterval(U.current)}catch{}U.current=null}}catch{}Date.now()-O.current>=he&&Ae(!0)};return ve(),U.current=setInterval(ve,5e3),()=>{try{U.current&&clearInterval(U.current)}catch{}U.current=null;try{Y.current&&Y.current.abort()}catch{}Y.current=null}},[K,a]),t.useEffect(()=>{const ae=ve=>{if(!ve)return!1;const Te=ve.tagName?.toLowerCase();return ve.isContentEditable||Te==="input"||Te==="textarea"||Te==="select"},he=ve=>{if(ve.ctrlKey||ve.metaKey||ve.altKey)return;const Te=ve.key||ve.code;if(Te==="r"||Te==="R"){if(ae(ve.target))return;ve.preventDefault(),st()}else if((Te===" "||Te==="Spacebar"||Te==="Space")&&i&&be.current&&!ae(ve.target)){ve.preventDefault();const De=be.current;De.paused?De.play().catch(()=>{}):De.pause()}};return window.addEventListener("keydown",he),()=>window.removeEventListener("keydown",he)},[i,st]);const Rt=async ae=>{S(ae);try{localStorage.setItem("ppp_mic_device_id",ae||"")}catch{}if(n)ke(),Ee();else try{H(),Z();const he=await me(ae);setTimeout(()=>{H();try{he.getTracks().forEach(ve=>ve.stop())}catch{}},500)}catch{}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(M,{variant:"ghost",onClick:s,className:"px-2 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary","aria-label":"Go back to dashboard",children:[e.jsx(pt,{className:"w-4 h-4 mr-2"})," Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Record an Episode"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Capture audio directly in your browser and save it to your library."})]})]}),e.jsxs(_e,{className:"shadow-sm",children:[e.jsxs(Me,{className:"pb-2",children:[e.jsx(Re,{className:"text-lg",children:"Recorder"}),e.jsx(wt,{children:"Large controls and clear status for easy use."})]}),e.jsxs(Se,{className:"space-y-6",children:[h&&e.jsx("div",{className:"text-sm bg-red-50 border border-red-200 text-red-700 rounded p-3",children:h}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(M,{onClick:st,"aria-label":n?m?"Resume recording":"Pause recording":He?"Cancel countdown":"Start recording",className:`rounded-full w-28 h-28 text-lg font-semibold shadow ${n?m?"bg-green-600 hover:bg-green-500":"bg-amber-600 hover:bg-amber-500":He?"bg-amber-600 hover:bg-amber-500":"bg-green-600 hover:bg-green-500"} text-white focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary`,children:n?e.jsx("span",{className:"flex items-center gap-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx(Vt,{className:"w-5 h-5"})," ",He?`Resuming in ${Je}…`:"Resume"]}):e.jsx(e.Fragment,{children:"Pause"})}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Vt,{className:"w-5 h-5"})," ",He?`Starting in ${Je}…`:"Record"]})}),e.jsxs(M,{variant:"outline",disabled:!m,onClick:Qe,"aria-label":"Stop recording (available when paused)",className:"h-10",children:[e.jsx(Oi,{className:"w-4 h-4 mr-2"})," Stop"]})]}),e.jsx("div",{className:"text-5xl font-mono tracking-wider","aria-live":"polite",children:F(y)}),n&&x&&e.jsx("div",{className:"text-xs text-amber-800 bg-amber-50 border border-amber-200 rounded px-3 py-2",role:"status",children:"Keep your screen on while recording. We’ll try to prevent sleep."}),e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Input level"}),e.jsx("div",{className:"h-3 rounded-full bg-muted relative overflow-hidden",children:e.jsx("div",{className:"absolute left-0 top-0 h-3 bg-emerald-500 transition-[width] duration-75",style:{width:`${Math.round(W*100)}%`}})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end max-w-3xl mx-auto w-full",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(ne,{htmlFor:"micSelect",children:"Microphone"}),e.jsxs(Nt,{value:j,onValueChange:Rt,onOpenChange:ae=>{ae&&d.filter(he=>he.deviceId).length===0&&ye().catch(()=>{})},"aria-label":"Select microphone",children:[e.jsx(bt,{id:"micSelect",className:"mt-1 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",children:e.jsx(_t,{placeholder:d.filter(ae=>ae.deviceId).length?"Select microphone":"Select microphone (allow access first)"})}),e.jsx(jt,{children:d.filter(ae=>ae.deviceId).length===0?e.jsx(ct,{value:"no-devices",disabled:!0,children:"No microphones found"}):d.filter(ae=>ae.deviceId).map(ae=>e.jsx(ct,{value:ae.deviceId,children:ae.label||"Microphone"},ae.deviceId))})]})]}),e.jsx("div",{className:"flex md:justify-end",children:e.jsx(M,{variant:"outline",className:"w-full md:w-auto focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary","aria-label":"Run mic check",disabled:n||b,onClick:async()=>{if(d.length===0)try{await ye()}catch{}Ge()},children:"Mic check (3s)"})})]}),i&&e.jsxs("div",{className:"mt-2 space-y-4 max-w-3xl mx-auto w-full",children:[e.jsx("div",{className:"p-4 border rounded-lg bg-card",children:e.jsx("audio",{controls:!0,className:"w-full focus-visible:outline focus-visible:outline-2 focus-visible:outline-primary",src:ee||void 0,ref:be,"aria-label":"Recording preview"})}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(ne,{htmlFor:"recName",children:"Name this recording"}),e.jsx(we,{id:"recName",className:"mt-1 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary",placeholder:"e.g., Interview with Jamie (raw)",value:G,onChange:ae=>Q(ae.target.value)})]}),e.jsxs("div",{className:"flex gap-2 md:justify-end",children:[e.jsx(M,{className:"flex-1 md:flex-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary","aria-label":"Save to My Library",disabled:!q||w||q&&q.size>Oe||!!_,onClick:yt,children:w?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(et,{className:"h-4 w-4 animate-spin"})," Saving…"]}):_?"Saved":"Save to My Library"}),e.jsx(M,{variant:"outline",className:"flex-1 md:flex-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary","aria-label":"Discard recording",disabled:w,onClick:()=>{u(!1),te(null),I(ae=>(ae&&URL.revokeObjectURL(ae),"")),Q("")},children:"Discard"})]})]}),q&&q.size>Oe&&e.jsx("div",{className:"text-sm bg-red-50 border border-red-200 text-red-700 rounded p-3",children:"Recording too long to upload (over 500 MB). Please record a shorter segment."}),_&&e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Queued for processing"}),e.jsx("div",{className:"text-sm font-medium mt-1",children:qe||_}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-0.5",children:["Size: ",q?(q.size/(1024*1024)).toFixed(2):"0.00"," MB"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[ie?e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800 border border-emerald-200",children:[e.jsx(Dt,{className:"h-4 w-4 mr-1","aria-hidden":!0})," Ready"]}):e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-800 border border-amber-200",children:[e.jsx(et,{className:"h-4 w-4 mr-1 animate-spin","aria-hidden":!0})," Processing…"]}),ie&&e.jsx(M,{className:"bg-primary text-primary-foreground hover:bg-primary/90 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary","aria-label":"Finish episode",onClick:()=>{if(typeof r=="function"){r({filename:_,hint:K,transcriptReady:!0,startStep:5});return}try{_&&localStorage.setItem("ppp_uploaded_filename",_),K&&localStorage.setItem("ppp_uploaded_hint",K),localStorage.setItem("ppp_start_step","5"),localStorage.setItem("ppp_transcript_ready","1")}catch{}try{window.dispatchEvent(new CustomEvent("ppp:navigate-view",{detail:"createEpisode"}))}catch{}},children:"Finish Episode"})]})]}),de&&!ie&&e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:"Still processing; you can leave this page — we’ll keep working."})]})]})]})]})]})}const wa=s=>!!(s&&(s.is_admin||s.role==="admin"));function Vn(s){if(!s)return"—";try{const a=new Date(s),r=Date.now()-a.getTime(),l=Math.floor(r/1e3);if(l<60)return"just now";const n=Math.floor(l/60);if(n<60)return`${n}m ago`;const o=Math.floor(n/60);if(o<24)return`${o}h ago`;const m=Math.floor(o/24);if(m<30)return`${m}d ago`;const k=Math.floor(m/30);return k<12?`${k}mo ago`:`${Math.floor(k/12)}y ago`}catch{return"—"}}function Yn(s){if(!s)return"—";switch(s){case"success":return"Success";case"error":return"Error";case"pending":return"In Progress";default:return s.charAt(0).toUpperCase()+s.slice(1)}}function qn(s){if(!s)return"";try{const a=new Date(s),r=new Date,l=o=>String(o).padStart(2,"0");return a.toDateString()===r.toDateString()?`${l(a.getHours())}:${l(a.getMinutes())}`:`${a.getMonth()+1}/${a.getDate()} ${l(a.getHours())}:${l(a.getMinutes())}`}catch{return""}}function Na(){const{token:s,logout:a,user:r}=St(),{toast:l}=gt(),[n,o]=t.useState(null),[m,k]=t.useState([]),[i,u]=t.useState([]),[y,f]=t.useState(null),[h,D]=t.useState(null),[d,N]=t.useState([]),[j,S]=t.useState(!1),[v,p]=t.useState(()=>{try{if(localStorage.getItem("ppp_post_checkout")==="1")return"billing"}catch{}return"dashboard"}),[b,A]=t.useState(null),[W,$]=t.useState(null),[G,Q]=t.useState(!1),ee=async()=>{if(s)try{D(null);const w=ge(s),[P,_,V]=await Promise.all([w.get("/api/templates/"),w.get("/api/podcasts/"),w.get("/api/dashboard/stats").catch(K=>(D("Failed to load stats."),null))]);k(P),u(_),f(V)}catch(w){D("Failed to load dashboard data."),console.error("Failed to fetch dashboard data:",w),a()}};t.useEffect(()=>{s&&ee()},[s,a]),t.useEffect(()=>{if(!s)return;let w=!1;(async()=>{try{const V=await ge(s).get("/api/notifications/");!w&&Array.isArray(V)&&N(K=>{const ue=new Map((K||[]).map(xe=>[xe.id,xe])),ie=V.map(xe=>{const de=ue.get(xe.id);return de&&de.read_at?{...xe,read_at:de.read_at}:xe});for(const xe of K||[])ie.find(de=>de.id===xe.id)||ie.push(xe);return ie.sort((xe,de)=>new Date(de.created_at||0)-new Date(xe.created_at||0))})}catch{}})()},[s]),t.useEffect(()=>{let w;try{w=new BroadcastChannel("ppp_billing"),w.onmessage=_=>{_?.data?.type==="checkout_success"?(async()=>{try{const K=await ge(s).get("/api/notifications/");N(ue=>{const ie=new Map((ue||[]).map(de=>[de.id,de])),xe=(Array.isArray(K)?K:[]).map(de=>{const Ae=ie.get(de.id);return Ae&&Ae.read_at?{...de,read_at:Ae.read_at}:de});for(const de of ue||[])xe.find(Ae=>Ae.id===de.id)||xe.push(de);return xe.sort((de,Ae)=>new Date(Ae.created_at||0)-new Date(de.created_at||0))})}catch{}})():_?.data?.type==="subscription_updated"&&v!=="billing"&&l({title:"Subscription Updated",description:`Plan changed to ${_.data.payload?.plan_key}`,duration:5e3})}}catch{}const P=_=>{_.key==="ppp_last_checkout"&&(async()=>{try{const K=await ge(s).get("/api/notifications/");N(ue=>{const ie=new Map((ue||[]).map(de=>[de.id,de])),xe=(Array.isArray(K)?K:[]).map(de=>{const Ae=ie.get(de.id);return Ae&&Ae.read_at?{...de,read_at:Ae.read_at}:de});for(const de of ue||[])xe.find(Ae=>Ae.id===de.id)||xe.push(de);return xe.sort((de,Ae)=>new Date(Ae.created_at||0)-new Date(de.created_at||0))})}catch{}})()};return window.addEventListener("storage",P),()=>{try{w&&w.close()}catch{}window.removeEventListener("storage",P)}},[s,v,l]),t.useEffect(()=>{o(r)},[r]),t.useEffect(()=>{if(v==="billing")try{localStorage.removeItem("ppp_post_checkout")}catch{}},[v]);const I=()=>{A(null),p("dashboard")},q=()=>{A(null),p("templateManager")},te=()=>{switch(v){case"recorder":return e.jsx(Ar,{onBack:I,token:s,onFinish:({filename:w,hint:P,transcriptReady:_,startStep:V})=>{try{$(w||P||null),Q(!!_)}catch{}p("createEpisode")}});case"templateManager":return e.jsx(kr,{onBack:()=>p("dashboard"),token:s,setCurrentView:p});case"editTemplate":return e.jsx(br,{templateId:b,onBack:q,token:s,onTemplateSaved:ee});case"createEpisode":return e.jsx(vr,{onBack:I,token:s,templates:m,podcasts:i,preselectedMainFilename:W,preselectedTranscriptReady:G});case"mediaLibrary":return e.jsx(wr,{onBack:I,token:s});case"episodeHistory":return e.jsx(_r,{onBack:I,token:s});case"podcastManager":return e.jsx(Sr,{onBack:I,token:s,podcasts:i,setPodcasts:u});case"rssImporter":return e.jsx(Ln,{onBack:I,token:s});case"devTools":return wa(r)?e.jsx(zn,{token:s}):e.jsx("div",{className:"p-6 text-sm text-red-600",children:"Not authorized."});case"settings":return e.jsx(Cr,{token:s});case"templateWizard":return e.jsx(Un,{user:n,token:s,onBack:()=>p("templateManager"),onTemplateCreated:()=>{ee(),p("templateManager")}});case"billing":return e.jsx(Er,{token:s,onBack:()=>p("dashboard")});case"dashboard":default:{const w=i.length>0&&m.length>0;return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"flex flex-col gap-4 md:flex-row md:items-end md:justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl md:text-4xl font-bold tracking-tight",style:{color:"#2C3E50"},children:["Welcome back",n&&`, ${n.first_name||n.email.split("@")[0]}`,"!"]}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mt-1",children:"Quick launch your next episode or jump into a tool."})]})}),h&&e.jsx("div",{className:"bg-red-100 border border-red-300 text-red-700 rounded p-3 mb-4 text-sm",children:h}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(_e,{className:"shadow-sm border border-gray-200",children:[e.jsxs(Me,{className:"pb-3",children:[e.jsx(Re,{className:"text-lg",children:"Create Episode"}),e.jsx(wt,{children:"Assemble a new episode from your shows & templates."})]}),e.jsxs(Se,{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] tracking-wide text-gray-500",children:"Shows"}),e.jsx("div",{className:"font-semibold text-gray-800 mt-0.5",children:i.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] tracking-wide text-gray-500",children:"Episodes"}),e.jsx("div",{className:"font-semibold text-gray-800 mt-0.5",children:y?.total_episodes??"–"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] tracking-wide text-gray-500",children:"Ready?"}),e.jsx("div",{className:`font-semibold mt-0.5 ${w?"text-green-600":"text-amber-600"}`,children:w?"Yes":"Setup needed"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto",children:[w?e.jsxs(M,{onClick:()=>p("createEpisode"),className:"flex-1 md:flex-none",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"New Episode"]}):e.jsxs("div",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-200 rounded px-3 py-2",children:[i.length===0&&e.jsx("span",{children:"Add a show. "}),m.length===0&&e.jsx("span",{children:"Create a template."})]}),!w&&e.jsxs("div",{className:"flex gap-2",children:[i.length===0&&e.jsx(M,{variant:"outline",size:"sm",onClick:()=>p("podcastManager"),children:"Add show"}),m.length===0&&e.jsx(M,{variant:"outline",size:"sm",onClick:()=>p("templateManager"),children:"Add template"})]})]})]})]}),e.jsxs(_e,{className:"shadow-sm border border-gray-200",children:[e.jsxs(Me,{className:"pb-3",children:[e.jsx(Re,{className:"text-lg",children:"Recent Activity"}),e.jsx(wt,{children:"Production pace and listening at a glance."})]}),e.jsxs(Se,{className:"text-sm text-gray-700 space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 rounded border bg-white flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] tracking-wide text-gray-500",children:"Episodes published in last 30 days"}),e.jsx("span",{className:"text-lg font-semibold",children:y?.episodes_last_30d??"–"})]}),e.jsxs("div",{className:"p-3 rounded border bg-white flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] tracking-wide text-gray-500",children:"Episodes scheduled"}),e.jsx("span",{className:"text-lg font-semibold",children:y?.upcoming_scheduled??0})]}),e.jsxs("div",{className:"p-3 rounded border bg-white flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] tracking-wide text-gray-500",children:"Last episode published"}),e.jsx("span",{className:"text-sm font-medium",children:Vn(y?.last_published_at)})]}),e.jsxs("div",{className:"p-3 rounded border bg-white flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] tracking-wide text-gray-500",children:"Last assembly result"}),e.jsx("span",{className:`text-sm font-medium ${y?.last_assembly_status==="error"?"text-red-600":y?.last_assembly_status==="success"?"text-green-600":y?.last_assembly_status==="pending"?"text-amber-600":"text-gray-600"}`,children:Yn(y?.last_assembly_status)})]})]}),(typeof y?.plays_last_30d=="number"||typeof y?.show_total_plays=="number"||y?.recent_episode_plays?.length)&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Listening"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[typeof y?.plays_last_30d=="number"&&e.jsxs("div",{className:"p-3 rounded border bg-white flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] tracking-wide text-gray-500",children:"Plays Last 30 Days"}),e.jsx("span",{className:"text-lg font-semibold",children:y.plays_last_30d})]}),Array.isArray(y?.recent_episode_plays)&&y.recent_episode_plays.slice(0,4).map(P=>e.jsxs("div",{className:"p-3 rounded border bg-white flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] tracking-wide text-gray-500 truncate",title:P.title,children:P.title}),e.jsx("span",{className:"text-lg font-semibold",children:P.plays_total??"—"})]},P.episode_id))]})]}),e.jsx("p",{className:"text-[11px] text-gray-400",children:"Plays update periodically; detailed windows (24h / 7d / 30d) coming soon."})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(_e,{className:"shadow-sm border border-gray-200",children:[e.jsxs(Me,{className:"pb-3",children:[e.jsx(Re,{className:"text-lg",children:"Quick Tools"}),e.jsx(wt,{className:"text-xs",children:"Jump directly into a management area."})]}),e.jsx(Se,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(M,{onClick:()=>p("podcastManager"),variant:"outline",className:"justify-start text-sm h-10",children:[e.jsx(Vi,{className:"w-4 h-4 mr-2"}),"Podcasts"]}),e.jsxs(M,{onClick:()=>p("templateManager"),variant:"outline",className:"justify-start text-sm h-10",children:[e.jsx(Qt,{className:"w-4 h-4 mr-2"}),"Templates"]}),e.jsxs(M,{onClick:()=>p("mediaLibrary"),variant:"outline",className:"justify-start text-sm h-10",children:[e.jsx(Ns,{className:"w-4 h-4 mr-2"}),"Media"]}),e.jsxs(M,{onClick:()=>p("recorder"),variant:"outline",className:"justify-start text-sm h-10",children:[e.jsx(Vt,{className:"w-4 h-4 mr-2"}),"Record"]}),e.jsxs(M,{onClick:()=>p("episodeHistory"),variant:"outline",className:"justify-start text-sm h-10",children:[e.jsx(Yi,{className:"w-4 h-4 mr-2"}),"Episodes"]}),e.jsxs(M,{onClick:()=>p("billing"),variant:"outline",className:"justify-start text-sm h-10",children:[e.jsx(qi,{className:"w-4 h-4 mr-2"}),"Subscription"]}),e.jsxs(M,{onClick:()=>p("settings"),variant:"outline",className:"justify-start text-sm h-10",children:[e.jsx(Vs,{className:"w-4 h-4 mr-2"}),"Settings"]}),wa(r)&&e.jsxs(M,{onClick:()=>p("devTools"),variant:"destructive",className:"justify-start text-sm h-10",children:[e.jsx(Ys,{className:"w-4 h-4 mr-2"}),"Dev"]})]})})]})})]})]})}}};return t.useEffect(()=>{const w=()=>p("billing");window.addEventListener("ppp:navigate-billing",w);const P=_=>{try{const V=_?.detail;typeof V=="string"&&p(V)}catch{}};return window.addEventListener("ppp:navigate-view",P),()=>{window.removeEventListener("ppp:navigate-billing",w),window.removeEventListener("ppp:navigate-view",P)}},[]),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("nav",{className:"border-b border-gray-200 px-4 py-4 bg-white shadow-sm",children:e.jsxs("div",{className:"container mx-auto max-w-7xl flex justify-between items-center",children:[e.jsx(xr,{size:28,lockup:!0}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(M,{variant:"ghost",size:"sm",className:"relative",onClick:()=>S(w=>!w),children:[e.jsx(cr,{className:"w-5 h-5"}),d.filter(w=>!w.read_at).length>0&&e.jsx(ft,{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center bg-red-500 text-white text-xs",children:d.filter(w=>!w.read_at).length})]}),j&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white border border-gray-200 rounded shadow-lg z-50 max-h-96 overflow-auto",children:[e.jsxs("div",{className:"p-3 font-semibold border-b flex items-center justify-between",children:[e.jsx("span",{children:"Notifications"}),d.some(w=>!w.read_at)&&e.jsx("button",{className:"text-xs text-blue-600 hover:underline",onClick:async()=>{try{await ge(s).post("/api/notifications/read-all"),N(P=>P.map(_=>_.read_at?_:{..._,read_at:new Date().toISOString()}))}catch{}},children:"Mark all read"})]}),d.length===0&&e.jsx("div",{className:"p-3 text-sm text-gray-500",children:"No notifications"}),d.map(w=>e.jsxs("div",{className:"p-3 text-sm border-b last:border-b-0 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium mr-2 truncate",children:w.title}),e.jsx("div",{className:"text-[11px] text-gray-500 whitespace-nowrap",children:qn(w.created_at)})]}),w.body&&e.jsx("div",{className:"text-gray-600 text-xs",children:w.body}),!w.read_at&&e.jsx("button",{className:"text-xs text-blue-600 self-start",onClick:async()=>{try{await ge(s).post(`/api/notifications/${w.id}/read`),N(_=>_.map(V=>V.id===w.id?{...V,read_at:new Date().toISOString()}:V))}catch{}},children:"Mark read"})]},w.id))]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(qs,{className:"h-8 w-8",children:[e.jsx(Hs,{src:n?.picture}),e.jsx(Gs,{children:n?.email?n.email.substring(0,2).toUpperCase():"..."})]}),e.jsx("span",{className:"hidden md:block text-sm font-medium",style:{color:"#2C3E50"},children:n?n.email:"Loading..."})]}),e.jsxs(M,{onClick:a,variant:"ghost",size:"sm",className:"text-gray-600 hover:text-gray-800",children:[e.jsx(Wi,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"hidden md:inline",children:"Logout"})]})]})]})}),e.jsx("main",{className:"container mx-auto max-w-7xl px-4 py-6",children:te()})]})}const Ws=[{key:"solo",label:"Solo Monologue",desc:"You sharing insights, tips, or stories."},{key:"interview",label:"Interview",desc:"You interviewing a different guest each episode."},{key:"cohost",label:"Co-Hosts",desc:"Conversational show with a consistent co-host."},{key:"panel",label:"Panel / Roundtable",desc:"Group discussion with multiple recurring voices."},{key:"narrative",label:"Narrative / Story",desc:"Scripted or documentary style storytelling."}],os={id:"none",display_name:"No Music",mood_tags:[]};function Hn(){const{token:s}=St(),[a,r]=t.useState(null),l=["userName","haveNameQuestion","brainstorm","name","description","format","category","audience","cover","audioSetup","spreaker","lastInfo","distribution","reviewCreate","success"],[n,o]=t.useState(l[0]),[m,k]=t.useState(""),[i,u]=t.useState(""),y=["rss","confirm","importing","analyze","assets","importSuccess"],[f,h]=t.useState(y[0]),[D,d]=t.useState(""),[N,j]=t.useState([]),[S,v]=t.useState(""),[p,b]=t.useState(""),[A,W]=t.useState("solo"),[$,G]=t.useState([]),[Q,ee]=t.useState(!1),[I,q]=t.useState([]),[te,w]=t.useState(""),[P,_]=t.useState("none"),[V,K]=t.useState("none"),[ue,ie]=t.useState("none"),[xe,de]=t.useState(null),[Ae,qe]=t.useState(null),[Ke,He]=t.useState(""),[tt,Je]=t.useState(""),[Le,Ve]=t.useState("later"),[Ye,ze]=t.useState(null),[Ue,Be]=t.useState([]),[Xe,B]=t.useState(!1),[re,le]=t.useState(null),ce=Ot.useRef(null),[T,U]=t.useState(!1),[Y,O]=t.useState([]),[L,fe]=t.useState(!1),[be,Oe]=t.useState("intro"),[x,F]=t.useState(!1),[c,C]=t.useState(null),[E,z]=t.useState(null),[Z,H]=t.useState(!1),[se,ye]=t.useState(null),[me,Ce]=t.useState(!1),[ke,Ee]=t.useState(null),[Pe,lt]=t.useState(null),[st,Qe]=t.useState(""),[Ge,at]=t.useState(null),[yt,Rt]=t.useState(""),[ae,he]=t.useState([]);async function ve(){try{await fetch("/api/auth/users/me/prefs",{method:"PATCH",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({first_name:m,last_name:i})})}catch{}}t.useEffect(()=>{a==="new"&&$.length===0&&!Q&&(ee(!0),fetch("/api/spreaker/categories").then(R=>R.ok?R.json():Promise.reject("cats")).then(R=>{const je=R.categories||[];G(je.map(We=>({id:We.category_id||We.id||We.value,name:We.name||We.description||We.label||We.title})))}).catch(()=>{}).finally(()=>ee(!1)))},[a,$.length,Q]);function Te(R){q(je=>je.includes(R)?je.filter(We=>We!==R):je.length>=3?je:[...je,R])}function De(){const R=D.split(/[\n,]/).map(We=>We.trim()).filter(Boolean).slice(0,4),je=[];R.forEach(We=>{const nt=We.split(" ").slice(0,2).map(ot=>ot.charAt(0).toUpperCase()+ot.slice(1).toLowerCase()).join(" ");je.push(`The ${nt} Show`),je.push(`${nt} Conversations`)}),je.length===0&&je.push("Your Next Big Podcast"),j([...new Set(je)].slice(0,6))}t.useEffect(()=>{n!=="userName"&&m&&ve()},[n]),t.useEffect(()=>{n==="audioSetup"&&Ue.length===0&&!Xe&&(B(!0),fetch("/api/music/assets").then(R=>R.ok?R.json():Promise.reject()).then(R=>{Be([os,...R.assets||[]])}).catch(()=>{Be([os])}).finally(()=>B(!1)))},[n,Ue.length,Xe]);function $e(R){if(R.id!=="none"){if(re===R.id){ce.current&&(ce.current.pause(),ce.current=null),le(null);return}try{ce.current&&ce.current.pause();const je=new Audio(R.preview_url||R.filename);ce.current=je,le(R.id),je.onended=()=>le(We=>We===R.id?null:We),je.play().catch(()=>{le(null)})}catch{le(null)}}}async function it(R){if(_(R.id),R.id!=="none")try{await fetch(`/api/music/assets/${R.id}/select`,{method:"POST",headers:{Authorization:`Bearer ${s}`}})}catch{}}function ut(R){if(!R||R.trim().length<4)return!1;const je=R.trim().charAt(0);return!(je!==je.toUpperCase()||!/[A-Z]/.test(je))}async function mt({verify:R=!1}={}){fe(!0),R&&F(!0),C(null);try{const je=await fetch("/api/spreaker/shows",{headers:{Authorization:`Bearer ${s}`}});if(!je.ok)throw new Error(je.status===401?"Not authorized with Spreaker yet":"Unable to fetch shows");const We=await je.json();O(We.shows||[]),U(!0)}catch{U(!1),O([]),R&&C("Spreaker connection failed. Please try again.")}finally{fe(!1),R&&F(!1)}}async function Ft(){try{await fetch("/api/spreaker/disconnect",{method:"POST",headers:{Authorization:`Bearer ${s}`}})}catch{}U(!1),O([]),C(null)}async function Ut(){if(Pe){H(!0),ye(null);try{if(!(await fetch(`/api/spreaker/refresh/${Pe.id}`,{method:"POST",headers:{Authorization:`Bearer ${s}`}})).ok)throw new Error("Refresh failed");await Ct()}catch(R){ye(R.message)}finally{H(!1)}}}async function Ct(){if(Pe){H(!0),ye(null);try{const R=await fetch(`/api/spreaker/show/${Pe.id}?mapped=true`,{headers:{Authorization:`Bearer ${s}`}});if(!R.ok)throw new Error("Could not load remote show");const je=await R.json();z(je.mapped||null)}catch(R){ye(R.message)}finally{H(!1)}}}async function $t(){Ce(!0),Ee(null);try{let R=Pe;if(!R){const ht=new FormData;ht.append("name",S),ht.append("description",p||""),Le==="upload"&&Ye&&ht.append("cover_image",Ye);const Et=await fetch("/api/podcasts/",{method:"POST",headers:{Authorization:`Bearer ${s}`},body:ht});if(!Et.ok){let Yt="";try{const qt=await Et.json();Yt=qt.detail||JSON.stringify(qt)}catch{}throw new Error("Podcast create failed "+Yt)}R=await Et.json(),lt(R)}const je=R.id||R.podcast_id||R.uuid;if(I.length)try{const ht={category_id:I[0]||null,category_2_id:I[1]||null,category_3_id:I[2]||null};await fetch(`/api/podcasts/${je}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(ht)})}catch{}let We=null,nt=null;try{if(V==="upload"&&xe){const ht=new FormData;ht.append("files",xe);const Et=await fetch("/api/media/upload/intro",{method:"POST",headers:{Authorization:`Bearer ${s}`},body:ht});Et.ok&&(We=(await Et.json())[0]?.filename)}}catch{}try{if(ue==="upload"&&Ae){const ht=new FormData;ht.append("files",Ae);const Et=await fetch("/api/media/upload/outro",{method:"POST",headers:{Authorization:`Bearer ${s}`},body:ht});Et.ok&&(nt=(await Et.json())[0]?.filename)}}catch{}const ot=[];V==="upload"&&We?ot.push({segment_type:"intro",source:{source_type:"static",filename:We}}):V==="script"&&Ke.trim()&&ot.push({segment_type:"intro",source:{source_type:"tts",script:Ke.trim(),voice_id:"default"}}),ot.push({segment_type:"content",source:{source_type:"tts",script:"",voice_id:"default"}}),ue==="upload"&&nt?ot.push({segment_type:"outro",source:{source_type:"static",filename:nt}}):ue==="script"&&tt.trim()&&ot.push({segment_type:"outro",source:{source_type:"tts",script:tt.trim(),voice_id:"default"}});const kt={podcast_id:je,name:"Default Episode",segments:ot,background_music_rules:[],timing:{}};try{await fetch("/api/templates/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(kt)})}catch{}T&&setTimeout(()=>{Ct()},600),o("success")}catch(R){Ee(R.message)}finally{Ce(!1)}}async function Bt(){Ee(null);try{const R=await fetch("/api/import/rss",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({rss_url:st.trim()})});if(R.status===409){Ee("Already imported.");return}if(!R.ok)throw new Error("Import failed");const je=await R.json();at(je),h("importing"),setTimeout(()=>h("analyze"),1200)}catch(R){Ee(R.message)}}if(!a)return e.jsxs("main",{className:"max-w-xl mx-auto py-12",role:"main","aria-label":"Onboarding main content",tabIndex:-1,children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"We’ll guide you one step at a time."}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Do you already have a podcast? You can’t break anything, and we save as you go."}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>r("new"),className:"px-6 py-4 bg-blue-600 text-white rounded text-left",children:[e.jsx("span",{className:"font-semibold block",children:"I’m starting fresh"}),e.jsx("span",{className:"text-sm",children:"We’ll help you set things up and create a starter template."})]}),e.jsxs("button",{onClick:()=>r("import"),className:"px-6 py-4 bg-white border rounded text-left hover:shadow",children:[e.jsx("span",{className:"font-semibold block",children:"I already have a show"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Import your feed and we’ll mirror your setup."})]})]})]});if(a==="new")return n==="success"?e.jsxs("div",{className:"max-w-xl mx-auto py-12",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-center",children:"All set"}),e.jsxs("p",{className:"mb-6 text-center",children:['Your podcast, "',S,'" and first template are ready.']}),T&&e.jsxs("div",{className:"mb-6 p-4 border rounded bg-white/50",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Spreaker Show Status"}),!E&&!Z&&e.jsx("button",{onClick:Ct,className:"px-3 py-2 bg-blue-600 text-white rounded text-sm",children:"Load Remote Show Info"}),Z&&e.jsx("div",{className:"text-sm text-gray-600",children:"Loading..."}),se&&e.jsx("div",{className:"text-sm text-red-600 mb-2",children:se}),E&&e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Spreaker Show ID:"})," ",E.spreaker_show_id||"—"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"RSS URL:"})," ",E.rss_url_locked||E.rss_url||"Pending generation"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Title:"})," ",E.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Description:"})," ",(E.description||"").slice(0,140)+(E.description&&E.description.length>140?"…":"")]}),e.jsxs("div",{className:"pt-2 flex gap-2",children:[e.jsx("button",{disabled:Z,onClick:Ct,className:"px-3 py-1 bg-gray-100 rounded text-xs",children:"Refresh Info"}),e.jsx("button",{disabled:Z,onClick:Ut,className:"px-3 py-1 bg-gray-100 rounded text-xs",children:"Force RSS Check"})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("a",{href:"/",className:"px-6 py-3 bg-blue-600 text-white rounded inline-block",children:"Go to Dashboard"})})]}):e.jsxs("div",{className:"max-w-2xl mx-auto py-10",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Create your podcast"}),ke&&e.jsx("div",{className:"mb-4 p-3 text-sm bg-red-100 text-red-700 rounded",children:ke}),n==="userName"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"What should we call you?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Optional. We’ll use this in your dashboard."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 uppercase tracking-wide",children:"First Name"}),e.jsx("input",{value:m,onChange:R=>k(R.target.value),className:"w-full border rounded p-2",placeholder:"Jane"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1 uppercase tracking-wide",children:"Last Name"}),e.jsx("input",{value:i,onChange:R=>u(R.target.value),className:"w-full border rounded p-2",placeholder:"Doe"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{disabled:!m,onClick:()=>{ve(),o("haveNameQuestion")},className:`px-5 py-3 rounded text-white ${m?"bg-blue-600 hover:bg-blue-500":"bg-gray-400 cursor-not-allowed"}`,children:"Continue"}),e.jsx("button",{onClick:()=>o("haveNameQuestion"),className:"px-5 py-3 border rounded",children:"Skip"})]})]}),n==="haveNameQuestion"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Do you already have a show name?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"If not, we can show ideas."}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("button",{onClick:()=>o("name"),className:"px-5 py-3 bg-blue-600 text-white rounded",children:"Yes"}),e.jsx("button",{onClick:()=>o("brainstorm"),className:"px-5 py-3 bg-white border rounded hover:shadow",children:"Show me ideas"})]})]}),n==="brainstorm"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Name ideas"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Tell us what your show is about."}),e.jsx("textarea",{rows:4,className:"w-full border rounded p-3 mb-4",value:D,onChange:R=>d(R.target.value),placeholder:"AI for small business, remote work productivity, interviews with founders..."}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{onClick:De,className:"px-4 py-2 bg-blue-600 text-white rounded",children:"See ideas"}),e.jsx("button",{onClick:()=>o("haveNameQuestion"),className:"px-4 py-2 border rounded",children:"Back"})]}),N.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(R=>e.jsx("button",{onClick:()=>{v(R),o("name")},className:"px-3 py-2 border rounded text-sm hover:bg-blue-50",children:R},R))})]})]}),n==="name"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Show title"}),e.jsx("input",{className:`w-full border rounded p-3 mb-2 ${S&&!ut(S)?"border-red-500":""}`,value:S,onChange:R=>v(R.target.value),placeholder:"Your show title"}),S&&!ut(S)&&e.jsx("div",{className:"text-xs text-red-600 mb-2",children:"Use at least 4 characters and start with a capital letter."}),e.jsx(Pt,{onBack:()=>o("haveNameQuestion"),onNext:()=>o("description"),nextDisabled:!S||!ut(S)})]}),n==="description"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"About your show"}),e.jsx("textarea",{rows:4,className:"w-full border rounded p-3 mb-4",value:p,onChange:R=>b(R.target.value),placeholder:"In a sentence or two, what is your show about?"}),e.jsx(Pt,{onBack:()=>o("name"),onNext:()=>o("format")})]}),n==="format"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Pick a format"}),e.jsx("div",{className:"grid gap-3 mb-4",children:Ws.map(R=>e.jsxs("label",{className:`border rounded p-3 cursor-pointer flex gap-3 ${A===R.key?"border-blue-600 ring-1 ring-blue-400":"hover:border-gray-400"}`,children:[e.jsx("input",{type:"radio",name:"format",className:"mt-1",value:R.key,checked:A===R.key,onChange:()=>W(R.key)}),e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:R.label}),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-600",children:R.desc})]})]},R.key))}),e.jsx(Pt,{onBack:()=>o("description"),onNext:()=>o("category")})]}),n==="category"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Categories"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Choose up to 3 categories that best fit your show."}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:(Q?CATEGORY_PLACEHOLDER:$).map(R=>e.jsx("button",{onClick:()=>!Q&&Te(R.id||R),className:`px-3 py-2 rounded border text-xs ${I.includes(R.id||R)?"bg-blue-600 text-white border-blue-600":"bg-gray-100 hover:bg-gray-200"}`,children:R.name||R},R.id||R))}),e.jsxs("div",{className:"text-xs text-gray-500 mb-4",children:[I.length,"/3 selected"]}),e.jsx(Pt,{onBack:()=>o("format"),onNext:()=>o("audience"),nextDisabled:I.length===0})]}),n==="audience"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Who’s it for?"}),e.jsx("textarea",{rows:4,className:"w-full border rounded p-3 mb-4",value:te,onChange:R=>w(R.target.value),placeholder:"Beginners interested in ..."}),e.jsx(Pt,{onBack:()=>o("category"),onNext:()=>o("cover")})]}),n==="cover"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Cover art"}),e.jsxs("div",{className:"flex flex-col gap-2 mb-3",children:[e.jsxs("label",{className:`border rounded p-2 cursor-pointer ${Le==="upload"?"border-blue-600":"hover:border-gray-400"}`,children:[e.jsx("input",{type:"radio",name:"cover",className:"mr-2",checked:Le==="upload",onChange:()=>Ve("upload")}),"Upload my own image"]}),e.jsxs("label",{className:`border rounded p-2 cursor-pointer ${Le==="help"?"border-blue-600":"hover:border-gray-400"}`,children:[e.jsx("input",{type:"radio",name:"cover",className:"mr-2",checked:Le==="help",onChange:()=>Ve("help")}),"Help me create one (coming soon)"]}),e.jsxs("label",{className:`border rounded p-2 cursor-pointer ${Le==="later"?"border-blue-600":"hover:border-gray-400"}`,children:[e.jsx("input",{type:"radio",name:"cover",className:"mr-2",checked:Le==="later",onChange:()=>Ve("later")}),"I'll do this later"]})]}),Le==="upload"&&e.jsx("input",{type:"file",accept:"image/*",onChange:R=>ze(R.target.files?.[0]||null)}),e.jsx(Pt,{onBack:()=>o("audience"),onNext:()=>o("audioSetup")})]}),n==="audioSetup"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Audio setup"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Optional: background music and intro/outro. You can skip this for now."}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Intro & Outro (Optional)"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Intro"}),e.jsxs("select",{className:"w-full border rounded p-2 mb-2",value:V,onChange:R=>K(R.target.value),children:[e.jsx("option",{value:"none",children:"No intro (add later)"}),e.jsx("option",{value:"upload",children:"I already have a produced intro file"}),e.jsx("option",{value:"script",children:"Write a script for an AI-read intro"})]}),V==="upload"&&e.jsx("input",{type:"file",accept:"audio/*",onChange:R=>de(R.target.files?.[0]||null),className:"text-sm"}),V==="script"&&e.jsx("textarea",{rows:3,className:"w-full border rounded p-2 text-sm",value:Ke,placeholder:"Welcome to...",onChange:R=>He(R.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold mb-1",children:"Outro"}),e.jsxs("select",{className:"w-full border rounded p-2 mb-2",value:ue,onChange:R=>ie(R.target.value),children:[e.jsx("option",{value:"none",children:"No outro (add later)"}),e.jsx("option",{value:"upload",children:"I already have a produced outro file"}),e.jsx("option",{value:"script",children:"Write a script for an AI-read outro"})]}),ue==="upload"&&e.jsx("input",{type:"file",accept:"audio/*",onChange:R=>qe(R.target.files?.[0]||null),className:"text-sm"}),ue==="script"&&e.jsx("textarea",{rows:3,className:"w-full border rounded p-2 text-sm",value:tt,placeholder:"Thanks for listening...",onChange:R=>Je(R.target.value)})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-2 flex items-center gap-2",children:["Background Music ",Xe&&e.jsx("span",{className:"text-xs text-gray-400",children:"Loading…"})]}),e.jsx("div",{className:"flex flex-col gap-2 mb-2",children:Ue.map(R=>e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded border ${P===R.id?"border-blue-600 bg-blue-50":"bg-white hover:border-gray-300"}`,children:[e.jsx("button",{type:"button",onClick:()=>$e(R),disabled:R.id==="none",className:`w-7 h-7 text-xs rounded border ${re===R.id?"bg-red-600 text-white border-red-600":"bg-gray-100 hover:bg-gray-200"}`,children:re===R.id?"■":"▶"}),e.jsx("button",{type:"button",onClick:()=>it(R),className:`flex-1 text-left text-xs ${P===R.id?"font-semibold":""}`,children:R.display_name}),R.mood_tags&&R.mood_tags.length>0&&e.jsx("span",{className:"hidden md:inline text-[10px] text-gray-500",children:R.mood_tags.slice(0,3).join(", ")})]},R.id))}),e.jsx("p",{className:"text-[11px] text-gray-500",children:"We’ll expand this with AI-generated suggestions soon."})]})]}),e.jsx(Pt,{onBack:()=>o("cover"),onNext:()=>o("spreaker")})]}),n==="spreaker"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Connect hosting (Spreaker)"}),!T&&e.jsxs("div",{className:"space-y-4 text-sm text-gray-700 mb-4",children:[e.jsx("p",{children:"Sign in to Spreaker so we can set up your show and publish for you."}),e.jsx("button",{onClick:async()=>{try{const R=await fetch("/api/spreaker/auth/login",{headers:{Authorization:`Bearer ${s}`}});if(!R.ok)throw new Error("Auth init failed");const je=await R.json();if(!je.auth_url)throw new Error("No auth_url");window.open(je.auth_url,"spreakerOAuth","width=720,height=800");const We=nt=>{(nt.data==="spreaker_connected"||nt.data&&nt.data.type==="spreaker_connected")&&(window.removeEventListener("message",We),mt({verify:!0}))};window.addEventListener("message",We)}catch{Ee("Couldn't start the Spreaker sign-in")}},className:"px-5 py-2 bg-blue-600 text-white rounded",children:"Sign in to Spreaker"}),x&&e.jsx("div",{className:"text-xs text-gray-500",children:"Verifying connection…"}),c&&e.jsxs("div",{className:"text-xs text-red-600 flex items-center gap-2",children:[e.jsx("span",{children:c}),e.jsx("button",{onClick:()=>{C(null)},className:"underline",children:"Reset"})]})]}),T&&e.jsxs("div",{className:"space-y-3 mb-4 text-sm",children:[e.jsx("div",{className:"p-2 bg-green-100 text-green-700 rounded text-xs inline-block",children:"Connected"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:Ft,className:"px-2 py-1 bg-red-100 text-red-700 rounded text-xs",children:"Disconnect"}),e.jsx("button",{onClick:()=>o("lastInfo"),className:"px-2 py-1 bg-blue-600 text-white rounded text-xs",children:"Continue"})]})]}),!T&&e.jsx(Pt,{onBack:()=>o("audioSetup"),nextDisabled:!0}),T&&e.jsx(Pt,{onBack:()=>o("audioSetup"),onNext:()=>o("lastInfo")})]}),n==="lastInfo"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Final details"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"We'll collect any remaining details (like contact email) after creation. You can edit everything in Settings."}),e.jsx(Pt,{onBack:()=>o("spreaker"),onNext:()=>o("distribution")})]}),n==="distribution"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Get ready to distribute"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"After we create your show you'll be able to submit to directories. This step just gives you the overview."}),e.jsxs("ul",{className:"text-sm list-disc ml-5 mb-4 space-y-1",children:[e.jsx("li",{children:"Apple Podcasts"}),e.jsx("li",{children:"Spotify"}),e.jsx("li",{children:"Google Podcasts (YouTube Music)"}),e.jsx("li",{children:"Others..."})]}),e.jsx(Pt,{onBack:()=>o("lastInfo"),onNext:()=>o("reviewCreate")})]}),n==="reviewCreate"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Review"}),e.jsxs("ul",{className:"text-sm space-y-1 mb-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Title:"})," ",S]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Description:"})," ",p||"—"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Format:"})," ",Ws.find(R=>R.key===A)?.label]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Categories:"})," ",I.map(R=>$.find(je=>je.id===R)?.name||R).join(", ")]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Audience:"})," ",te||"—"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Music:"})," ",P]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Intro:"})," ",V]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Outro:"})," ",ue]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Cover:"})," ",Le]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Spreaker:"})," ",T?"Connected":"Not connected (must connect)"," "]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:()=>o("distribution"),className:"text-gray-500",children:"Back"}),e.jsx("button",{disabled:me||!S||!T,onClick:$t,className:"px-5 py-2 bg-green-600 text-white rounded disabled:opacity-50",children:me?"Finishing...":"Finish"})]})]})]});if(a==="import")return e.jsxs("div",{className:"max-w-2xl mx-auto py-10",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Import your podcast"}),ke&&e.jsx("div",{className:"mb-4 p-3 text-sm bg-red-100 text-red-700 rounded",children:ke}),f==="rss"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Find your podcast"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Paste your podcast feed URL (it usually ends with .xml). Search by name coming soon."}),e.jsx("input",{className:"w-full border rounded p-3 mb-4",value:st,onChange:R=>Qe(R.target.value),placeholder:"https://example.com/feed.xml"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:()=>r(null),className:"text-gray-500",children:"Back"}),e.jsx("button",{disabled:!st,onClick:Bt,className:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50",children:"Continue"})]})]}),f==="importing"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Import in Progress"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"We're importing episodes. This can take a minute."}),e.jsx("div",{className:"w-full h-3 bg-gray-200 rounded overflow-hidden mb-6",children:e.jsx("div",{className:"h-full bg-blue-600 animate-pulse",style:{width:"60%"}})})]}),f==="analyze"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Tell us how your episodes are organized"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"E.g. Intro with music, interview, ad break, outro."}),e.jsx("textarea",{rows:4,className:"w-full border rounded p-3 mb-4",value:yt,onChange:R=>Rt(R.target.value)}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:()=>h("rss"),className:"text-gray-500",children:"Back"}),e.jsx("button",{onClick:()=>h("assets"),className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Continue"})]})]}),f==="assets"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Upload reusable assets"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Intro music, jingles, outros, etc."}),e.jsx("input",{type:"file",multiple:!0,className:"mb-4",onChange:R=>he(Array.from(R.target.files||[]))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:()=>h("analyze"),className:"text-gray-500",children:"Back"}),e.jsx("button",{onClick:()=>h("importSuccess"),className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Continue"})]})]}),f==="importSuccess"&&e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Import complete"}),e.jsxs("p",{className:"mb-6",children:["Success! ",Ge?.podcast_name||"Your show"," imported. Next, build a template to match your structure."]}),e.jsx("a",{href:"/",className:"px-6 py-3 bg-blue-600 text-white rounded",children:"Go to Template Builder"})]})]})}function Pt({onBack:s,onNext:a,nextDisabled:r}){return e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx("button",{onClick:s,disabled:!s,className:`px-4 py-2 rounded ${s?"text-gray-600 hover:bg-gray-100":"text-gray-300"}`,children:"Back"}),e.jsx("button",{onClick:a,disabled:r,className:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50",children:"Continue"})]})}function Gn({largeText:s,setLargeText:a,highContrast:r,setHighContrast:l}){return e.jsxs("div",{className:"flex items-center gap-6 p-3 rounded-[var(--radius)] border bg-card",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(Mt,{checked:s,onCheckedChange:a}),e.jsx("span",{className:"text-sm",children:"Larger text"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(Mt,{checked:r,onCheckedChange:l}),e.jsx("span",{className:"text-sm",children:"High contrast"})]})]})}function Kn({children:s,keyProp:a}){const[r,l]=t.useState(!0);return t.useMemo(()=>{l(!1);const n=setTimeout(()=>l(!0),0);return()=>clearTimeout(n)},[a]),e.jsx("div",{className:"transition-all duration-200 ease-out will-change-transform "+(r?"opacity-100 translate-y-0":"opacity-0 translate-y-2"),children:s},a)}function Tr({steps:s,index:a,setIndex:r,onComplete:l,prefs:n,greetingName:o}){const m=s[a],k=s.length,i=Math.round((a+1)/k*100),u=a===k-1,y=t.useRef(null),f=t.useRef(null),[h,D]=t.useState(!1),[d,N]=t.useState(""),j=t.useRef(null),S=t.useRef(null),v=n.largeText?"text-[18px] md:text-[18px]":"text-[15px] md:text-[16px]",p=n.highContrast?"bg-white text-black [&_.btn]:!bg-black [&_.btn]:!text-white [&_.btn-outline]:!border-black [&_.btn-outline]:!text-black [&_a]:underline":"";async function b(){if(m?.validate)try{if(!await m.validate())return}catch{return}u?l?.():r(a+1)}function A(){a>0&&r(a-1)}const W=t.useMemo(()=>{const $={welcome:Ji,showDetails:Qt,format:Qt,coverArt:Ls,music:Us,spreaker:Fs,elevenlabs:Us,publishDay:is,finish:is,rss:Fs,analyze:Qt,assets:Ls,yourName:or,choosePath:Ki,publishCadence:Gi,publishSchedule:Hi};return m?.id&&$[m.id]?$[m.id]:null},[m?.id]);return t.useEffect(()=>{const $=G=>{const Q=G.target,ee=(Q?.tagName||"").toLowerCase(),I=Q?.isContentEditable||ee==="input"||ee==="textarea"||ee==="select";if(G.key==="Backspace"){I||(G.preventDefault(),G.stopPropagation());return}if(G.key==="Escape"){G.preventDefault(),G.stopPropagation();return}G.key==="Enter"&&!G.shiftKey&&!G.ctrlKey&&!G.metaKey&&!G.altKey&&ee!=="textarea"&&(G.preventDefault(),G.stopPropagation(),b())};return window.addEventListener("keydown",$,{capture:!0}),()=>window.removeEventListener("keydown",$,{capture:!0})},[b]),t.useEffect(()=>{const $=f.current;if($){const G=setTimeout(()=>{try{$.focus()}catch{}},0);return()=>clearTimeout(G)}},[m?.id]),t.useEffect(()=>{const $=y.current;if(!$)return;const G=()=>{j.current&&clearTimeout(j.current),S.current&&clearTimeout(S.current),D(!1),j.current=setTimeout(()=>{D(!0),N("Saved"),S.current=setTimeout(()=>{D(!1),N("")},1500)},500)};return $.addEventListener("input",G,!0),()=>{$.removeEventListener("input",G,!0),j.current&&clearTimeout(j.current),S.current&&clearTimeout(S.current)}},[m?.id]),e.jsxs("div",{className:`min-h-screen bg-background ${v} ${p}`,children:[e.jsx("header",{className:"border-b bg-card/40 backdrop-blur-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold",children:"New Podcast Setup"}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Step ",a+1," of ",k," • ",i,"% complete"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"hidden md:block w-56",children:e.jsx(Es,{value:i})}),e.jsx(Gn,{largeText:n.largeText,setLargeText:n.setLargeText??(()=>{}),highContrast:n.highContrast,setHighContrast:n.setHighContrast??(()=>{})})]})]})]})})}),e.jsxs("main",{className:"container mx-auto px-4 py-8 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[o&&a===1&&e.jsx("div",{className:"text-lg md:text-xl font-semibold","aria-live":"polite",children:`Hi ${o}.  It's great to meet you.`}),e.jsx("div",{className:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true",children:`Step ${a+1} of ${k}: ${m?.title||""}${d?` — ${d}`:""}`}),e.jsx("nav",{className:"sr-only","aria-label":"Step Progress",children:e.jsx("ol",{children:s.map(($,G)=>e.jsx("li",{"aria-current":G===a?"step":void 0,children:`Step ${G+1} of ${k}: ${$.title}`},$.id))})}),e.jsxs("div",{className:"flex items-center gap-2",children:[W?e.jsx(W,{className:"h-5 w-5 text-muted-foreground","aria-hidden":"true"}):e.jsx("span",{className:"inline-block h-5 w-5","aria-hidden":"true"}),e.jsxs("h2",{ref:f,tabIndex:-1,className:"text-lg md:text-xl font-medium flex items-center gap-2",children:[`Step ${a+1} of ${k}: ${m?.title||""}`,h&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-muted-foreground","aria-hidden":"true",children:[e.jsx(is,{className:"h-3.5 w-3.5"})," Saved"]})]})]}),m?.description&&e.jsx("p",{className:"text-muted-foreground",children:m.description})]}),e.jsx(Kn,{keyProp:m?.id,children:e.jsx("div",{ref:y,className:"rounded-[var(--radius)] border bg-card p-4 md:p-6",children:m?.render()})}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs(M,{variant:"outline",onClick:A,disabled:a===0,className:"rounded-[var(--radius)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring h-11 min-h-[44px] px-5 btn-outline text-foreground",children:[e.jsx(Qi,{className:"mr-2 h-4 w-4"})," Back"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u&&e.jsxs("span",{className:"text-xs text-muted-foreground hidden md:inline-flex items-center gap-1",children:[e.jsx(is,{className:"h-4 w-4"})," You’re all set after this"]}),e.jsx(M,{onClick:b,className:"rounded-[var(--radius)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring h-11 min-h-[44px] px-5 btn text-white",children:u?e.jsxs(e.Fragment,{children:["Finish ",e.jsx(pa,{className:"ml-2 h-4 w-4"})]}):e.jsxs(e.Fragment,{children:["Continue ",e.jsx(pa,{className:"ml-2 h-4 w-4"})]})})]})]})]}),e.jsxs("aside",{className:"space-y-4",children:[e.jsxs(_e,{children:[e.jsxs(Me,{className:"flex flex-row items-center gap-2 pb-2",children:[e.jsx(Xi,{className:"h-5 w-5 text-primary"}),e.jsx(Re,{className:"text-base",children:"Helpful tip"})]}),e.jsx(Se,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:m?.tip||"Short and sweet: you can change this later in Settings."})})]}),e.jsxs(_e,{children:[e.jsxs(Me,{className:"flex flex-row items-center gap-2 pb-2",children:[e.jsx(Zi,{className:"h-5 w-5 text-primary"}),e.jsx(Re,{className:"text-base",children:"Need a hand?"})]}),e.jsxs(Se,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"We’re here to help. Browse quick guides or reach out."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{variant:"outline",className:"rounded-[var(--radius)] h-11 min-h-[44px] px-5",asChild:!0,children:e.jsx("a",{href:"/help",target:"_blank",rel:"noreferrer",children:"Guides"})}),e.jsx(M,{className:"rounded-[var(--radius)] h-11 min-h-[44px] px-5",asChild:!0,children:e.jsx("a",{href:"mailto:support@example.com",children:"Contact"})})]})]})]})]})]})]})}const _a="ppp.largeText",Sa="ppp.highContrast";function Ir(){const[s,a]=t.useState(()=>{try{return localStorage.getItem(_a)==="true"}catch{return!1}}),[r,l]=t.useState(()=>{try{return localStorage.getItem(Sa)==="true"}catch{return!1}});t.useEffect(()=>{try{localStorage.setItem(_a,String(s))}catch{}},[s]),t.useEffect(()=>{try{localStorage.setItem(Sa,String(r))}catch{}},[r]);const n=t.useCallback(m=>a(m),[]),o=t.useCallback(m=>l(m),[]);return{largeText:s,setLargeText:n,highContrast:r,setHighContrast:o}}const Jn={};function Pr(){const{token:s,user:a,refreshUser:r}=St(),{toast:l}=gt(),n="ppp.onboarding.step",[o,m]=t.useState(()=>{try{const L=localStorage.getItem(n),fe=L!=null?parseInt(L,10):0;return Number.isFinite(fe)&&fe>=0?fe:0}catch{return 0}}),k=t.useRef(null),{largeText:i,setLargeText:u,highContrast:y,setHighContrast:f}=Ir(),h=Jn?.VITE_ENABLE_BYOK==="true",[D,d]=t.useState("new"),[N,j]=t.useState({podcastName:"",podcastDescription:"",coverArt:null,elevenlabsApiKey:""}),[S,v]=t.useState(!1),[p,b]=t.useState(!1),[A,W]=t.useState("solo"),[$,G]=t.useState("Monday"),[Q,ee]=t.useState(""),[I,q]=t.useState([os]),[te,w]=t.useState(!1),[P,_]=t.useState("none"),[V,K]=t.useState(null),ue=t.useRef(null),[ie,xe]=t.useState("week"),[de,Ae]=t.useState(1),[qe,Ke]=t.useState(""),[He,tt]=t.useState([]),[Je,Le]=t.useState([]),[Ve,Ye]=t.useState(()=>a?.first_name||""),[ze,Ue]=t.useState(()=>a?.last_name||""),[Be,Xe]=t.useState(""),B=t.useMemo(()=>{const L={id:"yourName",title:"What can we call you?",description:"First name required; last name optional. You can update this later in Settings.",validate:async()=>{const F=(Ve||"").trim(),c=(ze||"").trim();if(!F)return Xe("First name is required"),!1;Xe("");try{await fetch("/api/auth/users/me/prefs",{method:"PATCH",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({first_name:F,last_name:c||void 0})});try{r?.({force:!0})}catch{}}catch{}return!0},render:()=>e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(ne,{htmlFor:"firstName",className:"text-right",children:["First name",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(we,{id:"firstName",value:Ve,onChange:F=>Ye(F.target.value),className:"col-span-3",placeholder:"e.g., Alex"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ne,{htmlFor:"lastName",className:"text-right",children:"Last name"}),e.jsx(we,{id:"lastName",value:ze,onChange:F=>Ue(F.target.value),className:"col-span-3",placeholder:"(Optional)"})]}),Be&&e.jsx("p",{className:"text-sm text-red-600",children:Be})]})},fe={id:"choosePath",title:"Do you have an existing podcast?",description:"Start fresh or import an existing show."};if(D==="import")return[...[{id:"rss",title:"Import from RSS",description:"Paste your feed URL."},{id:"confirm",title:"Confirm import",description:"We’ll mirror your setup and assets."},{id:"importing",title:"Importing…",description:"Fetching episodes and metadata."},{id:"analyze",title:"Analyzing",description:"We’ll bring over what we can—you can tidy later."},{id:"assets",title:"Assets",description:"We’ll bring over what we can—you can tidy later."},{id:"importSuccess",title:"Imported",description:"Your show is now in Podcast Pro Plus."}]];const be=[L,fe,{id:"showDetails",title:"About your show",description:"Tell us the name and what it’s about. You can change this later."},{id:"format",title:"Format",description:"How will most episodes feel?"},{id:"coverArt",title:"Cover art",description:"Upload a square image (≥1400×1400). We’ll preview it."},{id:"music",title:"Music (optional)",description:"Pick intro/outro music (optional)."},{id:"spreaker",title:"Connect hosting (Spreaker)",description:"Link your hosting so episodes can publish."},{id:"publishCadence",title:"How often will you publish?",description:"I want to publish X times every …"},{id:"publishSchedule",title:"Publishing days",description:"Pick your publishing days/dates."},{id:"finish",title:"Finish",description:"Nice work. You can publish now or explore your dashboard."}];return ie!=="day"&&ie!=="year"?be:be.filter(F=>F.id!=="publishSchedule")},[D,h,Ve,ze,Be,ie]),re=B[o]?.id,le=t.useRef(!1);t.useEffect(()=>{if(!le.current){le.current=!0;try{const fe=new URL(window.location.href).searchParams.get("step"),be=fe!=null?parseInt(fe,10):NaN;if(Number.isFinite(be)&&be>=1){const Oe=Math.min(Math.max(1,be),B.length)-1;m(Oe)}}catch{}}},[B.length]),t.useEffect(()=>{const L=Math.max(0,B.length-1);o>L&&m(L)},[B.length]),t.useEffect(()=>(k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{try{localStorage.setItem(n,String(o))}catch{}},350),()=>{k.current&&clearTimeout(k.current)}),[o]),t.useEffect(()=>{if(re==="music"&&I.length<=1&&!te&&(w(!0),fetch("/api/music/assets").then(L=>L.ok?L.json():Promise.reject()).then(L=>{const fe=Array.isArray(L?.assets)?L.assets:[];q([os,...fe])}).catch(()=>q([os])).finally(()=>w(!1))),re!=="music"&&ue.current){try{ue.current.pause()}catch{}ue.current=null,K(null)}},[re,I.length,te]);const ce=L=>{if(!L||L.id==="none")return;const fe=L.preview_url||L.url||L.filename;if(fe){if(V===L.id){try{ue.current?.pause()}catch{}ue.current=null,K(null);return}try{if(ue.current)try{ue.current.pause()}catch{}const be=new Audio(fe);ue.current=be,K(L.id);const Oe=20,x=()=>{!be||isNaN(be.currentTime)||be.currentTime>=Oe&&(be.pause(),K(null),be.removeEventListener("timeupdate",x))};be.addEventListener("timeupdate",x),be.onended=()=>{K(null);try{be.removeEventListener("timeupdate",x)}catch{}},be.play().catch(()=>{K(null)})}catch{K(null)}}},T=L=>{const{id:fe,value:be,files:Oe}=L.target;j(x=>({...x,[fe]:Oe?Oe[0]:be}))};async function U(){try{const L=await fetch("/api/spreaker/auth/login",{headers:{Authorization:`Bearer ${s}`}});if(!L.ok)throw new Error("Could not start the Spreaker sign-in.");const{auth_url:fe}=await L.json(),be=window.open(fe,"spreakerAuth","width=600,height=700"),Oe=setInterval(()=>{(!be||be.closed)&&(clearInterval(Oe),fetch("/api/auth/users/me",{headers:{Authorization:`Bearer ${s}`}}).then(x=>x.json()).then(x=>{x.spreaker_access_token&&v(!0)}))},1e3)}catch(L){try{l({title:"Connection Error",description:L.message,variant:"destructive"})}catch{}}}async function Y(){try{if(b(!0),N.elevenlabsApiKey)try{await fetch("/api/users/me/elevenlabs-key",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({api_key:N.elevenlabsApiKey})})}catch{}if(D==="new"){const L=new FormData;L.append("name",N.podcastName),L.append("description",N.podcastDescription),N.coverArt&&L.append("cover_image",N.coverArt);const fe=await fetch("/api/podcasts/",{method:"POST",headers:{Authorization:`Bearer ${s}`},body:L});if(!fe.ok){let be="";try{const Oe=await fe.json();be=Oe.detail||JSON.stringify(Oe)}catch{}throw new Error(be||"Failed to create the podcast show.")}try{l({title:"Success!",description:"Your new podcast show has been created."})}catch{}}else try{l({title:"Imported",description:"Your show has been imported."})}catch{}try{window.location.href="/"}catch{}}catch(L){try{l({title:"An Error Occurred",description:L.message,variant:"destructive"})}catch{}}finally{b(!1)}}const O=B.map((L,fe)=>({id:L.id,title:L.title,description:L.description,tip:L.id==="yourName"?"We’ll use this to personalize your dashboard.":L.id==="choosePath"?"Not sure? You can switch paths at the top.":L.id==="showDetails"?"Short and clear works best.":L.id==="format"?"You can mix it up later.":L.id==="coverArt"?"No artwork yet? You can skip and add it later.":L.id==="music"?"Choose “No Music” to decide later.":L.id==="spreaker"?"Keep your phone nearby for codes.":L.id==="publishCadence"?"Bi-weekly always means once every two weeks.":L.id==="publishSchedule"?"Consistency beats volume.":L.id==="rss"?"Paste your feed URL.":L.id==="analyze"||L.id==="assets"?"We’ll bring over what we can—you can tidy later.":L.id==="finish"?"There’s a short tour next if you’d like it.":"",render:()=>{switch(L.id){case"yourName":return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(ne,{htmlFor:"firstName",className:"text-right",children:["First name",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(we,{id:"firstName",value:Ve,onChange:C=>Ye(C.target.value),className:"col-span-3",placeholder:"e.g., Alex"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ne,{htmlFor:"lastName",className:"text-right",children:"Last name"}),e.jsx(we,{id:"lastName",value:ze,onChange:C=>Ue(C.target.value),className:"col-span-3",placeholder:"(Optional)"})]}),Be&&e.jsx("p",{className:"text-sm text-red-600",children:Be})]});case"choosePath":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx(M,{variant:D==="new"?"default":"outline",onClick:()=>{d("new"),m(fe+1)},children:"Start new"}),e.jsx(M,{variant:D==="import"?"default":"outline",onClick:()=>{d("import"),m(0)},children:"Import existing"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"You can’t break anything. We save as you go."})]});case"showDetails":return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ne,{htmlFor:"podcastName",className:"text-right",children:"Name"}),e.jsx(we,{id:"podcastName",value:N.podcastName,onChange:T,className:"col-span-3",placeholder:"e.g., 'The Morning Cup'"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ne,{htmlFor:"podcastDescription",className:"text-right",children:"Description"}),e.jsx(Wt,{id:"podcastDescription",value:N.podcastDescription,onChange:T,className:"col-span-3",placeholder:"e.g., 'A daily podcast about the latest tech news.'"})]})]});case"format":return e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"grid gap-3",children:Ws.map(C=>e.jsxs("label",{className:`border rounded p-3 cursor-pointer flex gap-3 ${A===C.key?"border-blue-600 ring-1 ring-blue-400":"hover:border-gray-400"}`,children:[e.jsx("input",{type:"radio",name:"format",className:"mt-1",value:C.key,checked:A===C.key,onChange:()=>W(C.key)}),e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:C.label}),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-muted-foreground",children:C.desc})]})]},C.key))})});case"coverArt":return e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ne,{htmlFor:"coverArt",className:"text-right",children:"Image"}),e.jsx(we,{id:"coverArt",type:"file",onChange:T,className:"col-span-3",accept:"image/png, image/jpeg"})]});case"music":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:te?"Loading music…":"Pick a track or choose “No Music”."}),e.jsx("div",{className:"grid gap-2",children:I.map(C=>{const E=!!(C&&C.id!=="none"&&(C.preview_url||C.url||C.filename)),z=P===C.id,Z=V===C.id;return e.jsxs("div",{className:`flex items-center gap-3 p-2 rounded border ${z?"border-blue-600 bg-blue-50":"bg-card hover:border-muted-foreground/30"}`,children:[e.jsx("button",{type:"button","aria-label":Z?"Pause preview":"Play preview",disabled:!E,onClick:()=>E&&ce(C),className:`inline-flex items-center justify-center h-8 w-8 rounded border ${Z?"bg-blue-600 text-white border-blue-600":"bg-white text-foreground border-muted-foreground/30"} disabled:opacity-50`,title:E?"Preview 20s":"Preview not available",children:Z?e.jsx(ys,{className:"h-4 w-4"}):e.jsx(Xt,{className:"h-4 w-4"})}),e.jsxs("label",{className:"flex items-center gap-3 flex-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"music",value:C.id,checked:z,onChange:()=>_(C.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:C.display_name}),C.mood_tags&&C.mood_tags.length>0&&e.jsx("div",{className:"text-xs text-muted-foreground",children:C.mood_tags.slice(0,3).join(", ")})]})]})]},C.id)})})]});case"spreaker":return e.jsx("div",{className:"flex justify-center items-center p-6 bg-accent/30 rounded-[var(--radius)]",children:S?e.jsxs(M,{variant:"secondary",disabled:!0,className:"bg-green-600 text-white hover:bg-green-600",children:[e.jsx(Dt,{className:"w-5 h-5 mr-2"})," Connected"]}):e.jsx(M,{onClick:U,children:"Connect to Spreaker"})});case"publishDay":return null;case"publishCadence":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"I want to publish"}),e.jsx(we,{type:"number",min:1,value:de,onChange:C=>Ae(Math.max(1,parseInt(C.target.value||"1",10)||1)),className:"w-20"}),e.jsx("span",{className:"text-sm",children:"times every"}),e.jsxs("select",{className:"border rounded p-2",value:ie,onChange:C=>xe(C.target.value),children:[e.jsx("option",{value:"day",children:"day"}),e.jsx("option",{value:"week",children:"week"}),e.jsx("option",{value:"bi-weekly",children:"bi-weekly"}),e.jsx("option",{value:"month",children:"month"}),e.jsx("option",{value:"year",children:"year"})]})]}),qe&&e.jsx("p",{className:"text-sm text-red-600",children:qe}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"We’ll tailor the next step based on this."})]});case"publishSchedule":if(ie==="week"){const C=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],E=z=>tt(Z=>Z.includes(z)?Z.filter(H=>H!==z):[...Z,z]);return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:C.map(z=>e.jsx("button",{type:"button",onClick:()=>E(z),className:`border rounded p-2 text-center ${He.includes(z)?"border-blue-600 ring-1 ring-blue-400":"hover:border-gray-400"}`,children:z},z))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pick your publishing day(s) of the week."})]})}const be=(()=>{const C=new Date;C.setDate(1);const E=new Date(C.getFullYear(),C.getMonth()+1,1);return[C,E]})(),Oe=(C,E)=>new Date(C,E+1,0).getDate(),x=C=>String(C).padStart(2,"0"),F=C=>Le(E=>E.includes(C)?E.filter(z=>z!==C):[...E,C]),c=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.jsxs("div",{className:"space-y-4",children:[be.map((C,E)=>{const z=C.getFullYear(),Z=C.getMonth(),H=Oe(z,Z),me=new Date(z,Z,1).getDay(),Ce=[];for(let ke=0;ke<me;ke++)Ce.push({key:`b-${ke}`,blank:!0});for(let ke=1;ke<=H;ke++){const Ee=`${z}-${x(Z+1)}-${x(ke)}`;Ce.push({key:Ee,iso:Ee,day:ke})}for(;Ce.length%7!==0;)Ce.push({key:`t-${Ce.length}`,blank:!0});return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium text-sm",children:C.toLocaleString(void 0,{month:"long",year:"numeric"})}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-[11px] text-muted-foreground",children:c.map(ke=>e.jsx("div",{className:"py-1 text-center",children:ke},ke))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:Ce.map(ke=>{if(ke.blank)return e.jsx("div",{className:"p-2"},ke.key);const Ee=Je.includes(ke.iso);return e.jsx("button",{type:"button",onClick:()=>F(ke.iso),className:`border rounded p-2 text-center text-xs ${Ee?"border-blue-600 ring-1 ring-blue-400":"hover:border-gray-400"}`,children:ke.day},ke.key)})})]},E)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pick your first publishing day(s); we’ll take it from there."})]});case"finish":return e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Finish"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nice work. You can publish now or explore your dashboard."}),p&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"Working…"})]});case"rss":return e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ne,{htmlFor:"rssUrl",className:"text-right",children:"RSS URL"}),e.jsx(we,{id:"rssUrl",value:Q,onChange:C=>ee(C.target.value),className:"col-span-3",placeholder:"https://example.com/feed.xml"})]})});case"confirm":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm",children:"We’ll import episodes and assets from:"}),e.jsx("div",{className:"p-3 rounded border bg-accent/30 text-sm break-all",children:Q||"—"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Click Continue to start the import."})]});case"importing":return e.jsx("div",{className:"text-sm",children:"Importing… This may take a moment."});case"analyze":return e.jsx("div",{className:"text-sm",children:"Analyzing your feed and extracting settings…"});case"assets":return e.jsx("div",{className:"text-sm",children:"Pulling cover art and audio assets…"});case"importSuccess":return e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Imported"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your show is in Podcast Pro Plus. Explore your episodes on the dashboard."})]});default:return null}},validate:L.validate?L.validate:L.id==="publishCadence"?async()=>ie==="bi-weekly"&&Number(de)!==1?(Ke("For bi-weekly, X must be 1."),!1):(Ke(""),!0):L.id==="confirm"&&D==="import"?async()=>{try{if(!Q)return!0;const be=await fetch("/api/import/rss",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({rss_url:Q.trim()})})}catch{}return!0}:void 0}));return t.useEffect(()=>{let L;return D==="import"&&(re==="importing"?L=setTimeout(()=>m(fe=>Math.min(fe+1,B.length-1)),1e3):re==="analyze"?L=setTimeout(()=>m(fe=>Math.min(fe+1,B.length-1)),800):re==="assets"&&(L=setTimeout(()=>m(fe=>Math.min(fe+1,B.length-1)),800))),()=>{L&&clearTimeout(L)}},[D,re,B.length]),e.jsx(Tr,{steps:O,index:o,setIndex:m,onComplete:Y,prefs:{largeText:i,setLargeText:u,highContrast:y,setHighContrast:f},greetingName:Ve?.trim()||""})}function Qn(){return e.jsxs("div",{style:{padding:"2rem"},children:[e.jsx("h1",{children:"Admin Dashboard"}),e.jsx("p",{children:"Temporary placeholder component. Replace with the real dashboard."})]})}const Xn=({onClose:s})=>{const{login:a}=St(),[r,l]=t.useState(""),[n,o]=t.useState(""),[m,k]=t.useState(""),[i,u]=t.useState("login"),y=async h=>{h.preventDefault(),k("");try{const D=await fetch("/api/auth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({username:r,password:n})});if(D.ok){const d=await D.json();a(d.access_token),s()}else{const d=await D.json();k(d.detail||"Invalid email or password.")}}catch{k("An unexpected error occurred. Please try again.")}},f=async h=>{h.preventDefault(),k("");try{const D=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,password:n})});if(D.ok)await y(h);else{const d=await D.json().catch(()=>({}));k(d.detail||"Registration failed.")}}catch{k("Registration error. Please try again.")}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(_e,{className:"w-full max-w-md mx-4",children:[e.jsxs(Me,{className:"flex flex-row items-center justify-between",children:[e.jsx(Re,{children:i==="login"?"Sign In":"Create Account"}),e.jsx(M,{variant:"ghost",size:"sm",onClick:s,children:e.jsx(Cs,{className:"w-4 h-4"})})]}),e.jsxs(Se,{children:[e.jsxs("form",{onSubmit:i==="login"?y:f,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"email",children:"Email"}),e.jsx(we,{id:"email",type:"email",placeholder:"you@example.com",value:r,onChange:h=>l(h.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"password",children:"Password"}),e.jsx(we,{id:"password",type:"password",value:n,onChange:h=>o(h.target.value),required:!0})]}),m&&e.jsx("p",{className:"text-sm text-red-500",children:m}),e.jsx(M,{type:"submit",className:"w-full",children:i==="login"?"Sign In with Email":"Create Account"}),e.jsx("button",{type:"button",onClick:()=>{u(h=>h==="login"?"register":"login"),k("")},className:"w-full text-xs text-blue-600 hover:underline",children:i==="login"?"Need an account? Sign up":"Have an account? Sign in"})]}),e.jsxs("div",{className:"relative my-4",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-white px-2 text-muted-foreground",children:"Or continue with"})})]}),e.jsx("a",{href:"https://api.getpodcastplus.com/api/auth/login/google",className:"block",children:e.jsx(M,{variant:"outline",className:"w-full",children:"Sign In with Google"})})]})]})})};function Ca(){const[s,a]=t.useState(!1),[r,l]=t.useState(!1),[n,o]=t.useState([]),{brand:m}=pr();t.useEffect(()=>{try{new URLSearchParams(window.location.search).get("login")==="1"&&l(!0)}catch{}},[]),t.useEffect(()=>{fetch("/api/public/episodes").then(i=>i.ok?i.json():Promise.reject(i.status)).then(i=>o(Array.isArray(i.items)?i.items:[])).catch(()=>{})},[]);const k=()=>{a(!s)};return e.jsxs("div",{className:"min-h-screen bg-white",children:[r&&e.jsx(Xn,{onClose:()=>l(!1)}),e.jsx("nav",{className:"px-4 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"container mx-auto max-w-6xl flex justify-between items-center",children:[e.jsx(xr,{size:28,lockup:!0}),e.jsxs("div",{className:"hidden md:flex items-center space-x-8",children:[e.jsx("a",{href:"#how-it-works",className:"text-gray-600 hover:text-gray-800 transition-colors",children:"How It Works"}),e.jsx("a",{href:"#testimonials",className:"text-gray-600 hover:text-gray-800 transition-colors",children:"Reviews"}),e.jsx("a",{href:"#faq",className:"text-gray-600 hover:text-gray-800 transition-colors",children:"FAQ"}),e.jsx("a",{href:"/ab",className:"text-gray-600 hover:text-gray-800 transition-colors",children:"A/B"}),e.jsx(M,{onClick:()=>l(!0),variant:"outline",className:"border-2 bg-transparent",style:{borderColor:"#2C3E50",color:"#2C3E50"},children:"Sign In"})]})]})}),e.jsxs("section",{className:"px-4 py-16 md:py-24 lg:py-32 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50 to-purple-50 opacity-30"}),e.jsxs("div",{className:"container mx-auto max-w-5xl text-center relative z-10",children:[e.jsx(ft,{className:"mb-6 px-4 py-2 text-sm font-medium",style:{backgroundColor:"#ECF0F1",color:"#2C3E50"},children:"🎉 Over 10,000 podcasters trust Podcast Plus"}),e.jsx("h1",{className:"text-4xl md:text-6xl lg:text-7xl font-bold mb-6 leading-tight",style:{color:"#2C3E50"},children:m.heroH1}),e.jsx("p",{className:"text-xl md:text-2xl lg:text-3xl mb-8 text-gray-600 max-w-4xl mx-auto leading-relaxed",children:m.heroSub}),e.jsxs("p",{className:"text-lg md:text-xl mb-12 text-gray-500 max-w-3xl mx-auto",children:["Join thousands of creators who've discovered the joy of effortless podcasting.",e.jsx("strong",{className:"text-gray-700",children:" Average setup time: Under 5 minutes."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center mb-12",children:[e.jsxs(M,{size:"lg",onClick:()=>l(!0),className:"text-lg px-8 py-6 font-semibold rounded-[var(--radius)] hover:opacity-90 transition-all transform hover:scale-105 shadow-lg",children:["Make my first episode",e.jsx(xa,{className:"ml-2 w-5 h-5"})]}),e.jsxs(M,{variant:"outline",size:"lg",className:"text-lg px-8 py-6 font-semibold rounded-[var(--radius)] border bg-secondary text-secondary-foreground hover:opacity-90 transition-all",onClick:k,children:[e.jsx(Xt,{className:"mr-2 w-5 h-5"}),"See how it works"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-6 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Dt,{className:"w-4 h-4 mr-2 text-green-500"}),"Free 14-day trial"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Dt,{className:"w-4 h-4 mr-2 text-green-500"}),"No credit card required"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Dt,{className:"w-4 h-4 mr-2 text-green-500"}),"Cancel anytime"]})]})]})]}),e.jsx("section",{className:"px-4 py-12",style:{backgroundColor:"#ECF0F1"},children:e.jsx("div",{className:"container mx-auto max-w-4xl",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-8 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-2",style:{color:"#2C3E50"},children:"10K+"}),e.jsx("div",{className:"text-gray-600",children:"Active Podcasters"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-2",style:{color:"#2C3E50"},children:"50K+"}),e.jsx("div",{className:"text-gray-600",children:"Episodes Published"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-2",style:{color:"#2C3E50"},children:"95%"}),e.jsx("div",{className:"text-gray-600",children:"Customer Satisfaction"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-2",style:{color:"#2C3E50"},children:"5 Min"}),e.jsx("div",{className:"text-gray-600",children:"Average Setup Time"})]})]})})}),e.jsx("section",{id:"how-it-works",className:"px-4 py-16 md:py-24",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl md:text-4xl lg:text-5xl font-bold mb-6",style:{color:"#2C3E50"},children:"How It Works: Podcasting, Simplified."}),e.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Three simple steps to go from idea to published podcast. No technical expertise required."})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-8 lg:gap-12",children:[e.jsxs("div",{className:"text-center group",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-br from-blue-100 to-purple-100 flex items-center justify-center shadow-lg group-hover:shadow-xl transition-all transform group-hover:scale-105",children:e.jsx(Vt,{className:"w-12 h-12",style:{color:"#2C3E50"}})}),e.jsx(ft,{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-1",children:"Step 1"})]}),e.jsx("h3",{className:"text-xl md:text-2xl font-semibold mb-4",style:{color:"#2C3E50"},children:"Record or Generate Audio"}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed mb-4",children:"Simply speak into your device, upload existing audio, or let our AI generate content from your notes."}),e.jsx("div",{className:"text-sm text-gray-500",children:"✓ Works with any device • ✓ AI content generation • ✓ Multiple formats supported"})]}),e.jsxs("div",{className:"text-center group",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-br from-green-100 to-blue-100 flex items-center justify-center shadow-lg group-hover:shadow-xl transition-all transform group-hover:scale-105",children:e.jsx(Vs,{className:"w-12 h-12",style:{color:"#2C3E50"}})}),e.jsx(ft,{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-1",children:"Step 2"})]}),e.jsx("h3",{className:"text-xl md:text-2xl font-semibold mb-4",style:{color:"#2C3E50"},children:"Automate Production & Polishing"}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed mb-4",children:"Our AI handles editing, noise reduction, music, and professional formatting automatically."}),e.jsx("div",{className:"text-sm text-gray-500",children:"✓ Auto noise removal • ✓ Music & intros • ✓ Professional editing"})]}),e.jsxs("div",{className:"text-center group",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-br from-purple-100 to-pink-100 flex items-center justify-center shadow-lg group-hover:shadow-xl transition-all transform group-hover:scale-105",children:e.jsx(en,{className:"w-12 h-12",style:{color:"#2C3E50"}})}),e.jsx(ft,{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-1",children:"Step 3"})]}),e.jsx("h3",{className:"text-xl md:text-2xl font-semibold mb-4",style:{color:"#2C3E50"},children:"Publish & Share Instantly"}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed mb-4",children:"Your podcast goes live on Spotify, Apple Podcasts, and 20+ platforms with just one click."}),e.jsx("div",{className:"text-sm text-gray-500",children:"✓ 20+ platforms • ✓ Automatic distribution • ✓ Analytics included"})]})]}),e.jsx("div",{className:"text-center mt-12",children:e.jsx(M,{size:"lg",className:"text-lg px-8 py-4 rounded-lg font-semibold text-white hover:opacity-90 transition-all",style:{backgroundColor:"#2C3E50"},children:"Try It Free for 14 Days"})})]})}),e.jsx("section",{className:"px-4 py-16 md:py-24",style:{backgroundColor:"#ECF0F1"},children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl md:text-4xl lg:text-5xl font-bold mb-8",style:{color:"#2C3E50"},children:"Why 10,000+ Creators Choose Podcast Plus"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[e.jsx(_e,{className:"border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105 bg-white",children:e.jsxs(Se,{className:"p-8 text-center",children:[e.jsx(nr,{className:"w-16 h-16 mx-auto mb-6",style:{color:"#2C3E50"}}),e.jsx("h3",{className:"text-2xl font-semibold mb-4",style:{color:"#2C3E50"},children:"Save 10+ Hours Per Episode"}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed",children:"What used to take days now takes minutes. Spend your time creating content, not fighting technology."})]})}),e.jsx(_e,{className:"border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105 bg-white",children:e.jsxs(Se,{className:"p-8 text-center",children:[e.jsx(tn,{className:"w-16 h-16 mx-auto mb-6",style:{color:"#2C3E50"}}),e.jsx("h3",{className:"text-2xl font-semibold mb-4",style:{color:"#2C3E50"},children:"Zero Technical Knowledge Required"}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed",children:"If you can send an email, you can create a professional podcast. We handle all the complex stuff."})]})}),e.jsx(_e,{className:"border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105 bg-white",children:e.jsxs(Se,{className:"p-8 text-center",children:[e.jsx(Us,{className:"w-16 h-16 mx-auto mb-6",style:{color:"#2C3E50"}}),e.jsx("h3",{className:"text-2xl font-semibold mb-4",style:{color:"#2C3E50"},children:"Studio-Quality Results"}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed",children:"Professional sound quality that rivals expensive studios, without the expensive equipment."})]})})]})]})})}),e.jsx("section",{id:"testimonials",className:"px-4 py-16 md:py-24",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[n.length>0&&e.jsxs("div",{className:"mb-16",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",style:{color:"#2C3E50"},children:"Recently Published with Podcast Plus"}),e.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:n.map(i=>e.jsxs(_e,{className:"overflow-hidden",children:[e.jsx("div",{className:"h-40 bg-gray-100",children:i.cover_url?e.jsx("img",{src:i.cover_url,alt:i.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-400",children:"No Cover"})}),e.jsx(Me,{children:e.jsx(Re,{className:"text-lg line-clamp-1",children:i.title})}),e.jsxs(Se,{children:[e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3 mb-2",children:i.description}),i.final_audio_url&&e.jsx("audio",{controls:!0,src:i.final_audio_url,className:"w-full"})]})]},i.id))})]}),e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl md:text-4xl lg:text-5xl font-bold mb-6",style:{color:"#2C3E50"},children:"Real Stories from Real Podcasters"}),e.jsxs("div",{className:"flex justify-center items-center mb-8",children:[e.jsx("div",{className:"flex",children:[...Array(5)].map((i,u)=>e.jsx(xs,{className:"w-6 h-6 fill-yellow-400 text-yellow-400"},u))}),e.jsx("span",{className:"ml-2 text-lg text-gray-600",children:"4.9/5 from 2,847 reviews"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[e.jsx(_e,{className:"border-0 shadow-lg hover:shadow-xl transition-all bg-white",children:e.jsxs(Se,{className:"p-8",children:[e.jsx("div",{className:"flex mb-4",children:[...Array(5)].map((i,u)=>e.jsx(xs,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},u))}),e.jsx("p",{className:"text-gray-700 leading-relaxed mb-6 text-lg",children:'"I was terrified of the technical side of podcasting. Podcast Plus made it so simple that I launched my first episode in under 30 minutes! Now I have 50+ episodes and growing."'}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:"https://placehold.co/60x60/E2E8F0/A0AEC0?text=Avatar",alt:"Sarah Johnson",width:60,height:60,className:"rounded-full mr-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",style:{color:"#2C3E50"},children:"Sarah Johnson"}),e.jsx("p",{className:"text-gray-600",children:"Small Business Owner • 6 months on Podcast Plus"})]})]})]})}),e.jsx(_e,{className:"border-0 shadow-lg hover:shadow-xl transition-all bg-white",children:e.jsxs(Se,{className:"p-8",children:[e.jsx("div",{className:"flex mb-4",children:[...Array(5)].map((i,u)=>e.jsx(xs,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},u))}),e.jsx("p",{className:"text-gray-700 leading-relaxed mb-6 text-lg",children:`"I've saved 15+ hours every week since switching to Podcast Plus. The AI editing is incredible - it sounds better than when I did it manually!"`}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:"https://placehold.co/60x60/E2E8F0/A0AEC0?text=Avatar",alt:"Robert Chen",width:60,height:60,className:"rounded-full mr-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",style:{color:"#2C3E50"},children:"Robert Chen"}),e.jsx("p",{className:"text-gray-600",children:"Retired Teacher • 1 year on Podcast Plus"})]})]})]})}),e.jsx(_e,{className:"border-0 shadow-lg hover:shadow-xl transition-all bg-white",children:e.jsxs(Se,{className:"p-8",children:[e.jsx("div",{className:"flex mb-4",children:[...Array(5)].map((i,u)=>e.jsx(xs,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},u))}),e.jsx("p",{className:"text-gray-700 leading-relaxed mb-6 text-lg",children:'"My podcast now reaches 10,000+ listeners monthly. The automatic distribution to all platforms was a game-changer for my reach!"'}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:"https://placehold.co/60x60/E2E8F0/A0AEC0?text=Avatar",alt:"Maria Rodriguez",width:60,height:60,className:"rounded-full mr-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",style:{color:"#2C3E50"},children:"Maria Rodriguez"}),e.jsx("p",{className:"text-gray-600",children:"Community Leader • 8 months on Podcast Plus"})]})]})]})})]})]})}),e.jsx("section",{id:"faq",className:"px-4 py-16 md:py-24",style:{backgroundColor:"#ECF0F1"},children:e.jsxs("div",{className:"container mx-auto max-w-4xl",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl md:text-4xl lg:text-5xl font-bold mb-6",style:{color:"#2C3E50"},children:"Frequently Asked Questions"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Everything you need to know about getting started with Podcast Plus"})]}),e.jsx("div",{className:"space-y-6",children:[{q:"Do I need any technical experience to use Podcast Plus?",a:"Absolutely not! Podcast Plus is designed for complete beginners. If you can use email, you can create professional podcasts with our platform."},{q:"How long does it take to publish my first episode?",a:"Most users publish their first episode within 30 minutes of signing up. Our average setup time is under 5 minutes, and episode creation takes just a few more minutes."},{q:"What platforms will my podcast be available on?",a:"Your podcast will automatically be distributed to 20+ major platforms including Spotify, Apple Podcasts, Google Podcasts, and many more with just one click."},{q:"Is there really a free trial with no credit card required?",a:"Yes! You get full access to all features for 14 days completely free. No credit card required, no hidden fees, and you can cancel anytime."},{q:"What if I'm not satisfied with the service?",a:"We offer a 30-day money-back guarantee. If you're not completely satisfied, we'll refund your payment, no questions asked."}].map((i,u)=>e.jsx(_e,{className:"border-0 shadow-md bg-white",children:e.jsxs(Se,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",style:{color:"#2C3E50"},children:i.q}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:i.a})]})},u))})]})}),e.jsx("section",{className:"px-4 py-16 md:py-24",children:e.jsxs("div",{className:"container mx-auto max-w-5xl text-center",children:[e.jsx("h2",{className:"text-3xl md:text-4xl lg:text-5xl font-bold mb-6",style:{color:"#2C3E50"},children:"Ready to Start Your Podcast Journey?"}),e.jsx("p",{className:"text-xl md:text-2xl mb-8 text-gray-600 leading-relaxed max-w-3xl mx-auto",children:"Join over 10,000 creators who've discovered the joy of effortless podcasting. Start your free trial today - no credit card required."}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center mb-8",children:e.jsxs(M,{size:"lg",onClick:()=>l(!0),className:"text-xl px-10 py-6 rounded-lg font-semibold text-white hover:opacity-90 transition-all transform hover:scale-105 shadow-lg",style:{backgroundColor:"#2C3E50"},children:["Start Your Free 14-Day Trial",e.jsx(xa,{className:"ml-2 w-6 h-6"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-6 text-sm text-gray-500 mb-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Dt,{className:"w-4 h-4 mr-2 text-green-500"}),"14-day free trial"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Dt,{className:"w-4 h-4 mr-2 text-green-500"}),"No credit card required"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Dt,{className:"w-4 h-4 mr-2 text-green-500"}),"30-day money-back guarantee"]})]}),e.jsx("div",{className:"text-center",children:e.jsx(ft,{className:"px-4 py-2 text-sm font-medium",style:{backgroundColor:"#ECF0F1",color:"#2C3E50"},children:"🔒 Trusted by 10,000+ podcasters worldwide"})})]})}),e.jsx("footer",{className:"px-4 py-12 border-t border-gray-200",style:{backgroundColor:"#ECF0F1"},children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 mb-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(sn,{className:"w-6 h-6",style:{color:"#2C3E50"}}),e.jsx("span",{className:"text-xl font-bold",style:{color:"#2C3E50"},children:"Podcast Plus"})]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Making podcasting accessible to everyone, regardless of technical expertise."}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded"}),e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded"}),e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",style:{color:"#2C3E50"},children:"Product"}),e.jsxs("ul",{className:"space-y-2 text-gray-600",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Features"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Pricing"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Templates"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Integrations"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",style:{color:"#2C3E50"},children:"Support"}),e.jsxs("ul",{className:"space-y-2 text-gray-600",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Help Center"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Contact Us"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Tutorials"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Community"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",style:{color:"#2C3E50"},children:"Company"}),e.jsxs("ul",{className:"space-y-2 text-gray-600",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"About Us"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Blog"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Careers"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Press"})})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-8 flex flex-col md:flex-row justify-between items-center",children:[e.jsx("p",{className:"text-gray-600 mb-4 md:mb-0",children:"Podcast Plus © 2025. All rights reserved."}),e.jsxs("div",{className:"flex space-x-6",children:[e.jsx("a",{href:"#",className:"text-gray-600 hover:text-gray-800 transition-colors",children:"Privacy Policy"}),e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Terms of Service"}),e.jsx("a",{href:"#",className:"hover:text-gray-800 transition-colors",children:"Cookie Policy"})]})]})]})})]})}function ka(){const{user:s,token:a,logout:r}=St(),{toast:l}=gt(),[n,o]=t.useState(s?.email||""),[m,k]=t.useState(""),[i,u]=t.useState(!1),y=async f=>{if(f?.preventDefault?.(),!!n){u(!0);try{const h=await fetch("/api/public/waitlist",{method:"POST",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}},body:JSON.stringify({email:n,note:m||void 0})});if(h.ok)l({title:"Request received",description:"We'll notify you as soon as a spot opens."}),k("");else{let D="Please try again later.";try{const d=await h.json();D=d?.error?.message||d?.detail||D}catch{}l({title:"Couldn't save your request",description:D,variant:"destructive"})}}catch{l({title:"Network error",description:"Check your connection and try again.",variant:"destructive"})}finally{u(!1)}}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-white p-4",children:e.jsxs(_e,{className:"w-full max-w-xl shadow-sm border-slate-200",children:[e.jsx(Me,{children:e.jsx(Re,{className:"text-2xl",children:"Private preview access"})}),e.jsxs(Se,{className:"space-y-5 text-slate-700",children:[e.jsx("p",{children:"This application is currently in a closed alpha. If you've recently signed up and we recognize your email, your account will be approved shortly. If you'd like to join the pre-launch test group, leave your email below and we'll reach out as soon as new slots open."}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"email",children:"Email"}),e.jsx(we,{id:"email",type:"email",required:!0,value:n,onChange:f=>o(f.target.value),placeholder:"you@example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"note",children:"Optional note"}),e.jsx(we,{id:"note",type:"text",value:m,onChange:f=>k(f.target.value),placeholder:"Tell us a bit about your use case"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx(M,{type:"submit",disabled:i,children:i?"Sending...":"Request early access"}),e.jsx(M,{type:"button",variant:"outline",onClick:r,children:"Sign out"})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"We'll only use your email to notify you about access and important updates. No spam."})]})]})]})})}const Zn=Ci,Dr=t.forwardRef(({className:s,...a},r)=>e.jsx(Qa,{asChild:!0,...a,children:e.jsx("div",{ref:r,role:"region","aria-label":"Notifications",className:Fe("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s)})}));Dr.displayName=Qa.displayName;const el=Ss("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Mr=t.forwardRef(({className:s,variant:a,...r},l)=>e.jsx(Xa,{ref:l,className:Fe(el({variant:a}),s),...r}));Mr.displayName=Xa.displayName;const tl=t.forwardRef(({className:s,...a},r)=>e.jsx(Za,{ref:r,className:Fe("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...a}));tl.displayName=Za.displayName;const Rr=t.forwardRef(({className:s,...a},r)=>e.jsx(er,{ref:r,className:Fe("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...a,children:e.jsx(Cs,{className:"h-4 w-4"})}));Rr.displayName=er.displayName;const Fr=t.forwardRef(({className:s,...a},r)=>e.jsx(tr,{ref:r,className:Fe("text-sm font-semibold [&+div]:text-xs",s),...a}));Fr.displayName=tr.displayName;const $r=t.forwardRef(({className:s,...a},r)=>e.jsx(sr,{ref:r,className:Fe("text-sm opacity-90",s),...a}));$r.displayName=sr.displayName;function sl(){const{toasts:s}=gt();return e.jsxs(Zn,{children:[s.map(function({id:a,title:r,description:l,action:n,...o}){return e.jsxs(Mr,{...o,children:[e.jsxs("div",{className:"grid gap-1",children:[r&&e.jsx(Fr,{children:r}),l&&e.jsx($r,{children:l})]}),n,e.jsx(Rr,{"aria-label":"Close notification"})]},a)}),e.jsx(Dr,{"aria-label":"Notifications"})]})}function al({title:s,description:a}){return t.useEffect(()=>{s&&(document.title=s)},[s]),null}const Ea={},Aa=s=>!!(s&&(s.is_admin||s.role==="admin"));function rl(){const{isAuthenticated:s,token:a,login:r,logout:l,user:n,refreshUser:o}=St(),[m,k]=t.useState(!0),[i,u]=t.useState(!1),[y,f]=t.useState(null),{toast:h}=gt(),[D,d]=t.useState({checked:!1,allowed:!1}),[N,j]=Ot.useState({loading:!0,count:0,fetched:!1});t.useEffect(()=>{(async()=>{const p=window.location.hash;if(p){const W=new URLSearchParams(p.substring(1)).get("access_token");W&&(r(W),window.location.hash="")}if(new URLSearchParams(window.location.search).get("checkout")==="success"){u(!0),f(Date.now());try{localStorage.setItem("ppp_post_checkout","1")}catch{}}k(!1)})()},[a,r]),t.useEffect(()=>{if(!i||s)return;o({force:!0});let v=0;const p=setInterval(()=>{v+=1,o({force:!0}),v>8&&clearInterval(p)},750);return()=>clearInterval(p)},[i,s,o]),t.useEffect(()=>{if(!s||N.fetched)return;let v=!1;return(async()=>{try{const b=await ge(a).get("/api/podcasts/");if(!v){const A=Array.isArray(b)?b:b.items||[];j({loading:!1,count:A.length,fetched:!0})}}catch{v||j({loading:!1,count:0,fetched:!0})}})(),()=>{v=!0}},[s,a,N.fetched]),t.useEffect(()=>{let v=!1;return(async()=>{if(d(p=>({...p,checked:!1,allowed:!1})),!s||!n||!Aa(n)){d({checked:!0,allowed:!1});return}try{await ge(a).get("/api/admin/summary"),v||d({checked:!0,allowed:!0})}catch{v||(d({checked:!0,allowed:!1}),h({title:"Admin access denied",description:"Falling back to dashboard."}))}})(),()=>{v=!0}},[s,a,n]);const S=window.location.pathname;if(n&&n.is_active===!1)return e.jsx(ka,{});if(S==="/dashboard/settings")return e.jsx(Cr,{token:a});if(i&&!s){if(a)return e.jsx(Na,{});const v=y?Date.now()-y:0;return e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen space-y-4",children:[e.jsx("div",{className:"text-xl font-semibold",children:"Finalizing your purchase..."}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This will update automatically."}),v>8e3&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-red-500",children:"Still working... you can manually sign back in if this persists."}),e.jsx("button",{onClick:()=>{try{window.location.href="/?login=1"}catch{}},className:"text-xs text-blue-600 underline",children:"Open sign-in modal"})]})]})}if(!s&&!a)return e.jsx(Ca,{});if(m)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."});if(!s)return e.jsx(Ca,{});if(n){if(n.is_active===!1)return e.jsx(ka,{});if(N.loading)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Preparing your workspace..."});const p=new URLSearchParams(window.location.search).get("onboarding")==="1",b=Ea?.VITE_ONBOARDING_FULLPAGE==="true"||Ea?.ONBOARDING_FULLPAGE==="true";if(b&&N.count===0)return e.jsx(Pr,{});if(!b&&p&&N.count===0)return e.jsx(Hn,{});if(Aa(n)){if(!D.checked)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Checking admin access..."});if(D.allowed)return e.jsx(Qn,{})}return e.jsx(Na,{})}return e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."})}function il(){return e.jsxs(e.Fragment,{children:[e.jsx(al,{}),e.jsx(rl,{}),e.jsx(sl,{})]})}function nl(){return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center px-6 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"404 — Page not found"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"We couldn't find the page you're looking for."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(vs,{to:"/",className:"text-blue-600 underline",children:"Go Home"}),e.jsx(vs,{to:"/",className:"text-blue-600 underline",children:"Open Dashboard"})]})]})}function Ta(){return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center px-6 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"An unexpected error occurred. Please try again."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(vs,{to:"/",className:"text-blue-600 underline",children:"Go Home"}),e.jsx(vs,{to:"/",className:"text-blue-600 underline",children:"Open Dashboard"})]})]})}function ll(s){if(!s)return"";try{const a=new Date(s),r=new Date,l=o=>String(o).padStart(2,"0");return a.toDateString()===r.toDateString()?`${l(a.getHours())}:${l(a.getMinutes())}`:`${a.getMonth()+1}/${a.getDate()} ${l(a.getHours())}:${l(a.getMinutes())}`}catch{return""}}function ol({onSwitch:s,active:a}){const{token:r,user:l}=St()||{},n=[{id:"dashboard",label:"Dashboard"},{id:"creator-upload",label:"New Episode"},{id:"settings",label:"Settings"}],[o,m]=t.useState([]),[k,i]=t.useState(!1),u=t.useMemo(()=>l&&[l.picture,l.avatar,l.photo_url,l.image_url,l.picture_url,l.profile&&l.profile.picture,Array.isArray(l.photos)&&l.photos[0]&&l.photos[0].value,Array.isArray(l.identities)&&l.identities[0]&&l.identities[0].picture,Array.isArray(l.providerData)&&l.providerData[0]&&l.providerData[0].photoURL,l.user_metadata&&l.user_metadata.avatar_url,l.oauth_picture].filter(Boolean).find(j=>typeof j=="string"&&j.trim().length>0)||null,[l]),y=t.useMemo(()=>{if(!l)return"";const d=[l.first_name,l.last_name].filter(Boolean).join(" ")||l.name||"";return d.trim()?d.trim().split(/\s+/).slice(0,2).map(j=>j[0]).join("").toUpperCase():l.email?l.email.slice(0,2).toUpperCase():""},[l]);t.useEffect(()=>{let d=!1;if(!r){m([]);return}return(async()=>{try{const j=await ge(r).get("/api/notifications/");!d&&Array.isArray(j)&&m(j.sort((S,v)=>new Date(v.created_at||0)-new Date(S.created_at||0)))}catch{}})(),()=>{d=!0}},[r]);const f=o.filter(d=>!d.read_at).length,h=async()=>{if(r)try{await ge(r).post("/api/notifications/read-all"),m(N=>N.map(j=>j.read_at?j:{...j,read_at:new Date().toISOString()}))}catch{}},D=async d=>{if(r)try{await ge(r).post(`/api/notifications/${d}/read`),m(j=>j.map(S=>S.id===d?{...S,read_at:new Date().toISOString()}:S))}catch{}};return e.jsx("header",{className:"sticky top-0 z-40 w-full border-b bg-background/80 backdrop-blur",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-8 rounded-xl bg-indigo-600"}),e.jsx("span",{className:"font-semibold tracking-tight",children:"Podcast-Pro-Plus"})]}),e.jsx("nav",{className:"hidden md:flex items-center gap-1",children:n.map(d=>e.jsx("button",{onClick:()=>s(d.id),className:"px-3 py-2 rounded-lg text-sm font-medium focus:outline-none focus-visible:ring "+(a===d.id?"bg-indigo-600 text-white":"hover:bg-muted"),children:d.label},d.id))}),e.jsxs("div",{className:"flex items-center gap-3 relative",children:[e.jsxs("button",{className:"relative rounded-lg hover:bg-muted p-2 focus:outline-none focus-visible:ring","aria-label":"Notifications",onClick:()=>i(d=>!d),disabled:!r,children:[e.jsx(cr,{className:"w-5 h-5"}),f>0&&e.jsx(ft,{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center bg-red-500 text-white text-xs",children:f})]}),k&&e.jsxs("div",{className:"absolute right-12 top-10 w-80 bg-white border border-gray-200 rounded shadow-lg z-50 max-h-96 overflow-auto",children:[e.jsxs("div",{className:"p-3 font-semibold border-b flex items-center justify-between",children:[e.jsx("span",{children:"Notifications"}),f>0&&e.jsx("button",{className:"text-xs text-blue-600 hover:underline",onClick:h,children:"Mark all read"})]}),o.length===0&&e.jsx("div",{className:"p-3 text-sm text-gray-500",children:"No notifications"}),o.map(d=>e.jsxs("div",{className:"p-3 text-sm border-b last:border-b-0 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium mr-2 truncate",children:d.title}),e.jsx("div",{className:"text-[11px] text-gray-500 whitespace-nowrap",children:ll(d.created_at)})]}),d.body&&e.jsx("div",{className:"text-gray-600 text-xs",children:d.body}),!d.read_at&&e.jsx("button",{className:"text-xs text-blue-600 self-start",onClick:()=>D(d.id),children:"Mark read"})]},d.id))]}),e.jsxs(qs,{className:"h-8 w-8",children:[u&&e.jsx(Hs,{src:u,alt:"avatar",onError:d=>{try{d.currentTarget.style.display="none"}catch{}}}),e.jsx(Gs,{children:y||""})]})]})]})})}const cl=()=>e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M4 6h16M4 12h16M4 18h10",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})}),dl=()=>e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 16V4m0 0l4 4m-4-4l-4 4M4 20h16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),Ia=()=>e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"9",y:"3",width:"6",height:"10",rx:"3",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M5 11a7 7 0 0 0 14 0M12 18v3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),ul=()=>e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 3l9 5-9 5-9-5 9-5z",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M21 12l-9 5-9-5",stroke:"currentColor",strokeWidth:"1.5"})]}),ml=()=>e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"3",y:"5",width:"18",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M3 10h18",stroke:"currentColor",strokeWidth:"1.5"})]});function hl({collapsed:s,setCollapsed:a,onNavigate:r,active:l}){const n=[{label:"Episodes",icon:e.jsx(cl,{}),route:"episode-history"},{label:"Record",icon:e.jsx(Ia,{}),route:"recorder"},{label:"Media Uploads",icon:e.jsx(dl,{}),route:"media-library"},{label:"My Podcasts",icon:e.jsx(Ia,{}),route:"podcast-manager"},{label:"Templates",icon:e.jsx(ul,{}),route:"my-templates"},{label:"Subscription",icon:e.jsx(ml,{}),route:"billing"}];return e.jsxs("aside",{className:(s?"w-16 ":"w-64 ")+"shrink-0 border-r bg-card",children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-3 border-b",children:[e.jsx("span",{className:"text-sm font-medium truncate "+(s?"sr-only":""),children:"Workspace"}),e.jsx("button",{className:"size-8 grid place-items-center rounded-lg hover:bg-muted focus:outline-none focus-visible:ring",title:s?"Expand":"Collapse",onClick:()=>a(o=>!o),children:e.jsx("span",{"aria-hidden":"true",children:"≡"})})]}),e.jsx("nav",{className:"p-2 space-y-1",children:n.map((o,m)=>e.jsxs("button",{className:"w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm "+(l===o.route?"bg-muted font-medium":"hover:bg-muted"),onClick:()=>{r&&r(o.route),window.scrollTo({top:0,behavior:"smooth"})},children:[e.jsx("span",{className:"size-5 grid place-items-center rounded",children:o.icon}),e.jsx("span",{className:s?"sr-only":"truncate",children:o.label})]},m))})]})}function Jt({label:s,value:a,sub:r}){return e.jsxs("div",{className:"rounded-2xl border bg-card p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:s}),e.jsx("div",{className:"mt-1 text-2xl font-semibold tracking-tight",children:a}),r&&e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:r})]})}function pl({token:s,shows:a,drafts:r,onOpenDraft:l,setActive:n}){const[o,m]=t.useState("All"),[k,i]=t.useState({episodes:null,minutesLeft:null,scheduled:null,episodesThisWeek:null,playsLast30d:null,recentPlays:[]}),[u,y]=t.useState(null);t.useEffect(()=>{let h=!1;return(async()=>{if(!s){i({episodes:null,minutesLeft:null,scheduled:null,episodesThisWeek:null,playsLast30d:null,recentPlays:[]}),y(null);return}try{y(null);const D=ge(s);let d=null,N=null,j=new Map,S=new Map;try{const A=await D.get("/api/episodes/?limit=200");if(d=Array.isArray(A?.items)?A.items.length:Array.isArray(A)?A.length:null,typeof A?.total=="number"&&(d=A.total),Array.isArray(A?.items)){const W=new Date().toISOString();N=A.items.filter($=>$.status==="scheduled"||$.publish_at&&$.publish_at>W).length;for(const $ of A.items)!$||!$.id||(j.set(String($.id),$.title||"Untitled"),S.set(String($.id),{publish_at:$.publish_at||$.processed_at||$.created_at||null}))}}catch{y("Failed to load episode stats.")}let v=null;try{const A=await D.get("/api/billing/usage");if(A)if(typeof A.minutes_left=="number")v=A.minutes_left;else{const W=A.processing_minutes_used_this_month,$=A.max_processing_minutes_month;typeof $=="number"&&typeof W=="number"?v=Math.max(0,$-W):$==null&&(v="∞")}}catch{y("Failed to load usage stats.")}let p=null,b=[];try{const A=await D.get("/api/users/me/stats");if(typeof A?.plays_last_30d=="number"&&(p=A.plays_last_30d),p==null){const $=await D.get("/api/spreaker/analytics/plays/shows?window=last30d");if($&&$.totals){let G=0;for(const Q of Object.keys($.totals)){const ee=$.totals[Q]?.plays_total;typeof ee=="number"&&(G+=ee)}p=isNaN(G)?null:G}}const W=await D.get("/api/spreaker/analytics/plays/episodes?window=last30d");if(Array.isArray(W?.items)){const $=W.items.map(G=>({...G,title:j.get(String(G.episode_id))||G.title||"Untitled",_pub:S.get(String(G.episode_id))?.publish_at||null}));$.sort((G,Q)=>{const ee=G?._pub?new Date(G._pub).getTime():0;return(Q?._pub?new Date(Q._pub).getTime():0)-ee}),b=$.slice(0,3)}}catch{y("Failed to load play stats.")}try{const A=await D.get("/api/users/me/stats");b.length===0&&Array.isArray(A?.recent_episode_plays)&&(b=A.recent_episode_plays.slice(0,3).map(W=>({episode_id:W.episode_id,plays_total:W.plays_total,title:W.title||j.get(String(W.episode_id))||"Untitled"})))}catch{y("Failed to load recent episode stats.")}i(A=>h?A:{...A,episodes:d,minutesLeft:v,scheduled:N,playsLast30d:p,recentPlays:b})}catch{h||(i({episodes:null,minutesLeft:null,scheduled:null,episodesThisWeek:null,playsLast30d:null,recentPlays:[]}),y("Failed to load dashboard stats."))}})(),()=>{h=!0}},[s]);const f=t.useMemo(()=>r.map(h=>{const D=h.transcript==="ready"?"Transcript ready":"Transcribing";return{id:h.id,title:h.title,status:D}}),[r]);return e.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold tracking-tight",children:"Welcome back"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ship a new episode in minutes."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Podcast"}),e.jsxs("select",{className:"rounded-lg border px-2 py-1 text-sm",value:o,onChange:h=>m(h.target.value),children:[e.jsx("option",{children:"All"}),a.map(h=>e.jsx("option",{children:h.name},h.id))]})]}),e.jsx("button",{className:"rounded-xl bg-indigo-600 px-4 py-2 text-white shadow hover:bg-indigo-500 focus:outline-none focus-visible:ring",onClick:()=>n("creator-upload"),children:"New Episode"})]})]}),u&&e.jsx("div",{className:"bg-red-100 border border-red-300 text-red-700 rounded p-3 mb-4 text-sm",children:u}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Jt,{label:"Episodes",value:(k.episodes??"—").toString(),sub:k.episodesThisWeek?`+${k.episodesThisWeek} this week`:void 0}),e.jsx(Jt,{label:"Scheduled",value:(k.scheduled??"—").toString()}),e.jsx(Jt,{label:"Drafts",value:f.length.toString()}),e.jsx(Jt,{label:"Minutes Left",value:(k.minutesLeft??"—").toString()})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Jt,{label:"Plays Last 30 Days",value:(k.playsLast30d??"—").toString()}),(k.recentPlays||[]).slice(0,3).map((h,D)=>e.jsx(Jt,{label:h?.title||"Recent Episode",value:(h?.plays_total??"—").toString()},D))]}),e.jsxs("section",{className:"rounded-2xl border bg-card",children:[e.jsx("header",{className:"flex items-center justify-between px-4 py-3 border-b",children:e.jsx("h2",{className:"text-base font-semibold",children:"Draft uploads"})}),e.jsx("ul",{className:"divide-y",children:f.map(h=>e.jsxs("li",{className:"px-4 py-3 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:h.title}),e.jsx("div",{className:"text-xs text-muted-foreground",children:h.status})]}),e.jsx("button",{className:"px-3 py-1.5 text-sm rounded-lg border hover:bg-muted",onClick:()=>l(h.id),children:"Resume"})]},h.id))})]})]})}const Lr="ab_drafts";function xl(){try{return JSON.parse(localStorage.getItem(Lr)||"{}")}catch{return{}}}function Pa(s){try{localStorage.setItem(Lr,JSON.stringify(s))}catch{}}function fl(){return crypto?.randomUUID?.()||Math.random().toString(36).slice(2)}function zr(){const s=xl(),a=Object.entries(s).map(([o,m])=>({id:o,...m}));function r(o){return s[o]||null}function l(o){const m=o?.id||fl();return s[m]={...o,id:m},Pa(s),m}function n(o){o in s&&(delete s[o],Pa(s))}return{drafts:a,get:r,upsert:l,remove:n}}function Ze(){const s=ge();return{get:s.get,post:s.post,put:s.put,delete:s.delete,uploadAudio(a){return s.post("/ab/upload",a)},createDraft(a){return s.post("/ab/drafts",a)},getStatus(a){return s.get(`/ab/drafts/${a}/status`)}}}function gl({token:s,shows:a,uploads:r,setUploads:l,drafts:n,setDrafts:o,markUploadUsed:m,goFinalize:k,goCustomizeSegments:i}){const[u,y]=t.useState(a[0]?.id??""),[f,h]=t.useState(r[0]?.id??null),[D,d]=t.useState([{key:"title",label:"Title",done:!1},{key:"description",label:"Description",done:!1},{key:"tags",label:"Tags",done:!1},{key:"template",label:"Choose template",done:!1},{key:"introoutro",label:"Finish intro/outro",done:!1}]),N=t.useRef(null),{setDraftMeta:j,getDraftMeta:S,clearDraft:v}=zr(),[p,b]=t.useState([]),[A,W]=t.useState(!1),[$,G]=t.useState(null),[Q,ee]=t.useState(!1),[I,q]=t.useState(!1),[te,w]=t.useState(null),[P,_]=t.useState({}),[V,K]=t.useState([]),[ue,ie]=t.useState(!1),[xe,de]=t.useState(null),[Ae,qe]=t.useState(!1),[Ke,He]=t.useState({}),[tt,Je]=t.useState(!1),[Le,Ve]=t.useState(!1),[Ye,ze]=t.useState(!1),Ue=t.useMemo(()=>D.every(c=>c.done),[D]),Be=t.useMemo(()=>!u||!f?null:S(u,f),[u,f,S]);t.useEffect(()=>{let c=!1;return(async()=>{try{if(!s||!u){ze(!1);return}const C=await fetch("/api/episodes",{headers:{Authorization:`Bearer ${s}`}});if(!C.ok){ze(!1);return}const E=await C.json(),z=(Array.isArray(E)?E:[]).filter(Z=>String(Z?.podcast_id)===String(u)&&(Z?.status==="processed"||Z?.status==="published")).length;c||ze(z>=5)}catch{c||ze(!1)}})(),()=>{c=!0}},[s,u]);const Xe=t.useMemo(()=>{const c=te;if(!c)return[];const C=(c.segments||[]).filter(z=>z.segment_type==="intro"||z.segment_type==="outro"),E=[];for(const z of C){const Z=P?.[z.id]?.source||{},H=z?.source||{},se=H?.source_type||"static";if(se==="tts")(Z.script??H.script??"").trim()||E.push(`${z.segment_type}: TTS script is required`);else if(se==="ai_generated")(Z.prompt??H.prompt??"").trim()||E.push(`${z.segment_type}: AI prompt is required`);else{const ye=(Z.filename??H.filename??"").trim();ye?V.some(Ce=>(z.segment_type==="intro"?Ce.category==="intro":Ce.category==="outro")&&Ce.filename===ye)||E.push(`${z.segment_type}: selected file not found in library`):E.push(`${z.segment_type}: choose a static file`)}}return E},[te,P,V]),B=c=>new Promise(C=>{try{const E=new Audio;let z=null;const Z=()=>{try{z&&URL.revokeObjectURL(z)}catch{}},H=()=>{const ye=E&&isFinite(E.duration)?E.duration:null;Z(),C(ye&&ye>0?ye:null)},se=()=>{Z(),C(null)};E.addEventListener("loadedmetadata",H),E.addEventListener("error",se),z=URL.createObjectURL(c),E.src=z,E.load()}catch{C(null)}}),re=(c,C=60)=>{if(!c)return"";if(c.length<=C)return c;const E=Math.ceil((C-3)*.6),z=C-3-E;return c.slice(0,E)+"..."+c.slice(-z)};t.useEffect(()=>{if(!u||!f)return;const c=S(u,f);d(C=>C.map(E=>E.key in c&&c[E.key]?{...E,done:!0}:E))},[u,f,S]),t.useEffect(()=>{let c=!1;return(async()=>{try{const C=await Ze(s).listTemplates();c||b(Array.isArray(C)?C:[])}catch{c||b([])}})(),()=>{c=!0}},[s]),t.useEffect(()=>{if(!u||!f)return;const c=(p||[]).filter(E=>E?.is_active!==!1);if(c.length!==1)return;const C=S(u,f);(!C||!C.template)&&x(c[0])},[p,u,f]),t.useEffect(()=>{let c=!1;return(async()=>{if(Q)try{const C=await Ze(s).listMedia();c||K(Array.isArray(C)?C:[])}catch{c||K([])}})(),()=>{c=!0}},[Q,s]),t.useEffect(()=>{let c=!1;return(async()=>{if(!(!Q||!te))try{const C=new Set;if((te?.segments||[]).forEach(H=>{if(H?.source?.source_type==="tts"){const se=P?.[H.id]?.source?.voice_id,ye=H?.source?.voice_id;se&&String(se).toLowerCase()!=="default"&&C.add(String(se)),ye&&String(ye).toLowerCase()!=="default"&&C.add(String(ye))}}),!C.size)return;let E=!0;for(const H of C)if(!Ke[H]){E=!1;break}if(E)return;Je(!0);let z={};try{if(s){const se=await ge(s).get("/api/elevenlabs/voices?size=200"),ye=Array.isArray(se?.items)?se.items:Array.isArray(se)?se:[];for(const me of ye||[]){const Ce=me.common_name||me.name||"";Ce&&(z[me.voice_id]=Ce)}}else{const H=await ks("",1,200);for(const se of H?.items||[]){const ye=se.common_name||se.name||"";ye&&(z[se.voice_id]=ye)}}}catch{}!c&&Object.keys(z).length&&He(H=>({...H,...z}));const Z=Array.from(C).filter(H=>H&&H.toLowerCase()!=="default"&&!z[H]);if(Z.length&&s){const H=ge(s);for(const se of Z)try{const ye=await H.get(`/api/elevenlabs/voice/${encodeURIComponent(se)}/resolve`),me=ye?.common_name||ye?.name||"";me&&!c&&He(Ce=>({...Ce,[se]:me}))}catch{}}}finally{c||Je(!1)}})(),()=>{c=!0}},[Q,te,P,s]);const le=t.useMemo(()=>{const c=r.find(E=>E.id===f);if(!c)return"≈ —";if(c&&typeof c.durationSec=="number"&&isFinite(c.durationSec)&&c.durationSec>0){const E=c.durationSec/60,z=Math.max(1,Math.floor(E*.75)),Z=Math.max(Math.ceil(E*1.25),Math.ceil(E+2));return`≈ ${z}–${Z} min`}const C=(c.fileName||"").toLowerCase();return C.endsWith(".wav")||C.endsWith(".aif")||C.endsWith(".aiff")?"≈ 8–14 min":"≈ 5–10 min"},[r,f]),ce=async c=>{l(C=>C.filter(E=>E.id!==c)),o(C=>C.filter(E=>E.fileId!==c)),v(u,c),f===c&&h(null);try{await Ze(s).deleteMedia(c)}catch{}},T=async()=>{if(s){Ve(!0);try{const E=(await Ze(s).listMedia()||[]).filter(z=>{const Z=(z?.category||"").toLowerCase();return Z==="main_content"||Z==="content"||Z===""||Z==="audio"}).map(z=>{const Z=typeof z?.filesize=="number"?z.filesize:z?.size,H=Z?`${Math.max(1,Math.round(Z/1024/1024))} MB`:"",se=z?.friendly_name||z?.client_name||z?.filename||"audio";return{id:z.id,fileName:se,serverFilename:z.filename,size:H,status:"done",progress:100,nickname:"",showId:void 0,ttlDays:14}});l(z=>{const Z=new Map(z.map(H=>[H.id,H]));return E.forEach(H=>{const se=Z.get(H.id);se?Z.set(H.id,{...se,...H}):Z.set(H.id,H)}),Array.from(Z.values())}),o(z=>{const Z=new Set(z.map(se=>se.fileId)),H=E.filter(se=>!Z.has(se.id)).map(se=>({id:`d_${se.id}`,title:(se.fileName||"").replace(/\.[a-z0-9]+$/i,""),fileId:se.id,transcript:"processing",hint:(se.serverFilename||se.fileName||"").replace(/\.[a-z0-9]+$/i,"")}));return H.length?z.concat(H):z})}catch{}finally{Ve(!1)}}};t.useEffect(()=>{s&&T()},[s]),t.useEffect(()=>{let c=!1;return(async()=>{if(!s||!Be||Be.transcript==="ready")return;const C=r.find(Z=>Z.id===f),E=(Be.hint||C?.serverFilename||C?.fileName||"").replace(/\.[a-z0-9]+$/i,"");if(!E)return;const z=async()=>{try{const Z=await Ze(s).transcriptReady({hint:E});if(c)return;if(Z&&Z.ready){j(u,f,{transcript:"ready"});return}}catch{}c||setTimeout(z,5e3)};setTimeout(z,2e3)})(),()=>{c=!0}},[s,Be?.transcript,Be?.hint,f,u,r,j]);const U=()=>N.current?.click(),Y=async c=>{const C=Array.from(c.target.files||[]);if(!C.length)return;const E=(H,se)=>new Promise(ye=>{const me=`tmp_${Date.now()}_${se}`,Ce=H.size?`${Math.max(1,Math.round(H.size/1024/1024))} MB`:"";let ke=null,Ee=null;l(Qe=>[...Qe,{id:me,fileName:H.name,serverFilename:void 0,size:Ce,status:"uploading",progress:1,nickname:"",showId:u,ttlDays:14,durationSec:null}]),B(H).then(Qe=>{Ee=Qe,l(Ge=>Ge.map(at=>at.id===me||ke&&at.id===ke?{...at,durationSec:Qe}:at))});const Pe=on("/api/media/upload/main_content"),lt=new XMLHttpRequest;lt.open("POST",Pe),s&&lt.setRequestHeader("Authorization",`Bearer ${s}`),lt.upload.onprogress=Qe=>{if(!Qe.lengthComputable)return;const Ge=Math.max(1,Math.min(99,Math.round(Qe.loaded/Qe.total*100)));l(at=>at.map(yt=>yt.id===me?{...yt,progress:Ge}:yt))},lt.onreadystatechange=()=>{if(lt.readyState===4){try{if(lt.status>=200&&lt.status<300){const Qe=JSON.parse(lt.responseText||"[]"),Ge=Array.isArray(Qe)?Qe[0]:Qe;if(Ge&&Ge.id){ke=Ge.id,l(yt=>yt.map(Rt=>Rt.id===me?{id:Ge.id,fileName:H.name,serverFilename:Ge.filename,size:Ce,status:"done",progress:100,nickname:"",showId:u,ttlDays:14,durationSec:Ee??Rt.durationSec??null}:Rt));const at={id:`d_${Ge.id}`,title:(Ge.friendly_name||Ge.filename||H.name).replace(/\.[a-z0-9]+$/i,""),fileId:Ge.id,transcript:"processing",hint:(Ge.filename||H.name).replace(/\.[a-z0-9]+$/i,"")};o(yt=>yt.concat([at])),ye(at);return}}}catch{}l(Qe=>Qe.map(Ge=>Ge.id===me?{...Ge,status:"error",progress:0}:Ge)),ye(null)}};const st=new FormData;st.append("files",H);try{st.append("friendly_names",JSON.stringify([H.name]))}catch{}lt.send(st)}),z=[];for(let H=0;H<C.length;H++){const se=await E(C[H],H);se&&z.push(se)}z[0]?.fileId&&h(z[0].fileId),c.target.value="";const Z=z[0];if(Z&&Z.hint){let H=!1;const se=async()=>{try{const ye=await Ze(s).transcriptReady({hint:Z.hint});if(ye&&ye.ready){o(me=>me.map(Ce=>Ce.id===Z.id?{...Ce,transcript:"ready"}:Ce));return}}catch{}setTimeout(se,5e3)};setTimeout(se,5e3)}},[O,L]=t.useState(null),fe=c=>{if(!f)return;const C=S(u,f);L({key:c,value:C[c]||""})},be=()=>{if(!O)return;const c=(O.value||"").trim();j(u,f,{[O.key]:c}),d(C=>C.map(E=>E.key===O.key?{...E,done:!!c}:E)),L(null)},Oe=async c=>{const C=r.find(Z=>Z.id===f),E=await Ze().aiMetadata({current_title:"",filename:C?.fileName}),z=c==="title"?{title:E.title}:c==="description"?{description:E.description}:{tags:(E.tags||[]).join(", ")};j(u,f,z),d(Z=>Z.map(H=>H.key===c?{...H,done:!0}:H))},x=c=>{!u||!f||(j(u,f,{template:c?.id||c,template_name:c?.name||void 0}),d(C=>C.map(E=>E.key==="template"?{...E,done:!0}:E)),W(!1),G(null))},F=()=>{const c=(p||[]).filter(C=>C?.is_active!==!1);if(!c.length){window.alert("No active templates. Create or enable one in Templates.");return}if(c.length===1){x(c[0]);return}G(c[0]?.id||null),W(!0)};return e.jsxs("div",{className:"mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[e.jsx("input",{ref:N,type:"file",multiple:!0,accept:"audio/*",className:"hidden",onChange:Y}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold tracking-tight",children:"Upload your audio"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Drop files here. We’ll handle the rest in the background."})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Podcast"}),e.jsx("select",{className:"rounded-lg border px-2 py-1 text-sm",value:u,onChange:c=>y(c.target.value),children:a.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))})]})})]}),e.jsx("div",{className:"rounded-2xl border border-dashed bg-card p-6 text-center",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Drag & drop or ",e.jsx("button",{className:"underline",onClick:U,children:"browse"})]})}),e.jsxs("section",{className:"rounded-2xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Uploads"}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs disabled:opacity-50",disabled:Le||!s,title:s?"Refresh uploads from server":"Sign in to refresh from server",onClick:T,children:Le?"Refreshing…":"Refresh"})]}),e.jsx("ul",{className:"space-y-2",children:r.map(c=>e.jsxs("li",{className:"rounded-lg border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"primaryFile",checked:f===c.id,onChange:()=>h(c.id),title:"Use this file for processing & estimates"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate",title:c.fileName,children:c.nickname?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:re(c.nickname,50)})," ",e.jsxs("span",{className:"italic text-muted-foreground",children:["(",re(c.fileName,50),")"]})]}):e.jsx("span",{className:"font-medium",children:re(c.fileName,60)})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:c.size})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${(n.find(z=>z.fileId===c.id)?.transcript||"processing")==="ready"?"bg-green-50 text-green-700 border-green-200":"bg-amber-50 text-amber-700 border-amber-200"}`,children:n.find(E=>E.fileId===c.id)?.transcript==="ready"?"Transcription Complete":"Transcription Pending"}),e.jsxs("div",{className:"text-sm",children:[c.status==="uploading"&&e.jsxs("span",{children:[c.progress,"%"]}),c.status==="queued"&&e.jsx("span",{children:"Queued"}),c.status==="done"&&e.jsx("span",{className:"text-green-700",children:"Uploaded"})]})]}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:()=>{window.confirm("Delete this upload? This cannot be undone.")&&ce(c.id)},children:"Delete"})]}),c.status==="uploading"&&e.jsx("div",{className:"mt-2 h-2 rounded bg-muted",children:e.jsx("div",{className:"h-2 rounded bg-indigo-600",style:{width:c.progress+"%"}})}),e.jsxs("div",{className:"mt-2 grid sm:grid-cols-2 gap-2",children:[e.jsxs("label",{className:"text-xs",children:["Common name (optional)",e.jsx("input",{className:"mt-1 w-full rounded border px-2 py-1 text-sm",value:c.nickname,onChange:C=>l(E=>E.map(z=>z.id===c.id?{...z,nickname:C.target.value}:z))})]}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-end justify-end",children:["Expires in ",c.ttlDays??14," days"]})]})]},c.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"rounded-2xl border bg-card p-4",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Transcript"}),e.jsxs("div",{className:"mt-2 text-sm",children:[Be?.transcript==="ready"?e.jsxs("div",{className:"rounded-lg border px-3 py-2 bg-green-50 text-green-800 flex items-center justify-between",children:[e.jsx("span",{children:"Transcription Complete"}),e.jsx("span",{className:"text-xs",children:"Ready"})]}):e.jsxs("div",{className:"rounded-lg border px-3 py-2 bg-amber-50 text-amber-800 flex items-center justify-between",children:[e.jsx("span",{children:"Processing"}),e.jsx("span",{className:"text-xs",children:le})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"You can keep working while we transcribe."})]})]}),e.jsxs("section",{className:"lg:col-span-2 rounded-2xl border bg-card p-4",children:[e.jsx("h2",{className:"text-base font-semibold",children:"While we work, you can..."}),e.jsx("ul",{className:"mt-2 grid sm:grid-cols-2 gap-3 text-sm",children:D.map(c=>e.jsxs("li",{className:"rounded-lg border px-3 py-2 flex items-center justify-between gap-2 "+(c.done?"bg-green-50 border-green-200":""),children:[e.jsxs("span",{className:"truncate flex items-center gap-2",children:[c.done&&e.jsx("span",{className:"inline-block w-4 h-4 rounded-full bg-green-500 shrink-0"}),c.label]}),e.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[c.key!=="template"&&c.key!=="introoutro"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:()=>fe(c.key),children:"Manual"}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:()=>Oe(c.key),children:"AI suggest"})]}),c.key==="template"&&e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:F,children:"Choose"}),c.key==="introoutro"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-2 py-1 rounded border text-xs disabled:opacity-50",disabled:Ae,onClick:async()=>{if(!u||!f){window.alert("Select an upload first.");return}const C=S(u,f),E=C?.template;if(!E){window.alert("Choose a template first.");return}q(!0),ee(!0);try{const z=await fetch(`/api/templates/${E}`,{headers:s?{Authorization:`Bearer ${s}`}:{}});if(z.ok){const Z=await z.json();w(Z);const H=C?.segment_overrides||{},se={};(Z.segments||[]).forEach(ye=>{if(ye.segment_type==="intro"||ye.segment_type==="outro"){const me=H[ye.id]||{};ye?.source?.source_type==="tts"?se[ye.id]={source:{script:me?.source?.script??ye?.source?.script??"",voice_id:me?.source?.voice_id??ye?.source?.voice_id??null,voice_name:me?.source?.voice_name??ye?.source?.voice_name??void 0}}:ye?.source?.source_type==="ai_generated"?se[ye.id]={source:{prompt:me?.source?.prompt??ye?.source?.prompt??""}}:ye?.source?.source_type==="static"&&(se[ye.id]={source:{filename:me?.source?.filename??ye?.source?.filename??""}})}}),_(se)}else w(null)}catch{w(null)}finally{q(!1)}},children:"Manual"}),Ye&&e.jsx("button",{className:"px-2 py-1 rounded border text-xs disabled:opacity-50",disabled:Ae,onClick:async()=>{if(!u||!f){window.alert("Select an upload first.");return}const C=S(u,f),E=C?.template;if(!E){window.alert("Choose a template first.");return}qe(!0);try{const z=await fetch(`/api/templates/${E}`,{headers:s?{Authorization:`Bearer ${s}`}:{}});if(!z.ok)throw new Error("Template not found");const Z=await z.json(),H=r.find(Ee=>Ee.id===f),se=(C?.hint||H?.serverFilename||H?.fileName||"").replace(/\.[a-z0-9]+$/i,""),me={...C?.segment_overrides||{}},Ce=(Z.segments||[]).filter(Ee=>Ee.segment_type==="intro"),ke=(Z.segments||[]).filter(Ee=>Ee.segment_type==="outro");for(const Ee of Z.segments||[])if((Ee.segment_type==="intro"||Ee.segment_type==="outro")&&Ee?.source?.source_type==="tts")try{const Pe=(Ee.segment_type==="intro"?Ce.findIndex(at=>at.id===Ee.id):ke.findIndex(at=>at.id===Ee.id))+1,lt=Ee.segment_type==="intro"?`Intro ${Pe}`:`Outro ${Pe}`,st={episode_id:C?.episode_id||"00000000-0000-0000-0000-000000000000",podcast_id:u,tag:lt,section_type:Ee.segment_type,hint:se,history_count:10},Ge=((await Ze(s).suggestSection(st))?.script||"").trim();Ge&&(me[Ee.id]={source:{...me?.[Ee.id]?.source||{},script:Ge}})}catch(Pe){console.warn("intro/outro suggest failed",Pe)}j(u,f,{segment_overrides:me,introoutro:!0}),d(Ee=>Ee.map(Pe=>Pe.key==="introoutro"?{...Pe,done:!0}:Pe))}catch(z){window.alert(z?.message||String(z))}finally{qe(!1)}},children:"AI suggest"})]})]})]},c.key))}),e.jsx("div",{className:"mt-4 flex items-center justify-end",children:e.jsx("button",{className:`px-4 py-2 rounded-lg ${Ue?"bg-indigo-600 text-white hover:bg-indigo-700 border border-indigo-600":"bg-gray-200 text-gray-500 border border-gray-300 cursor-not-allowed"}`,disabled:!Ue,onClick:k,title:Ue?"Proceed to Finalize":"Complete the items above to enable",children:"Go to Finalize"})})]})]}),A&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"fixed inset-0 bg-black/40 grid place-items-center p-4 z-50",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Choose a template"}),e.jsx("button",{className:"px-2 py-1 text-sm rounded border",onClick:()=>W(!1),children:"Close"})]}),e.jsx("div",{className:"max-h-[60vh] overflow-auto divide-y border rounded",children:(p||[]).filter(c=>c?.is_active!==!1).map(c=>e.jsxs("label",{className:"flex items-center gap-3 p-3 cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"tpl",checked:$===c.id,onChange:()=>G(c.id)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:c.name}),c.podcast_id&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"Show-linked"})]}),e.jsx("span",{className:`ml-auto text-xs px-2 py-0.5 rounded-full border ${c?.is_active!==!1?"bg-green-50 text-green-700 border-green-200":"bg-gray-100 text-gray-700 border-gray-300"}`,children:c?.is_active!==!1?"Active":"Inactive"})]},c.id))}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-1.5 rounded border",onClick:()=>W(!1),children:"Cancel"}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-indigo-600 text-white disabled:opacity-50",disabled:!$,onClick:()=>{const c=(p||[]).find(C=>C.id===$);c&&x(c)},children:"Use template"})]})]})}),Q&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"fixed inset-0 bg-black/40 grid place-items-center p-4 z-50",children:e.jsxs("div",{className:"w-full max-w-3xl rounded-2xl bg-white p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Finish Intro/Outro"}),e.jsx("button",{className:"px-2 py-1 text-sm rounded border",onClick:()=>ee(!1),children:"Close"})]}),I&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading…"}),!I&&!te&&e.jsx("div",{className:"rounded border bg-amber-50 text-amber-800 p-3 text-sm",children:"Template not available. Choose a template first."}),!I&&te&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Customize only intro/outro segments for this episode. These edits won’t change the saved template. Required: TTS needs a script; AI needs a prompt; static needs a selected file."}),e.jsx("div",{className:"flex items-end justify-end gap-2",children:e.jsx("button",{className:"px-2 py-1 text-xs border rounded",onClick:async()=>{const c=r.find(H=>H.id===f),C=S(u,f),E=te,z=(E?.segments||[]).filter(H=>H.segment_type==="intro"),Z=(E?.segments||[]).filter(H=>H.segment_type==="outro");for(const H of E?.segments||[])if((H.segment_type==="intro"||H.segment_type==="outro")&&(H?.source?.source_type||"static")==="tts")try{const ye=(H.segment_type==="intro"?z.findIndex(Pe=>Pe.id===H.id):Z.findIndex(Pe=>Pe.id===H.id))+1,me=H.segment_type==="intro"?`Intro ${ye}`:`Outro ${ye}`,Ce={episode_id:C?.episode_id||"00000000-0000-0000-0000-000000000000",podcast_id:u,tag:me,section_type:H.segment_type,hint:(C?.hint||c?.serverFilename||c?.fileName||"").replace(/\.[a-z0-9]+$/i,""),history_count:10},Ee=((await Ze(s).suggestSection(Ce))?.script||"").trim();Ee&&_(Pe=>({...Pe,[H.id]:{source:{...Pe?.[H.id]?.source,script:Ee}}}))}catch(ye){console.warn("section suggest failed",ye)}},children:"AI suggest scripts"})}),e.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-auto",children:(te.segments||[]).filter(c=>c.segment_type==="intro"||c.segment_type==="outro").map((c,C)=>e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-medium",children:[c.segment_type==="intro"?"Intro":"Outro"," ",""]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full border bg-gray-50 text-gray-700 border-gray-200",children:c?.source?.source_type||"static"})]}),c?.source?.source_type==="tts"&&e.jsxs("label",{className:"block text-sm mt-2",children:["TTS Script",e.jsx("textarea",{className:"mt-1 w-full rounded border p-2 min-h-28",value:P?.[c.id]?.source?.script||"",onChange:E=>_(z=>({...z,[c.id]:{source:{...z?.[c.id]?.source,script:E.target.value}}}))})]}),c?.source?.source_type==="tts"&&e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:(()=>{const E=P?.[c.id]?.source?.voice_id||c?.source?.voice_id||null,z=P?.[c.id]?.source?.voice_name||c?.source?.voice_name||(E?Ke[E]:null),Z=z||E||"Default";return e.jsxs(e.Fragment,{children:["Voice: ",Z,tt&&E&&!z&&!Ke[E]?e.jsx("span",{className:"ml-2 text-[10px] text-gray-400",children:"(resolving…)"}):null]})})()}),e.jsx("button",{className:"text-xs px-2 py-1 border rounded",onClick:()=>{de(c.id),ie(!0)},children:"Change voice"})]}),c?.source?.source_type==="ai_generated"&&e.jsxs("label",{className:"block text-sm mt-2",children:["AI Prompt",e.jsx("textarea",{className:"mt-1 w-full rounded border p-2 min-h-24",value:P?.[c.id]?.source?.prompt||"",onChange:E=>_(z=>({...z,[c.id]:{source:{...z?.[c.id]?.source,prompt:E.target.value}}}))})]}),!["tts","ai_generated"].includes(c?.source?.source_type)&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("div",{className:"text-muted-foreground",children:"Static segment file:"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:P?.[c.id]?.source?.filename||c?.source?.filename||"",onChange:E=>_(z=>({...z,[c.id]:{source:{...z?.[c.id]?.source,filename:E.target.value}}})),children:[e.jsx("option",{value:"",children:c.segment_type==="intro"?"Choose an intro file…":"Choose an outro file…"}),V.filter(E=>c.segment_type==="intro"?E.category==="intro":E.category==="outro").map(E=>e.jsx("option",{value:E.filename,children:E.friendly_name||E.filename},E.id))]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Current: ",c?.source?.filename||"—"]})]}),V.filter(E=>c.segment_type==="intro"?E.category==="intro":E.category==="outro").length===0&&e.jsxs("div",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-200 rounded px-2 py-1 mt-2",children:["No ",c.segment_type," files in your library. Add them in Templates."]})]})]},c.id))}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-1.5 rounded border",onClick:()=>ee(!1),children:"Cancel"}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-indigo-600 text-white disabled:opacity-50",disabled:Xe.length>0,onClick:()=>{const C=(te?.segments||[]).filter(se=>se.segment_type==="intro"||se.segment_type==="outro"),E=[];for(const se of C){const ye=P?.[se.id]?.source||{},me=se?.source||{},Ce=me?.source_type||"static";if(Ce==="tts")(ye.script??me.script??"").trim()||E.push(`${se.segment_type}: TTS script is required`);else if(Ce==="ai_generated")(ye.prompt??me.prompt??"").trim()||E.push(`${se.segment_type}: AI prompt is required`);else{const ke=(ye.filename??me.filename??"").trim();ke?V.some(Pe=>(se.segment_type==="intro"?Pe.category==="intro":Pe.category==="outro")&&Pe.filename===ke)||E.push(`${se.segment_type}: selected file not found in library`):E.push(`${se.segment_type}: choose a static file`)}}if(E.length){window.alert(`Please fix before saving:
- ${E.join(`
- `)}`);return}const z=S(u,f),H={...{...z?.segment_overrides||{},...P}};for(const se of te.segments||[])if(se?.source?.source_type==="tts"){const ye=H?.[se.id]?.source||{},me=ye.voice_id||se?.source?.voice_id||null,Ce=ye.voice_name||se?.source?.voice_name||(me?Ke[me]:void 0);me&&Ce&&!ye.voice_name&&(H[se.id]={source:{...ye,voice_name:Ce}})}j(u,f,{segment_overrides:H,introoutro:!0}),(async()=>{try{if(u){const se=(te.segments||[]).filter(me=>me.segment_type==="intro"),ye=(te.segments||[]).filter(me=>me.segment_type==="outro");for(const me of te.segments||[]){const Ce=H?.[me.id]?.source||{};if(me?.source?.source_type==="tts"&&(Ce.script||me?.source?.script)){const ke=Ce.voice_id||me?.source?.voice_id||null,Ee=Ce.voice_name||me?.source?.voice_name||null,Pe=(Ce.script||me?.source?.script||"").trim(),lt=(me.segment_type==="intro"?se.findIndex(Qe=>Qe.id===me.id):ye.findIndex(Qe=>Qe.id===me.id))+1,st=me.segment_type==="intro"?`Intro ${lt}`:`Outro ${lt}`;Pe&&await Ze(s).saveSection({podcast_id:u,episode_id:z?.episode_id||null,tag:st,section_type:me.segment_type,content:Pe,voice_id:ke,voice_name:Ee})}}}}catch(se){console.warn("saveSection failed",se)}})(),d(se=>se.map(ye=>ye.key==="introoutro"?{...ye,done:!0}:ye)),ee(!1)},children:"Save"})]})]})]})}),ue&&xe&&e.jsx(us,{value:P?.[xe]?.source?.voice_id||null,onChange:c=>{_(C=>({...C,[xe]:{source:{...C?.[xe]?.source,voice_id:c}}}))},onSelect:c=>{if(!c)return;const C=c.common_name||c.name||"Voice";_(E=>({...E,[xe]:{source:{...E?.[xe]?.source,voice_id:c.voice_id,voice_name:C}}}))},token:s,onClose:()=>{ie(!1),de(null)}}),O&&e.jsx("div",{role:"dialog",className:"fixed inset-0 bg-black/40 grid place-items-center p-4 z-50",children:e.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-white p-4 space-y-3",children:[e.jsxs("div",{className:"text-base font-semibold",children:["Enter ",O.key]}),O.key==="description"?e.jsx("textarea",{className:"w-full rounded border p-2 min-h-40",value:O.value,onChange:c=>L({...O,value:c.target.value})}):e.jsx("input",{className:"w-full rounded border p-2",value:O.value,onChange:c=>L({...O,value:c.target.value})}),O.key==="tags"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"Comma-separated (e.g., tips, interview)"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-1.5 rounded border",onClick:()=>L(null),children:"Cancel"}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-indigo-600 text-white",onClick:be,children:"Save"})]})]})})]})}function yl({token:s,drafts:a,uploads:r,uploadById:l,goUpload:n}){const[o,m]=t.useState("draft"),i=(a[0]||null)?.fileId||null,u=r.find(B=>B.id===i)?.showId||null,{getDraftMeta:y,setDraftMeta:f}=zr(),h=t.useMemo(()=>u&&i?y(u,i):{},[u,i,y]),[D,d]=t.useState(h.title||"How to pick a podcast niche in 2025"),[N,j]=t.useState(h.description||"In this episode we cover how to find a topic you can stick with..."),[S,v]=t.useState(h.tags||""),p=h?.transcript==="ready",[b,A]=t.useState([]),[W,$]=t.useState(h?.spreaker_show_id||null),[G,Q]=t.useState(h?.schedule_at||"");t.useEffect(()=>{h&&(h.title&&d(h.title),h.description&&j(h.description),typeof h.tags=="string"?v(h.tags):Array.isArray(h.tags)&&v(h.tags.join(", ")),h.spreaker_show_id&&$(h.spreaker_show_id),h.schedule_at&&Q(h.schedule_at))},[h]),t.useEffect(()=>{let B=!1;return(async()=>{if(!s||p||!i)return;const re=l[i],le=(h?.hint||re?.serverFilename||re?.fileName||"").replace(/\.[a-z0-9]+$/i,"");if(!le)return;const ce=async()=>{try{const T=await Ze(s).transcriptReady({hint:le});if(B)return;if(T&&T.ready){u&&i&&f(u,i,{transcript:"ready"});return}}catch{}B||setTimeout(ce,5e3)};setTimeout(ce,2e3)})(),()=>{B=!0}},[s,p,i,u,h?.hint,l,f]),t.useEffect(()=>{let B=!1;return(async()=>{try{if(!s)return;const re=await Ze(s).listSpreakerShows();if(B)return;const le=Array.isArray(re)?re:Array.isArray(re?.shows)?re.shows:[];if(A(le),!W&&le?.length){const ce=le.find(T=>String(T.id)===String(h?.spreaker_show_id||""));$(String(ce?ce.id:le[0].id))}}catch{B||A([])}})(),()=>{B=!0}},[s]);const ee=()=>{if(!u||!i)return;const B=(S||"").trim();f(u,i,{title:D?.trim(),description:N?.trim(),tags:B,spreaker_show_id:W||null,schedule_at:G||null}),window.alert("Saved")},I=async()=>{if(!i){window.alert("Select an upload first.");return}const B=l[i],re=B?.serverFilename||B?.fileName;if(!re){window.alert("File not available.");return}if(!W){window.alert("Choose a Spreaker show.");return}try{const le={show_id:String(W),title:(D||re).trim(),description:(N||"").trim(),filename:re},ce=(G||"").trim();if(ce){const U=new Date(ce);isNaN(U.getTime())||(le.auto_published_at=U.toISOString())}const T=await Ze(s).publishToSpreaker(le);u&&i&&f(u,i,{spreaker_show_id:String(W),schedule_at:G||null,last_publish_response:T||!0}),window.alert(ce?"Scheduled for Spreaker.":"Published to Spreaker.")}catch(le){window.alert(le?.message||"Failed to publish.")}},q=async()=>{if(!i)return;const B=l[i];try{const re=await Ze(s).aiMetadata({current_title:D,current_description:N,filename:B?.serverFilename||B?.fileName});re?.title&&d(re.title),u&&i&&re?.title&&f(u,i,{title:re.title})}catch{}},te=async()=>{if(!i)return;const B=l[i];try{const re=await Ze(s).aiMetadata({current_title:D,current_description:N,filename:B?.serverFilename||B?.fileName,prompt:"expand"});re?.description&&j(re.description),u&&i&&re?.description&&f(u,i,{description:re.description})}catch{}},w=async()=>{if(!i)return;const B=l[i];try{const re=await Ze(s).aiMetadata({current_title:D,current_description:N,filename:B?.serverFilename||B?.fileName,prompt:"shorten"});re?.description&&j(re.description),u&&i&&re?.description&&f(u,i,{description:re.description})}catch{}},P=async()=>{if(!i)return;const B=l[i];try{const re=await Ze(s).aiMetadata({current_title:D,current_description:N,filename:B?.serverFilename||B?.fileName,prompt:"tags"}),le=Array.isArray(re?.tags)?re.tags.join(", "):typeof re?.tags=="string"?re.tags:null;le&&v(le),u&&i&&le&&f(u,i,{tags:le})}catch{}},[_,V]=t.useState(!1),[K,ue]=t.useState(!1),[ie,xe]=t.useState(null),[de,Ae]=t.useState({}),[qe,Ke]=t.useState([]),[He,tt]=t.useState(!1),[Je,Le]=t.useState(null),[Ve,Ye]=t.useState(!1),[ze,Ue]=t.useState({}),[Be,Xe]=t.useState(!1);return t.useEffect(()=>{let B=!1;return(async()=>{if(_)try{const re=await Ze(s).listMedia();B||Ke(Array.isArray(re)?re:[])}catch{B||Ke([])}})(),()=>{B=!0}},[_,s,u]),t.useEffect(()=>{let B=!1;return(async()=>{if(!(!_||!ie))try{const re=new Set;if((ie?.segments||[]).forEach(U=>{if(U?.source?.source_type==="tts"){const Y=de?.[U.id]?.source?.voice_id,O=U?.source?.voice_id;Y&&String(Y).toLowerCase()!=="default"&&re.add(String(Y)),O&&String(O).toLowerCase()!=="default"&&re.add(String(O))}}),!re.size)return;let le=!0;for(const U of re)if(!ze[U]){le=!1;break}if(le)return;Xe(!0);let ce={};try{if(s){const Y=await ge(s).get("/api/elevenlabs/voices?size=200"),O=Array.isArray(Y?.items)?Y.items:Array.isArray(Y)?Y:[];for(const L of O||[]){const fe=L.common_name||L.name||"";fe&&(ce[L.voice_id]=fe)}}else{const U=await ks("",1,200);for(const Y of U?.items||[]){const O=Y.common_name||Y.name||"";O&&(ce[Y.voice_id]=O)}}}catch{}!B&&Object.keys(ce).length&&Ue(U=>({...U,...ce}));const T=Array.from(re).filter(U=>U&&U.toLowerCase()!=="default"&&!ce[U]);if(T.length&&s){const U=ge(s);for(const Y of T)try{const O=await U.get(`/api/elevenlabs/voice/${encodeURIComponent(Y)}/resolve`),L=O?.common_name||O?.name||"";L&&!B&&Ue(fe=>({...fe,[Y]:L}))}catch{}}}finally{B||Xe(!1)}})(),()=>{B=!0}},[_,ie,de,s]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold tracking-tight",children:"Finalize · Titles & Publish"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Review AI suggestions, set visibility, and schedule publishing."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded-xl border px-4 py-2 hover:bg-muted focus:outline-none",onClick:ee,children:"Save"}),e.jsx("button",{className:"rounded-xl bg-indigo-600 px-4 py-2 text-white shadow hover:bg-indigo-500 focus:outline-none focus-visible:ring",onClick:I,children:"Publish"})]})]}),e.jsxs("div",{className:`rounded-xl border px-4 py-3 text-sm ${p?"bg-green-50 text-green-800 border-green-200":"bg-amber-50 text-amber-800 border-amber-200"}`,children:[e.jsx("strong",{children:"Transcript status:"})," ",p?"ready":"processing..."," You can keep editing; AI fields ",p?"are available.":"will fill in automatically once ready.",e.jsx("button",{className:"ml-3 px-2 py-1 rounded border text-xs",onClick:n,children:"View uploads"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("section",{className:"lg:col-span-2 rounded-2xl border bg-card p-4 space-y-4",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Title & description"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"Title"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 rounded-lg border px-3 py-2 focus:outline-none focus-visible:ring",value:D,onChange:B=>d(B.target.value)}),e.jsx("button",{className:"px-3 py-2 rounded-lg border hover:bg-muted",onClick:q,children:"AI suggest"})]})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx("textarea",{className:"min-h-32 rounded-lg border px-3 py-2 focus:outline-none focus-visible:ring",value:N,onChange:B=>j(B.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-lg border hover:bg-muted",onClick:te,children:"AI expand"}),e.jsx("button",{className:"px-3 py-2 rounded-lg border hover:bg-muted",onClick:w,children:"AI shorten"})]})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 rounded-lg border px-3 py-2",value:S,onChange:B=>v(B.target.value),placeholder:"comma, separated, tags"}),e.jsx("button",{className:"px-3 py-2 rounded-lg border hover:bg-muted",onClick:P,children:"AI tags"})]})]})]}),e.jsxs("section",{className:"lg:col-span-2 rounded-2xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Intro/Outro"}),(()=>{const B=h?.introoutro_status||(h?.introoutro?"manual":null);return B?e.jsx("span",{className:"text-xs font-medium text-green-600",children:B==="ai"?"AI Text Applied":"Completed"}):null})()]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 rounded border text-xs disabled:opacity-50",disabled:Ve,onClick:async()=>{if(!u||!i){window.alert("Select an upload first.");return}const B=h,re=B?.template;if(!re){window.alert("Choose a template first (on Upload page).");return}ue(!0),V(!0);try{const le=await fetch(`/api/templates/${re}`,{headers:s?{Authorization:`Bearer ${s}`}:{}});if(le.ok){const ce=await le.json();xe(ce);const T=B?.segment_overrides||{},U={};(ce.segments||[]).forEach(Y=>{if(Y.segment_type==="intro"||Y.segment_type==="outro"){const O=T[Y.id]||{};Y?.source?.source_type==="tts"?U[Y.id]={source:{script:O?.source?.script??"",voice_id:O?.source?.voice_id??null,voice_name:O?.source?.voice_name??void 0}}:Y?.source?.source_type==="ai_generated"?U[Y.id]={source:{prompt:O?.source?.prompt??""}}:Y?.source?.source_type==="static"&&(U[Y.id]={source:{filename:O?.source?.filename??""}})}}),Ae(U)}else xe(null)}catch{xe(null)}finally{ue(!1)}},children:"Manual"}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs disabled:opacity-50",disabled:Ve,onClick:async()=>{if(!u||!i){window.alert("Select an upload first.");return}const B=h,re=B?.template;if(!re){window.alert("Choose a template first (on Upload page).");return}Ye(!0);try{const le=await fetch(`/api/templates/${re}`,{headers:s?{Authorization:`Bearer ${s}`}:{}});if(!le.ok)throw new Error("Template not found");const ce=await le.json(),T=l[i],U=(B?.hint||T?.serverFilename||T?.fileName||"").replace(/\.[a-z0-9]+$/i,""),O={...B?.segment_overrides||{}},L=(ce.segments||[]).filter(be=>be.segment_type==="intro"),fe=(ce.segments||[]).filter(be=>be.segment_type==="outro");for(const be of ce.segments||[])if((be.segment_type==="intro"||be.segment_type==="outro")&&be?.source?.source_type==="tts")try{const Oe=(be.segment_type==="intro"?L.findIndex(E=>E.id===be.id):fe.findIndex(E=>E.id===be.id))+1,x=be.segment_type==="intro"?`Intro ${Oe}`:`Outro ${Oe}`,F={episode_id:B?.episode_id||"00000000-0000-0000-0000-000000000000",podcast_id:u,tag:x,section_type:be.segment_type,hint:U,history_count:10},C=((await Ze(s).suggestSection(F))?.script||"").trim();C&&(O[be.id]={source:{...O?.[be.id]?.source||{},script:C}})}catch(Oe){console.warn("intro/outro suggest failed",Oe)}f(u,i,{segment_overrides:O,introoutro:!0,introoutro_status:"ai"}),window.alert("Intro/Outro suggestions applied")}catch(le){window.alert(le?.message||String(le))}finally{Ye(!1)}},children:"AI suggest"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage your episode-specific intro/outro here."})]}),e.jsxs("section",{className:"lg:col-span-2 rounded-2xl border bg-card p-4 space-y-3",children:[e.jsx("div",{className:"font-medium",children:"Intern review queue"}),e.jsx("ul",{className:"mt-2 space-y-3 text-sm",children:[{t:"Insert intro music",detail:"at 00:00:13",text:"Insert intro music"},{t:"Add chapter",detail:"Sponsor segment at 00:14:22",text:"Add chapter: Sponsor"},{t:"Note",detail:"Redo question at 00:23:05",text:"Note: redo that question"}].map((B,re)=>e.jsxs("li",{className:"rounded-lg border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:B.t}),e.jsx("div",{className:"text-xs text-muted-foreground",children:B.detail})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 rounded border text-xs",children:"Undo"}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs",children:"Approve"})]})]}),e.jsx("input",{defaultValue:B.text,className:"mt-2 w-full rounded border px-2 py-1 text-sm"})]},re))})]}),e.jsxs("section",{className:"rounded-2xl border bg-card p-4 space-y-4",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Publish settings"}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Spreaker show"}),e.jsxs("select",{className:"mt-1 w-full rounded-lg border px-3 py-2",value:W||"",onChange:B=>$(B.target.value||null),children:[e.jsx("option",{value:"",children:"Select a show…"}),(b||[]).map(B=>e.jsx("option",{value:String(B.id),children:B.title||B.name||B.id},B.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Visibility"}),e.jsxs("div",{className:"mt-2 flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"visibility",value:"draft",checked:o==="draft",onChange:()=>m("draft")})," Draft"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"visibility",value:"publish",checked:o==="publish",onChange:()=>m("publish")})," Publish"]})]})]}),e.jsxs("div",{className:o==="draft"?"opacity-60 pointer-events-none":"",children:[e.jsx("label",{className:"text-sm font-medium",children:"Schedule"}),e.jsx("input",{type:"datetime-local",className:"mt-1 w-full rounded-lg border px-3 py-2",value:G,onChange:B=>Q(B.target.value)})]})]}),e.jsx("button",{className:"w-full rounded-xl bg-indigo-600 px-4 py-2 text-white shadow hover:bg-indigo-500 focus:outline-none focus-visible:ring",onClick:o==="publish"?I:ee,children:o==="publish"?"Publish":"Save"})]})]})]}),_&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"fixed inset-0 bg-black/40 grid place-items-center p-4 z-50",children:e.jsxs("div",{className:"w-full max-w-3xl rounded-2xl bg-white p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Finish Intro/Outro"}),e.jsx("button",{className:"px-2 py-1 text-sm rounded border",onClick:()=>V(!1),children:"Close"})]}),K&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading…"}),!K&&!ie&&e.jsx("div",{className:"rounded border bg-amber-50 text-amber-800 p-3 text-sm",children:"Template not available. Choose a template first."}),!K&&ie&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Customize only intro/outro segments for this episode. These edits won’t change the saved template."}),e.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-auto",children:(ie.segments||[]).filter(B=>B.segment_type==="intro"||B.segment_type==="outro").map((B,re)=>e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-medium",children:[B.segment_type==="intro"?"Intro":"Outro"," ",""]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full border bg-gray-50 text-gray-700 border-gray-200",children:B?.source?.source_type||"static"})]}),B?.source?.source_type==="tts"&&e.jsxs("label",{className:"block text-sm mt-2",children:["TTS Script",e.jsx("textarea",{className:"mt-1 w-full rounded border p-2 min-h-28",value:de?.[B.id]?.source?.script||"",onChange:le=>Ae(ce=>({...ce,[B.id]:{source:{...ce?.[B.id]?.source,script:le.target.value}}}))})]}),B?.source?.source_type==="tts"&&e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:(()=>{const le=de?.[B.id]?.source?.voice_id||B?.source?.voice_id||null,ce=de?.[B.id]?.source?.voice_name||B?.source?.voice_name||(le?ze[le]:null),T=ce||le||"Default";return e.jsxs(e.Fragment,{children:["Voice: ",T,Be&&le&&!ce&&!ze[le]?e.jsx("span",{className:"ml-2 text-[10px] text-gray-400",children:"(resolving…)"}):null]})})()}),e.jsx("button",{className:"text-xs px-2 py-1 border rounded",onClick:()=>{Le(B.id),tt(!0)},children:"Change voice"})]}),B?.source?.source_type==="ai_generated"&&e.jsxs("label",{className:"block text-sm mt-2",children:["AI Prompt",e.jsx("textarea",{className:"mt-1 w-full rounded border p-2 min-h-24",value:de?.[B.id]?.source?.prompt||"",onChange:le=>Ae(ce=>({...ce,[B.id]:{source:{...ce?.[B.id]?.source,prompt:le.target.value}}}))})]}),!["tts","ai_generated"].includes(B?.source?.source_type)&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("div",{className:"text-muted-foreground",children:"Static segment file:"}),e.jsx("div",{className:"mt-1 flex items-center gap-2",children:e.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:de?.[B.id]?.source?.filename||B?.source?.filename||"",onChange:le=>Ae(ce=>({...ce,[B.id]:{source:{...ce?.[B.id]?.source,filename:le.target.value}}})),children:[e.jsx("option",{value:"",children:B.segment_type==="intro"?"Choose an intro file…":"Choose an outro file…"}),qe.filter(le=>B.segment_type==="intro"?le.category==="intro":le.category==="outro").map(le=>e.jsx("option",{value:le.filename,children:le.friendly_name||le.filename},le.id))]})}),qe.filter(le=>B.segment_type==="intro"?le.category==="intro":le.category==="outro").length===0&&e.jsxs("div",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-200 rounded px-2 py-1 mt-2",children:["No ",B.segment_type," files in your library. Add them in Templates."]})]})]},B.id))}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-1.5 rounded border",onClick:()=>V(!1),children:"Cancel"}),e.jsx("button",{className:"px-3 py-1.5 rounded bg-indigo-600 text-white",onClick:()=>{const B={...h?.segment_overrides||{},...de};for(const re of ie.segments||[])if(re?.source?.source_type==="tts"){const le=B?.[re.id]?.source||{},ce=le.voice_id||re?.source?.voice_id||null,T=le.voice_name||re?.source?.voice_name||(ce?ze[ce]:void 0);ce&&T&&!le.voice_name&&(B[re.id]={source:{...le,voice_name:T}})}f(u,i,{segment_overrides:B,introoutro:!0,introoutro_status:"manual"}),(async()=>{try{if(u){const re=(ie.segments||[]).filter(ce=>ce.segment_type==="intro"),le=(ie.segments||[]).filter(ce=>ce.segment_type==="outro");for(const ce of ie.segments||[]){const T=B?.[ce.id]?.source||{};if(ce?.source?.source_type==="tts"&&(T.script||ce?.source?.script)){const U=(T.script||ce?.source?.script||"").trim(),Y=(ce.segment_type==="intro"?re.findIndex(L=>L.id===ce.id):le.findIndex(L=>L.id===ce.id))+1,O=ce.segment_type==="intro"?`Intro ${Y}`:`Outro ${Y}`;U&&await Ze(s).saveSection({podcast_id:u,episode_id:h?.episode_id||null,tag:O,section_type:ce.segment_type,content:U,voice_id:T.voice_id||ce?.source?.voice_id||null,voice_name:T.voice_name||ce?.source?.voice_name||null})}}}}catch(re){console.warn("saveSection failed",re)}})(),V(!1),window.alert("Intro/Outro saved to this draft")},children:"Save"})]})]})]})}),He&&Je&&e.jsx(us,{value:de?.[Je]?.source?.voice_id||null,onChange:B=>{Ae(re=>({...re,[Je]:{source:{...re?.[Je]?.source,voice_id:B}}}))},onSelect:B=>{if(!B)return;const re=B.common_name||B.name||"Voice";Ae(le=>({...le,[Je]:{source:{...le?.[Je]?.source,voice_id:B.voice_id,voice_name:re}}}))},token:s,onClose:()=>{tt(!1),Le(null)}})]})}function bl({token:s}){const[a,r]=t.useState(!0),[l,n]=t.useState(["um","uh","like","you know"]),[o,m]=t.useState(!0),[k,i]=t.useState(!1),[u,y]=t.useState(!1),[f,h]=t.useState("low"),[D,d]=t.useState(""),[N,j]=t.useState([]);t.useEffect(()=>{let b=!0;return Ze().listSfx().then(A=>b&&j(A)),()=>{b=!1}},[s]);const S=t.useRef(null),v=b=>{S.current||(S.current=new(window.AudioContext||window.webkitAudioContext));const A=S.current,W=A.createOscillator(),$=A.createGain();W.type="sine",W.frequency.value=b==="low"?700:1200,$.gain.value=.1,W.connect($),$.connect(A.destination),W.start(),setTimeout(()=>W.stop(),200)},p=async()=>{const b=document.createElement("input");b.type="file",b.accept="audio/*",b.onchange=async A=>{const W=A.target.files?.[0];if(!W)return;await Ze().uploadMedia([W],[W.name],"sfx");const $=await Ze().listSfx();j($),d($[$.length-1]?.id||"")},b.click()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-base font-semibold",children:"Audio cleanup"})}),e.jsx("button",{className:"rounded-lg border px-3 py-2 hover:bg-muted",onClick:()=>{r(!0),n(["um","uh","like","you know"]),m(!0),i(!1),y(!1),h("low"),d("")},children:"Restore defaults"})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Remove filler words"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Hide common fillers like “um/uh/like” when it’s safe"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:()=>r(b=>!b)})," Enable"]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[l.map((b,A)=>e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm",children:[b,e.jsx("button",{className:"text-muted-foreground",onClick:()=>n(l.filter((W,$)=>$!==A)),children:"×"})]},A)),e.jsx("button",{className:"rounded-full border px-3 py-1 text-sm",onClick:()=>n(b=>b.concat(["um"])),children:"+ Add word"})]})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsx("div",{className:"font-medium",children:"Shorten long pauses"}),e.jsxs("div",{className:"mt-2 flex items-center gap-6 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:()=>m(b=>!b)})," Enable"]}),e.jsxs("label",{className:"inline-flex items-center gap-2 "+(o?"":"opacity-60 pointer-events-none"),children:[e.jsx("input",{type:"checkbox",checked:k,onChange:()=>i(b=>!b)})," More aggressive detection"]})]})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsx("div",{className:"font-medium",children:"Censor beep"}),e.jsxs("div",{className:"mt-2 space-y-3 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:()=>y(b=>!b)})," Enable"]}),e.jsxs("div",{className:u?"":"opacity-60 pointer-events-none",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"beep",checked:f==="low",onChange:()=>h("low")})," Low beep"]}),e.jsx("button",{className:"w-6 h-6 border rounded grid place-items-center text-xs",title:"Play low beep",onClick:()=>v("low"),children:"▶"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"beep",checked:f==="high",onChange:()=>h("high")})," High beep"]}),e.jsx("button",{className:"w-6 h-6 border rounded grid place-items-center text-xs",title:"Play high beep",onClick:()=>v("high"),children:"▶"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"beep",checked:f==="custom",onChange:()=>h("custom")})," Use your own sound"]})})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("label",{className:"text-sm",children:"Sound"}),e.jsxs("select",{className:"rounded-lg border px-2 py-1 text-sm",disabled:f!=="custom",value:D,onChange:b=>d(b.target.value),children:[e.jsx("option",{value:"",children:"Select SFX..."}),N.map(b=>e.jsx("option",{value:b.id,children:b.friendly_name||b.filename},b.id)),e.jsx("option",{value:"__upload",children:"Upload new SFX…"})]}),D&&D!=="__upload"&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Selected: ",N.find(b=>b.id===D)?.friendly_name||D]}),D==="__upload"&&e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:p,children:"Choose file…"})]})]})]})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsx("div",{className:"font-medium",children:"Coming soon"}),e.jsxs("div",{className:"mt-2 grid sm:grid-cols-2 gap-2 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 opacity-60",children:[e.jsx("input",{type:"checkbox",disabled:!0})," Remove coughs"]}),e.jsxs("label",{className:"flex items-center gap-2 opacity-60",children:[e.jsx("input",{type:"checkbox",disabled:!0})," Duck background SFX"]})]})]})]})}function jl(){const[s,a]=t.useState("Flubber"),[r,l]=t.useState(!0),[n,o]=t.useState("Intern"),[m,k]=t.useState(!1),[i,u]=t.useState(!1);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold",children:"Magic words & Intern"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose the phrases you’ll say while recording."})]})}),e.jsxs("div",{className:"rounded-xl border p-4 space-y-3",children:[e.jsx("div",{className:"font-medium",children:"Flubber wake phrase"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Say this when you make a mistake. We’ll mark it for an easy fix later."}),e.jsx("input",{value:s,onChange:y=>a(y.target.value),className:"w-full rounded-lg border px-3 py-2"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm mt-2",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:()=>l(y=>!y)})," Use Flubber if detected?"]})]}),e.jsxs("div",{className:"rounded-xl border p-4 space-y-3",children:[e.jsx("div",{className:"font-medium",children:"Intern wake phrase"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use this to ask for actions."}),e.jsx("input",{value:n,onChange:y=>o(y.target.value),className:"w-full rounded-lg border px-3 py-2"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm mt-2",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:()=>k(y=>!y)})," Use Intern actions if detected?"]})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"SFX on magic phrase"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Play a sound effect when your phrase is heard"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:()=>u(y=>!y)})," Use SFX if detected?"]})]}),e.jsx("div",{className:"mt-3 text-xs text-muted-foreground",children:"Tip: Choose unique phrases to avoid false triggers."})]})]})}function vl({token:s}){return e.jsxs("div",{className:"mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 py-10 space-y-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold tracking-tight",children:"Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("section",{className:"md:col-span-2 rounded-2xl border bg-card p-4",children:e.jsx(bl,{token:s})}),e.jsx("section",{className:"md:col-span-2 rounded-2xl border bg-card p-4",children:e.jsx(jl,{})})]})]})}function wl({token:s}){const[a,r]=t.useState("dashboard"),[l,n]=t.useState(!1),[o,m]=t.useState([]),[k,i]=t.useState([]),[u,y]=t.useState([]),[f,h]=t.useState([]);t.useEffect(()=>{i([]),y([]),m([])},[s]),t.useEffect(()=>{try{const S=s?`ab_state_${s.slice(0,6)}`:"ab_state_demo",v=localStorage.getItem(S);if(v){const p=JSON.parse(v);Array.isArray(p.uploads)&&i(p.uploads),Array.isArray(p.drafts)&&y(p.drafts)}}catch{}},[s]),t.useEffect(()=>{try{const S=s?`ab_state_${s.slice(0,6)}`:"ab_state_demo",v={uploads:k,drafts:u};localStorage.setItem(S,JSON.stringify(v))}catch{}},[k,u,s]),t.useEffect(()=>{let S=!1;return(async()=>{try{const v=await fetch("/api/templates/",{headers:s?{Authorization:`Bearer ${s}`}:{}});if(!v.ok)return;const p=await v.json();S||h(Array.isArray(p)?p:[])}catch{}})(),()=>{S=!0}},[s]),t.useEffect(()=>{let S=!1;return(async()=>{if(s)try{const v=await Ze(s).listPodcasts();if(S)return;const p=(Array.isArray(v)?v:[]).map(b=>({id:b.id||b.uuid||b._id||String(b.name||"show"),name:b.name||b.title||"Show"}));m(p)}catch{}})(),()=>{S=!0}},[s]),t.useEffect(()=>{let S=!1;return(async()=>{if(s)try{const v=await Ze(s).listMedia();if(S)return;const p=(v||[]).filter(b=>{const A=(b?.category||"").toLowerCase();return A==="main_content"||A==="content"||A===""||A==="audio"}).map(b=>{const A=b?.size?`${Math.max(1,Math.round(b.size/1024/1024))} MB`:"",W=b?.friendly_name||b?.client_name||b?.filename||"audio";return{id:b.id,fileName:W,serverFilename:b.filename,size:A,status:"done",progress:100,nickname:"",showId:void 0,ttlDays:14}});i(b=>{const A=new Map(b.map(W=>[W.id,W]));return p.forEach(W=>{const $=A.get(W.id);$?A.set(W.id,{...$,...W}):A.set(W.id,W)}),Array.from(A.values())}),y(b=>{const A=new Set(b.map($=>$.fileId)),W=p.filter($=>!A.has($.id)).map($=>({id:`d_${$.id}`,title:($.fileName||"").replace(/\.[a-z0-9]+$/i,""),fileId:$.id,transcript:"processing",hint:($.serverFilename||$.fileName||"").replace(/\.[a-z0-9]+$/i,"")}));return W.length?b.concat(W):b})}catch{}})(),()=>{S=!0}},[s]);const D=t.useMemo(()=>Object.fromEntries(k.map(S=>[S.id,S])),[k]),d=Ot.useCallback(S=>{if(!S)return;const v={id:S.id,fileName:S.friendly_name||S.client_name||S.filename||"audio",serverFilename:S.filename,size:S.size?`${Math.max(1,Math.round(S.size/1024/1024))} MB`:"",status:"done",progress:100,nickname:"",showId:void 0,ttlDays:14};i(p=>{const b=new Map(p.map(W=>[W.id,W])),A=b.get(v.id);return b.set(v.id,A?{...A,...v}:v),Array.from(b.values())}),y(p=>{if(p.some(A=>A.fileId===S.id))return p;const b=(v.fileName||"").replace(/\.[a-z0-9]+$/i,"");return p.concat([{id:`d_${S.id}`,title:b,fileId:S.id,transcript:"processing",hint:(v.serverFilename||b).replace(/\.[a-z0-9]+$/i,"")}])})},[]);t.useEffect(()=>{const S=v=>d(v?.detail);return window.addEventListener("ppp:media-uploaded",S),()=>window.removeEventListener("ppp:media-uploaded",S)},[d]);const N=t.useCallback(S=>{const v=u.find(p=>p.id===S);v&&r(v.transcript==="ready"?"creator-finalize":"creator-upload")},[u]),j=t.useCallback(S=>{i(v=>v.filter(p=>p.id!==S))},[]);return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(ol,{active:a,onSwitch:r}),e.jsxs("div",{className:"flex-1 flex",children:[e.jsx(hl,{collapsed:l,setCollapsed:n,onNavigate:r,active:a}),e.jsxs("main",{className:"flex-1",children:[e.jsx("div",{className:"px-4 pt-3 text-xs text-muted-foreground",children:(()=>{const v={dashboard:"Dashboard","episode-history":"Episodes","podcast-manager":"My Podcasts","media-library":"Media Uploads","my-templates":"My Templates",billing:"Billing","creator-upload":"Upload","creator-finalize":"Finalize",settings:"Settings"}[a]||"—";return e.jsxs("span",{children:["A/B Workspace / ",e.jsx("span",{className:"text-foreground",children:v})]})})()}),a==="dashboard"&&e.jsx(pl,{token:s,shows:o,drafts:u,onOpenDraft:N,setActive:r}),a==="episode-history"&&e.jsx(_r,{token:s,onBack:()=>r("dashboard")}),a==="podcast-manager"&&e.jsx(Sr,{token:s,podcasts:o,setPodcasts:m,onBack:()=>r("dashboard")}),a==="media-library"&&e.jsx(wr,{token:s,onBack:()=>r("dashboard")}),a==="my-templates"&&e.jsx(kr,{token:s,onBack:()=>r("dashboard"),setCurrentView:()=>{}}),a==="billing"&&e.jsx(Er,{token:s,onBack:()=>r("dashboard")}),a==="creator-upload"&&e.jsx(gl,{token:s,shows:o,uploads:k,setUploads:i,drafts:u,setDrafts:y,markUploadUsed:j,goFinalize:()=>r("creator-finalize"),goCustomizeSegments:()=>r("creator-step3")}),a==="creator-finalize"&&e.jsx(yl,{token:s,drafts:u,uploads:k,uploadById:D,goUpload:()=>r("creator-upload")}),a==="creator-step3"&&e.jsx(vr,{onBack:()=>r("creator-upload"),token:s,templates:f,podcasts:o,initialStep:3}),a==="recorder"&&e.jsx(Ar,{onBack:()=>r("dashboard"),token:s,onSaved:d,onFinish:({filename:S,hint:v,transcriptReady:p})=>{(async()=>{try{const A=(await Ze(s).listMedia()||[]).filter($=>{const G=($?.category||"").toLowerCase();return G==="main_content"||G==="content"||G===""||G==="audio"});i($=>{const G=new Map($.map(Q=>[Q.id,Q]));return A.forEach(Q=>{const ee=Q?.size?`${Math.max(1,Math.round(Q.size/1024/1024))} MB`:"",I=Q?.friendly_name||Q?.client_name||Q?.filename||"audio",q={id:Q.id,fileName:I,serverFilename:Q.filename,size:ee,status:"done",progress:100,nickname:"",showId:void 0,ttlDays:14},te=G.get(q.id);G.set(q.id,te?{...te,...q}:q)}),Array.from(G.values())});const W=A.find($=>{const G=($?.filename||"").toLowerCase(),Q=(v||S||"").toLowerCase();return Q?G===Q||G.includes(Q):!1});if(W){const $=(W.friendly_name||W.client_name||W.filename||"Recording").replace(/\.[a-z0-9]+$/i,"");y(G=>G.some(Q=>Q.fileId===W.id)?G:G.concat([{id:`d_${W.id}`,title:$,fileId:W.id,transcript:p?"ready":"processing",hint:v||S||$}]))}}catch{}r(p?"creator-finalize":"creator-upload")})()}}),a==="settings"&&e.jsx(vl,{token:s})]})]})]})}function Nl(){const{token:s,isAuthenticated:a}=St()||{};if(!a){try{window.location.replace("/")}catch{}return null}return e.jsx(wl,{token:s})}function _l(){const[s,a]=t.useState(0),{largeText:r,setLargeText:l,highContrast:n,setHighContrast:o}=Ir(),m=[{id:"welcome",title:"Pick a show name",description:"You can change this later.",render:()=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm",children:"Show name"}),e.jsx("input",{className:"w-full border rounded-[var(--radius)] p-2",placeholder:"My Great Show"})]}),validate:()=>!0,tip:"Short names are easier to remember."},{id:"artwork",title:"Add artwork",description:"Drop in a square image for best results.",render:()=>e.jsx("div",{className:"p-6 border-2 border-dashed rounded-[var(--radius)] text-sm text-muted-foreground",children:"Drag & drop image here"}),validate:()=>!0,tip:"At least 1400x1400px is recommended."},{id:"publish",title:"Choose a publish day",description:"We’ll remind you before each release.",render:()=>e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{className:"btn",children:"Mon"}),e.jsx("button",{className:"btn",children:"Wed"}),e.jsx("button",{className:"btn",children:"Fri"})]}),validate:()=>!0,tip:"Consistency beats volume."}];return e.jsx(Tr,{steps:m,index:s,setIndex:a,onComplete:()=>alert("Done!"),prefs:{largeText:r,setLargeText:l,highContrast:n,setHighContrast:o}})}try{if(sessionStorage.getItem("ppp_tab_id")||sessionStorage.setItem("ppp_tab_id",Math.random().toString(36).slice(2)),window.location.hash&&window.location.hash.includes("access_token=")){const a=new URLSearchParams(window.location.hash.substring(1)).get("access_token");if(a){localStorage.setItem("authToken",a);try{window.history.replaceState(null,"",window.location.pathname+window.location.search)}catch{}window.dispatchEvent(new CustomEvent("ppp-token-captured",{detail:{token:a}}))}}}catch(s){console.warn("[auth] token capture failed",s)}const Sl=ci([{path:"/",element:e.jsx(il,{}),errorElement:e.jsx(Ta,{})},{path:"/ab",element:e.jsx(Nl,{})},{path:"/onboarding-demo",element:e.jsx(_l,{})},{path:"/onboarding",element:e.jsx(Pr,{})},{path:"/error",element:e.jsx(Ta,{})},{path:"*",element:e.jsx(nl,{})}]);di.createRoot(document.getElementById("root")).render(e.jsx(Ot.StrictMode,{children:e.jsx(cn,{children:e.jsx(gn,{children:e.jsx(ui,{router:Sl})})})}));
